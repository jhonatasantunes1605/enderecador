{"data":"aW1wb3J0IHsgdHlwZSBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAibmV4dC9zZXJ2ZXIiCmltcG9ydCB7IHJlZGlzQ2FjaGUgfSBmcm9tICJAL2xpYi9yZWRpcy1jYWNoZSIKaW1wb3J0IHsgcGVyZm9ybWFuY2VNb25pdG9yIH0gZnJvbSAiQC9saWIvcGVyZm9ybWFuY2UtbW9uaXRvciIKCmV4cG9ydCBjb25zdCBkeW5hbWljID0gImZvcmNlLWR5bmFtaWMiCgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7CiAgdHJ5IHsKICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKQogICAgY29uc3QgYWN0aW9uID0gc2VhcmNoUGFyYW1zLmdldCgiYWN0aW9uIikKCiAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICBjYXNlICJzdGF0cyI6CiAgICAgICAgY29uc3QgW2NhY2hlU3RhdHMsIHBlcmZTdGF0c10gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICByZWRpc0NhY2hlLmdldFN0YXRzKCksCiAgICAgICAgICBQcm9taXNlLnJlc29sdmUocGVyZm9ybWFuY2VNb25pdG9yLmdldFN0YXRzKCkpLAogICAgICAgIF0pCgogICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7CiAgICAgICAgICBjYWNoZTogY2FjaGVTdGF0cywKICAgICAgICAgIHBlcmZvcm1hbmNlOiBwZXJmU3RhdHMsCiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICB9KQoKICAgICAgY2FzZSAiZmx1c2giOgogICAgICAgIGNvbnN0IGZsdXNoZWQgPSBhd2FpdCByZWRpc0NhY2hlLmZsdXNoKCkKICAgICAgICBwZXJmb3JtYW5jZU1vbml0b3IuY2xlYXJNZXRyaWNzKCkKCiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsKICAgICAgICAgIHN1Y2Nlc3M6IGZsdXNoZWQsCiAgICAgICAgICBtZXNzYWdlOiBmbHVzaGVkID8gIkNhY2hlIGxpbXBvIGNvbSBzdWNlc3NvIiA6ICJFcnJvIGFvIGxpbXBhciBjYWNoZSIsCiAgICAgICAgfSkKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKAogICAgICAgICAgewogICAgICAgICAgICBlcnJvcjogIkHDp8OjbyBuw6NvIGVzcGVjaWZpY2FkYS4gVXNlID9hY3Rpb249c3RhdHMgb3UgP2FjdGlvbj1mbHVzaCIsCiAgICAgICAgICB9LAogICAgICAgICAgeyBzdGF0dXM6IDQwMCB9LAogICAgICAgICkKICAgIH0KICB9IGNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcigiW0FQSV0gRXJybyBuYSBBUEkgZGUgY2FjaGU6IiwgZXJyb3IpCiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oCiAgICAgIHsKICAgICAgICBlcnJvcjogIkVycm8gaW50ZXJubyBkbyBzZXJ2aWRvciIsCiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAiRXJybyBkZXNjb25oZWNpZG8iLAogICAgICB9LAogICAgICB7IHN0YXR1czogNTAwIH0sCiAgICApCiAgfQp9CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkgewogIHRyeSB7CiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCkKICAgIGNvbnN0IHsgYWN0aW9uLCBrZXksIHBhdHRlcm4gfSA9IGJvZHkKCiAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICBjYXNlICJkZWxldGUiOgogICAgICAgIGlmICgha2V5KSB7CiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBlcnJvcjogIkNoYXZlIG7Do28gZXNwZWNpZmljYWRhIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9LAogICAgICAgICAgKQogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVsZXRlZCA9IGF3YWl0IHJlZGlzQ2FjaGUuZGVsKGtleSkKICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oewogICAgICAgICAgc3VjY2VzczogZGVsZXRlZCwKICAgICAgICAgIG1lc3NhZ2U6IGRlbGV0ZWQgPyBgQ2hhdmUgJHtrZXl9IGRlbGV0YWRhYCA6IGBDaGF2ZSAke2tleX0gbsOjbyBlbmNvbnRyYWRhYCwKICAgICAgICB9KQoKICAgICAgY2FzZSAiZGVsZXRlUGF0dGVybiI6CiAgICAgICAgaWYgKCFwYXR0ZXJuKSB7CiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBlcnJvcjogIlBhdHRlcm4gbsOjbyBlc3BlY2lmaWNhZG8iLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7IHN0YXR1czogNDAwIH0sCiAgICAgICAgICApCiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZWxldGVkQ291bnQgPSBhd2FpdCByZWRpc0NhY2hlLmRlbFBhdHRlcm4ocGF0dGVybikKICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oewogICAgICAgICAgc3VjY2VzczogZGVsZXRlZENvdW50ID4gMCwKICAgICAgICAgIGRlbGV0ZWRDb3VudCwKICAgICAgICAgIG1lc3NhZ2U6IGAke2RlbGV0ZWRDb3VudH0gY2hhdmVzIGRlbGV0YWRhcyBjb20gcGF0dGVybiAke3BhdHRlcm59YCwKICAgICAgICB9KQoKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oCiAgICAgICAgICB7CiAgICAgICAgICAgIGVycm9yOiAiQcOnw6NvIG7Do28gc3Vwb3J0YWRhIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7IHN0YXR1czogNDAwIH0sCiAgICAgICAgKQogICAgfQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCJbQVBJXSBFcnJvIG5hIEFQSSBkZSBjYWNoZSBQT1NUOiIsIGVycm9yKQogICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKAogICAgICB7CiAgICAgICAgZXJyb3I6ICJFcnJvIGludGVybm8gZG8gc2Vydmlkb3IiLAogICAgICAgIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogIkVycm8gZGVzY29uaGVjaWRvIiwKICAgICAgfSwKICAgICAgeyBzdGF0dXM6IDUwMCB9LAogICAgKQogIH0KfQo="}