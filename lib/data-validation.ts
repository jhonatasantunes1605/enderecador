{"data":"Ly8gVmFsaWRhw6fDtWVzIGNlbnRyYWxpemFkYXMgcGFyYSBvIHNpc3RlbWEKZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25FcnJvciBleHRlbmRzIEVycm9yIHsKICBjb25zdHJ1Y3RvcigKICAgIG1lc3NhZ2U6IHN0cmluZywKICAgIHB1YmxpYyBmaWVsZD86IHN0cmluZywKICApIHsKICAgIHN1cGVyKG1lc3NhZ2UpCiAgICB0aGlzLm5hbWUgPSAiVmFsaWRhdGlvbkVycm9yIgogIH0KfQoKZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHsKICBpc1ZhbGlkOiBib29sZWFuCiAgZXJyb3JzOiBBcnJheTx7IGZpZWxkOiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZyB9Pgp9CgpleHBvcnQgY2xhc3MgRGF0YVZhbGlkYXRvciB7CiAgc3RhdGljIHZhbGlkYXRlV2FyZWhvdXNlKGRhdGE6IHsgbmFtZTogc3RyaW5nIH0pOiBWYWxpZGF0aW9uUmVzdWx0IHsKICAgIGNvbnN0IGVycm9yczogQXJyYXk8eyBmaWVsZDogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmcgfT4gPSBbXQoKICAgIGlmICghZGF0YS5uYW1lIHx8IGRhdGEubmFtZS50cmltKCkubGVuZ3RoID09PSAwKSB7CiAgICAgIGVycm9ycy5wdXNoKHsgZmllbGQ6ICJuYW1lIiwgbWVzc2FnZTogIk5vbWUgZG8gZ2FscMOjbyDDqSBvYnJpZ2F0w7NyaW8iIH0pCiAgICB9CgogICAgaWYgKGRhdGEubmFtZSAmJiBkYXRhLm5hbWUudHJpbSgpLmxlbmd0aCA+IDEwMCkgewogICAgICBlcnJvcnMucHVzaCh7IGZpZWxkOiAibmFtZSIsIG1lc3NhZ2U6ICJOb21lIGRvIGdhbHDDo28gZGV2ZSB0ZXIgbm8gbcOheGltbyAxMDAgY2FyYWN0ZXJlcyIgfSkKICAgIH0KCiAgICByZXR1cm4gewogICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLAogICAgICBlcnJvcnMsCiAgICB9CiAgfQoKICBzdGF0aWMgdmFsaWRhdGVBaXNsZShkYXRhOiB7CiAgICBuYW1lOiBzdHJpbmcKICAgIHdhcmVob3VzZUlkOiBzdHJpbmcKICAgIHN0b3JhZ2VUeXBlOiBzdHJpbmcKICAgIGNhcGFjaXR5PzogbnVtYmVyCiAgICBzaGVsZkxldmVscz86IG51bWJlcgogIH0pOiBWYWxpZGF0aW9uUmVzdWx0IHsKICAgIGNvbnN0IGVycm9yczogQXJyYXk8eyBmaWVsZDogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmcgfT4gPSBbXQoKICAgIGlmICghZGF0YS5uYW1lIHx8IGRhdGEubmFtZS50cmltKCkubGVuZ3RoID09PSAwKSB7CiAgICAgIGVycm9ycy5wdXNoKHsgZmllbGQ6ICJuYW1lIiwgbWVzc2FnZTogIk5vbWUgZGEgcnVhIMOpIG9icmlnYXTDs3JpbyIgfSkKICAgIH0KCiAgICBpZiAoIWRhdGEud2FyZWhvdXNlSWQgfHwgZGF0YS53YXJlaG91c2VJZC50cmltKCkubGVuZ3RoID09PSAwKSB7CiAgICAgIGVycm9ycy5wdXNoKHsgZmllbGQ6ICJ3YXJlaG91c2VJZCIsIG1lc3NhZ2U6ICJJRCBkbyBnYWxww6NvIMOpIG9icmlnYXTDs3JpbyIgfSkKICAgIH0KCiAgICBpZiAoIVsicGFsbGV0IiwgInNoZWxmIl0uaW5jbHVkZXMoZGF0YS5zdG9yYWdlVHlwZSkpIHsKICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogInN0b3JhZ2VUeXBlIiwgbWVzc2FnZTogJ1RpcG8gZGUgYXJtYXplbmFtZW50byBkZXZlIHNlciAicGFsbGV0IiBvdSAic2hlbGYiJyB9KQogICAgfQoKICAgIGlmIChkYXRhLmNhcGFjaXR5ICE9PSB1bmRlZmluZWQgJiYgKGRhdGEuY2FwYWNpdHkgPCAwIHx8IGRhdGEuY2FwYWNpdHkgPiAxMDAwMCkpIHsKICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogImNhcGFjaXR5IiwgbWVzc2FnZTogIkNhcGFjaWRhZGUgZGV2ZSBlc3RhciBlbnRyZSAwIGUgMTAwMDAiIH0pCiAgICB9CgogICAgaWYgKGRhdGEuc3RvcmFnZVR5cGUgPT09ICJzaGVsZiIgJiYgZGF0YS5zaGVsZkxldmVscykgewogICAgICBpZiAoZGF0YS5zaGVsZkxldmVscyA8IDEgfHwgZGF0YS5zaGVsZkxldmVscyA+IDEwKSB7CiAgICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogInNoZWxmTGV2ZWxzIiwgbWVzc2FnZTogIk7Dum1lcm8gZGUgYW5kYXJlcyBkZXZlIGVzdGFyIGVudHJlIDEgZSAxMCIgfSkKICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsCiAgICAgIGVycm9ycywKICAgIH0KICB9CgogIHN0YXRpYyB2YWxpZGF0ZVByb2R1Y3QoZGF0YTogewogICAgZWFuOiBzdHJpbmcKICAgIHByb2R1Y3ROYW1lOiBzdHJpbmcKICAgIG9jY3VwYW5jeVBlcmNlbnRhZ2U/OiBudW1iZXIKICB9KTogVmFsaWRhdGlvblJlc3VsdCB7CiAgICBjb25zdCBlcnJvcnM6IEFycmF5PHsgZmllbGQ6IHN0cmluZzsgbWVzc2FnZTogc3RyaW5nIH0+ID0gW10KCiAgICBpZiAoIWRhdGEuZWFuIHx8IGRhdGEuZWFuLnRyaW0oKS5sZW5ndGggPT09IDApIHsKICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogImVhbiIsIG1lc3NhZ2U6ICJFQU4vSUQgZG8gcHJvZHV0byDDqSBvYnJpZ2F0w7NyaW8iIH0pCiAgICB9CgogICAgaWYgKCFkYXRhLnByb2R1Y3ROYW1lIHx8IGRhdGEucHJvZHVjdE5hbWUudHJpbSgpLmxlbmd0aCA9PT0gMCkgewogICAgICBlcnJvcnMucHVzaCh7IGZpZWxkOiAicHJvZHVjdE5hbWUiLCBtZXNzYWdlOiAiTm9tZSBkbyBwcm9kdXRvIMOpIG9icmlnYXTDs3JpbyIgfSkKICAgIH0KCiAgICAKCiAgICBpZiAoZGF0YS5vY2N1cGFuY3lQZXJjZW50YWdlICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKGRhdGEub2NjdXBhbmN5UGVyY2VudGFnZSA8IDAgfHwgZGF0YS5vY2N1cGFuY3lQZXJjZW50YWdlID4gMTAwKSB7CiAgICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogIm9jY3VwYW5jeVBlcmNlbnRhZ2UiLCBtZXNzYWdlOiAiUG9yY2VudGFnZW0gZGUgb2N1cGHDp8OjbyBkZXZlIGVzdGFyIGVudHJlIDAgZSAxMDAiIH0pCiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLAogICAgICBlcnJvcnMsCiAgICB9CiAgfQoKICBzdGF0aWMgdmFsaWRhdGVBZGRyZXNzKGFkZHJlc3M6IHN0cmluZyk6IFZhbGlkYXRpb25SZXN1bHQgewogICAgY29uc3QgZXJyb3JzOiBBcnJheTx7IGZpZWxkOiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZyB9PiA9IFtdCgogICAgaWYgKCFhZGRyZXNzIHx8IGFkZHJlc3MudHJpbSgpLmxlbmd0aCA9PT0gMCkgewogICAgICBlcnJvcnMucHVzaCh7IGZpZWxkOiAiYWRkcmVzcyIsIG1lc3NhZ2U6ICJFbmRlcmXDp28gw6kgb2JyaWdhdMOzcmlvIiB9KQogICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3JzIH0KICAgIH0KCiAgICAvLyBSZWdleCBwYXJhIHZhbGlkYXIgZm9ybWF0byBBW27Dum1lcm9dUltuw7ptZXJvXVBbbsO6bWVyb10gb3BjaW9uYWxtZW50ZSBzZWd1aWRvIGRlIEFbbsO6bWVyb10KICAgIGNvbnN0IHJlZ2V4ID0gL15BKFxkKylSKFxkKylQKFxkKykoPzpBKFxkKykpPyQvaQogICAgY29uc3QgbWF0Y2ggPSBhZGRyZXNzLnRyaW0oKS50b1VwcGVyQ2FzZSgpLm1hdGNoKHJlZ2V4KQoKICAgIGlmICghbWF0Y2gpIHsKICAgICAgZXJyb3JzLnB1c2goewogICAgICAgIGZpZWxkOiAiYWRkcmVzcyIsCiAgICAgICAgbWVzc2FnZTogIkZvcm1hdG8gZGUgZW5kZXJlw6dvIGludsOhbGlkby4gVXNlOiBBW2dhbHDDo29dUltydWFdUFtwb3Npw6fDo29dIG91IEFbZ2FscMOjb11SW3J1YV1QW3Bvc2nDp8Ojb11BW2FuZGFyXSIsCiAgICAgIH0pCiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCwKICAgICAgZXJyb3JzLAogICAgfQogIH0KCiAgc3RhdGljIHZhbGlkYXRlRUFOKGVhbjogc3RyaW5nKTogVmFsaWRhdGlvblJlc3VsdCB7CiAgICBjb25zdCBlcnJvcnM6IEFycmF5PHsgZmllbGQ6IHN0cmluZzsgbWVzc2FnZTogc3RyaW5nIH0+ID0gW10KCiAgICBpZiAoIWVhbiB8fCBlYW4udHJpbSgpLmxlbmd0aCA9PT0gMCkgewogICAgICBlcnJvcnMucHVzaCh7IGZpZWxkOiAiZWFuIiwgbWVzc2FnZTogIkVBTiDDqSBvYnJpZ2F0w7NyaW8iIH0pCiAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMgfQogICAgfQoKICAgIGNvbnN0IGNsZWFuRUFOID0gZWFuLnRyaW0oKQoKICAgIC8vIEFsbG93IG51bWJlcnMsIHNlbWljb2xvbnMsIGFuZCBzcGFjZXMKICAgIGlmICghL15bXGQ7XHNdKyQvLnRlc3QoY2xlYW5FQU4pKSB7CiAgICAgIGVycm9ycy5wdXNoKHsgZmllbGQ6ICJlYW4iLCBtZXNzYWdlOiAiRUFOIGRldmUgY29udGVyIGFwZW5hcyBuw7ptZXJvcywgcG9udG8gZSB2w61yZ3VsYXMgZSBlc3Bhw6dvcyIgfSkKICAgIH0KCiAgICAvLyBWYWxpZGFyIGNhZGEgRUFOIGluZGl2aWR1YWxtZW50ZQogICAgY29uc3QgZWFucyA9IGNsZWFuRUFOCiAgICAgIC5zcGxpdCgiOyIpIC8vIENoYW5nZWQgdG8gc3BsaXQgYnkgc2VtaWNvbG9uCiAgICAgIC5tYXAoKGUpID0+IGUudHJpbSgpKQogICAgICAuZmlsdGVyKChlKSA9PiBlLmxlbmd0aCA+IDApCgogICAgaWYgKGVhbnMubGVuZ3RoID09PSAwKSB7CiAgICAgIGVycm9ycy5wdXNoKHsgZmllbGQ6ICJlYW4iLCBtZXNzYWdlOiAiUGVsbyBtZW5vcyB1bSBFQU4gdsOhbGlkbyDDqSBvYnJpZ2F0w7NyaW8iIH0pCiAgICB9CgogICAgZm9yIChjb25zdCBpbmRpdmlkdWFsRUFOIG9mIGVhbnMpIHsKICAgICAgaWYgKGluZGl2aWR1YWxFQU4ubGVuZ3RoIDwgNCB8fCBpbmRpdmlkdWFsRUFOLmxlbmd0aCA+IDE0KSB7CiAgICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogImVhbiIsIG1lc3NhZ2U6IGBFQU4gJHtpbmRpdmlkdWFsRUFOfSBkZXZlIHRlciBlbnRyZSA0IGUgMTQgZMOtZ2l0b3NgIH0pCiAgICAgIH0KCiAgICAgIGlmICghL15cZCskLy50ZXN0KGluZGl2aWR1YWxFQU4pKSB7CiAgICAgICAgZXJyb3JzLnB1c2goeyBmaWVsZDogImVhbiIsIG1lc3NhZ2U6IGBFQU4gJHtpbmRpdmlkdWFsRUFOfSBkZXZlIGNvbnRlciBhcGVuYXMgbsO6bWVyb3NgIH0pCiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLAogICAgICBlcnJvcnMsCiAgICB9CiAgfQp9Cg=="}