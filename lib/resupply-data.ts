{"data":"aW1wb3J0IHsgZ29vZ2xlU2hlZXRzU2VydmljZSwgdHlwZSBSZXN1cHBseVJvdyB9IGZyb20gIi4vZ29vZ2xlLXNoZWV0cyIKaW1wb3J0IHR5cGUgeyBSZXN1cHBseUl0ZW0sIFJlc3VwcGx5TG9jYXRpb24sIFJlc3VwcGx5U3RhdHMsIFJlc3VwcGx5Tm90aWZpY2F0aW9uIH0gZnJvbSAiLi9yZXN1cHBseS10eXBlcyIKaW1wb3J0IHsgcGVyZm9ybWFuY2VNb25pdG9yIH0gZnJvbSAiLi9wZXJmb3JtYW5jZS1tb25pdG9yIgoKLy8gRnVuw6fDo28gcGFyYSBhZGljaW9uYXIgbm90aWZpY2HDp8OjbyBkZSByZXNzdXByaW1lbnRvIG5hIHBsYW5pbGhhCmV4cG9ydCBjb25zdCBhZGRSZXN1cHBseU5vdGlmaWNhdGlvbiA9IGFzeW5jICgKICBub3RpZmljYXRpb246IE9taXQ8UmVzdXBwbHlOb3RpZmljYXRpb24sICJpZCIgfCAibm90aWZpZWRBdCIgfCAiY3JlYXRlZEF0Ij4sCik6IFByb21pc2U8UmVzdXBwbHlOb3RpZmljYXRpb24+ID0+IHsKICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpCgogIGNvbnN0IHJlc3VwcGx5Um93OiBPbWl0PFJlc3VwcGx5Um93LCAiaWQiIHwgImNyZWF0ZWRBdCI+ID0gewogICAgcHJvZHVjdElkOiBub3RpZmljYXRpb24ucHJvZHVjdElkLAogICAgcHJvZHVjdE5hbWU6IG5vdGlmaWNhdGlvbi5wcm9kdWN0TmFtZSwKICAgIGVhbjEzOiBub3RpZmljYXRpb24uZWFuMTMgfHwgIiIsCiAgICBjYXRlZ29yeTogbm90aWZpY2F0aW9uLmNhdGVnb3J5IHx8ICIiLAogICAgbG9jYXRpb25JZDogbm90aWZpY2F0aW9uLmxvY2F0aW9uSWQsCiAgICBsb2NhdGlvblR5cGU6IG5vdGlmaWNhdGlvbi5sb2NhdGlvblR5cGUsCiAgICBhZGRyZXNzOiBub3RpZmljYXRpb24uYWRkcmVzcywKICAgIHdhcmVob3VzZUlkOiBub3RpZmljYXRpb24ud2FyZWhvdXNlSWQsCiAgICB3YXJlaG91c2VOYW1lOiBub3RpZmljYXRpb24ud2FyZWhvdXNlTmFtZSwKICAgIGFpc2xlSWQ6IG5vdGlmaWNhdGlvbi5haXNsZUlkLAogICAgYWlzbGVOYW1lOiBub3RpZmljYXRpb24uYWlzbGVOYW1lLAogICAgcG9zaXRpb246IG5vdGlmaWNhdGlvbi5wb3NpdGlvbi50b1N0cmluZygpLAogICAgbGV2ZWw6IG5vdGlmaWNhdGlvbi5sZXZlbD8udG9TdHJpbmcoKSB8fCAiIiwKICAgIHN0YXR1czogbm90aWZpY2F0aW9uLnN0YXR1cywKICAgIHByaW9yaXR5OiAibWVkaXVtIiwgLy8gVmFsb3IgZml4bwogICAgbm90ZXM6IG5vdGlmaWNhdGlvbi5ub3RlcyB8fCAiIiwKICAgIG5vdGlmaWVkQXQ6IG5vdy50b0lTT1N0cmluZygpLAogICAgY29tcGxldGVkQXQ6ICIiLAogIH0KCiAgY29uc3Qgc2F2ZWRSb3cgPSBhd2FpdCBnb29nbGVTaGVldHNTZXJ2aWNlLmFkZFJlc3VwcGx5Tm90aWZpY2F0aW9uKHJlc3VwcGx5Um93KQoKICByZXR1cm4gewogICAgaWQ6IHNhdmVkUm93LmlkLAogICAgcHJvZHVjdElkOiBzYXZlZFJvdy5wcm9kdWN0SWQsCiAgICBwcm9kdWN0TmFtZTogc2F2ZWRSb3cucHJvZHVjdE5hbWUsCiAgICBlYW4xMzogc2F2ZWRSb3cuZWFuMTMgfHwgdW5kZWZpbmVkLAogICAgY2F0ZWdvcnk6IHNhdmVkUm93LmNhdGVnb3J5IHx8IHVuZGVmaW5lZCwKICAgIGxvY2F0aW9uSWQ6IHNhdmVkUm93LmxvY2F0aW9uSWQsCiAgICBsb2NhdGlvblR5cGU6IHNhdmVkUm93LmxvY2F0aW9uVHlwZSBhcyAicGFsbGV0IiB8ICJzaGVsZiIsCiAgICBhZGRyZXNzOiBzYXZlZFJvdy5hZGRyZXNzLAogICAgd2FyZWhvdXNlSWQ6IHNhdmVkUm93LndhcmVob3VzZUlkLAogICAgd2FyZWhvdXNlTmFtZTogc2F2ZWRSb3cud2FyZWhvdXNlTmFtZSwKICAgIGFpc2xlSWQ6IHNhdmVkUm93LmFpc2xlSWQsCiAgICBhaXNsZU5hbWU6IHNhdmVkUm93LmFpc2xlTmFtZSwKICAgIHBvc2l0aW9uOiBOdW1iZXIucGFyc2VJbnQoc2F2ZWRSb3cucG9zaXRpb24pLAogICAgbGV2ZWw6IHNhdmVkUm93LmxldmVsID8gTnVtYmVyLnBhcnNlSW50KHNhdmVkUm93LmxldmVsKSA6IHVuZGVmaW5lZCwKICAgIHN0YXR1czogc2F2ZWRSb3cuc3RhdHVzIGFzIFJlc3VwcGx5Tm90aWZpY2F0aW9uWyJzdGF0dXMiXSwKICAgIG5vdGVzOiBzYXZlZFJvdy5ub3RlcyB8fCB1bmRlZmluZWQsCiAgICBub3RpZmllZEF0OiBuZXcgRGF0ZShzYXZlZFJvdy5ub3RpZmllZEF0KSwKICAgIGNvbXBsZXRlZEF0OiBzYXZlZFJvdy5jb21wbGV0ZWRBdCA/IG5ldyBEYXRlKHNhdmVkUm93LmNvbXBsZXRlZEF0KSA6IHVuZGVmaW5lZCwKICAgIGNyZWF0ZWRBdDogc2F2ZWRSb3cuY3JlYXRlZEF0LAogIH0KfQoKLy8gRnVuw6fDo28gcGFyYSBhdHVhbGl6YXIgc3RhdHVzIGRlIG5vdGlmaWNhw6fDo28gbmEgcGxhbmlsaGEKZXhwb3J0IGNvbnN0IHVwZGF0ZVJlc3VwcGx5U3RhdHVzID0gYXN5bmMgKAogIG5vdGlmaWNhdGlvbklkOiBzdHJpbmcsCiAgc3RhdHVzOiBSZXN1cHBseU5vdGlmaWNhdGlvblsic3RhdHVzIl0sCiAgbm90ZXM/OiBzdHJpbmcsCik6IFByb21pc2U8Ym9vbGVhbj4gPT4gewogIGNvbnN0IHVwZGF0ZXM6IFBhcnRpYWw8UmVzdXBwbHlSb3c+ID0gewogICAgc3RhdHVzLAogICAgbm90ZXM6IG5vdGVzIHx8ICIiLAogIH0KCiAgaWYgKHN0YXR1cyA9PT0gImNvbXBsZXRlZCIpIHsKICAgIHVwZGF0ZXMuY29tcGxldGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICB9CgogIHJldHVybiBhd2FpdCBnb29nbGVTaGVldHNTZXJ2aWNlLnVwZGF0ZVJlc3VwcGx5Tm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbklkLCB1cGRhdGVzKQp9CgovLyBGdW7Dp8OjbyBwYXJhIG9idGVyIHRvZGFzIGFzIG5vdGlmaWNhw6fDtWVzIGRhIHBsYW5pbGhhCmV4cG9ydCBjb25zdCBnZXRSZXN1cHBseU5vdGlmaWNhdGlvbnMgPSBhc3luYyAoKTogUHJvbWlzZTxSZXN1cHBseU5vdGlmaWNhdGlvbltdPiA9PiB7CiAgY29uc3Qgcm93cyA9IGF3YWl0IGdvb2dsZVNoZWV0c1NlcnZpY2UuZ2V0UmVzdXBwbHlOb3RpZmljYXRpb25zKCkKCiAgcmV0dXJuIHJvd3MKICAgIC5tYXAoKHJvdykgPT4gKHsKICAgICAgaWQ6IHJvdy5pZCwKICAgICAgcHJvZHVjdElkOiByb3cucHJvZHVjdElkLAogICAgICBwcm9kdWN0TmFtZTogcm93LnByb2R1Y3ROYW1lLAogICAgICBlYW4xMzogcm93LmVhbjEzIHx8IHVuZGVmaW5lZCwKICAgICAgY2F0ZWdvcnk6IHJvdy5jYXRlZ29yeSB8fCB1bmRlZmluZWQsCiAgICAgIGxvY2F0aW9uSWQ6IHJvdy5sb2NhdGlvbklkLAogICAgICBsb2NhdGlvblR5cGU6IHJvdy5sb2NhdGlvblR5cGUgYXMgInBhbGxldCIgfCAic2hlbGYiLAogICAgICBhZGRyZXNzOiByb3cuYWRkcmVzcywKICAgICAgd2FyZWhvdXNlSWQ6IHJvdy53YXJlaG91c2VJZCwKICAgICAgd2FyZWhvdXNlTmFtZTogcm93LndhcmVob3VzZU5hbWUsCiAgICAgIGFpc2xlSWQ6IHJvdy5haXNsZUlkLAogICAgICBhaXNsZU5hbWU6IHJvdy5haXNsZU5hbWUsCiAgICAgIHBvc2l0aW9uOiBOdW1iZXIucGFyc2VJbnQocm93LnBvc2l0aW9uKSwKICAgICAgbGV2ZWw6IHJvdy5sZXZlbCA/IE51bWJlci5wYXJzZUludChyb3cubGV2ZWwpIDogdW5kZWZpbmVkLAogICAgICBzdGF0dXM6IHJvdy5zdGF0dXMgYXMgUmVzdXBwbHlOb3RpZmljYXRpb25bInN0YXR1cyJdLAogICAgICBub3Rlczogcm93Lm5vdGVzIHx8IHVuZGVmaW5lZCwKICAgICAgbm90aWZpZWRBdDogbmV3IERhdGUocm93Lm5vdGlmaWVkQXQpLAogICAgICBjb21wbGV0ZWRBdDogcm93LmNvbXBsZXRlZEF0ID8gbmV3IERhdGUocm93LmNvbXBsZXRlZEF0KSA6IHVuZGVmaW5lZCwKICAgICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZEF0LAogICAgfSkpCiAgICAuc29ydCgoYSwgYikgPT4gYi5ub3RpZmllZEF0LmdldFRpbWUoKSAtIGEubm90aWZpZWRBdC5nZXRUaW1lKCkpCn0KCi8vIEZ1bsOnw6NvIHByaW5jaXBhbCBwYXJhIGJ1c2NhciBpdGVucyBkZSByZXNzdXByaW1lbnRvIChiYXNlYWRhIG5hcyBub3RpZmljYcOnw7VlcyBkYSBwbGFuaWxoYSkKZXhwb3J0IGNvbnN0IGdldFJlc3VwcGx5SXRlbXMgPSBhc3luYyAoKTogUHJvbWlzZTxSZXN1cHBseUl0ZW1bXT4gPT4gewogIHJldHVybiBwZXJmb3JtYW5jZU1vbml0b3IudHJhY2tPcGVyYXRpb24oImdldFJlc3VwcGx5SXRlbXMiLCBhc3luYyAoKSA9PiB7CiAgICB0cnkgewogICAgICBjb25zb2xlLmxvZygiW1JFU1VQUExZXSBCdXNjYW5kbyBpdGVucyBub3RpZmljYWRvcyBwYXJhIHJlc3N1cHJpbWVudG8gZGEgcGxhbmlsaGEuLi4iKQoKICAgICAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IGF3YWl0IGdldFJlc3VwcGx5Tm90aWZpY2F0aW9ucygpCiAgICAgIGNvbnN0IGFjdGl2ZU5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zLmZpbHRlcigobikgPT4gbi5zdGF0dXMgIT09ICJjb21wbGV0ZWQiKQoKICAgICAgLy8gQWdydXBhciBub3RpZmljYcOnw7VlcyBwb3IgcHJvZHV0bwogICAgICBjb25zdCByZXN1cHBseU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBSZXN1cHBseUl0ZW0+KCkKCiAgICAgIGZvciAoY29uc3Qgbm90aWZpY2F0aW9uIG9mIGFjdGl2ZU5vdGlmaWNhdGlvbnMpIHsKICAgICAgICBjb25zdCBwcm9kdWN0S2V5ID0gbm90aWZpY2F0aW9uLnByb2R1Y3RJZCB8fCBgdW5rbm93bi0ke25vdGlmaWNhdGlvbi5pZH1gCgogICAgICAgIGNvbnN0IGxvY2F0aW9uOiBSZXN1cHBseUxvY2F0aW9uID0gewogICAgICAgICAgaWQ6IG5vdGlmaWNhdGlvbi5pZCwgLy8gVXNhciBvIElEIGRhIG5vdGlmaWNhw6fDo28gY29tbyBJRCBkYSBsb2NhbGl6YcOnw6NvCiAgICAgICAgICBhZGRyZXNzOiBub3RpZmljYXRpb24uYWRkcmVzcywKICAgICAgICAgIHdhcmVob3VzZUlkOiBub3RpZmljYXRpb24ud2FyZWhvdXNlSWQsCiAgICAgICAgICB3YXJlaG91c2VOYW1lOiBub3RpZmljYXRpb24ud2FyZWhvdXNlTmFtZSwKICAgICAgICAgIGFpc2xlSWQ6IG5vdGlmaWNhdGlvbi5haXNsZUlkLAogICAgICAgICAgYWlzbGVOYW1lOiBub3RpZmljYXRpb24uYWlzbGVOYW1lLAogICAgICAgICAgcG9zaXRpb246IG5vdGlmaWNhdGlvbi5wb3NpdGlvbiwKICAgICAgICAgIGxldmVsOiBub3RpZmljYXRpb24ubGV2ZWwsCiAgICAgICAgICBzdG9yYWdlVHlwZTogbm90aWZpY2F0aW9uLmxvY2F0aW9uVHlwZSwKICAgICAgICAgIGN1cnJlbnRPY2N1cGFuY3k6IDAsCiAgICAgICAgICBtYXhDYXBhY2l0eTogMTAwLAogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3VwcGx5TWFwLmhhcyhwcm9kdWN0S2V5KSkgewogICAgICAgICAgY29uc3QgZXhpc3RpbmdJdGVtID0gcmVzdXBwbHlNYXAuZ2V0KHByb2R1Y3RLZXkpIQogICAgICAgICAgZXhpc3RpbmdJdGVtLmxvY2F0aW9ucy5wdXNoKGxvY2F0aW9uKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBuZXdJdGVtOiBSZXN1cHBseUl0ZW0gPSB7CiAgICAgICAgICAgIGlkOiBwcm9kdWN0S2V5LAogICAgICAgICAgICBwcm9kdWN0TmFtZTogbm90aWZpY2F0aW9uLnByb2R1Y3ROYW1lLAogICAgICAgICAgICBlYW46IG5vdGlmaWNhdGlvbi5wcm9kdWN0SWQsCiAgICAgICAgICAgIGVhbjEzOiBub3RpZmljYXRpb24uZWFuMTMsCiAgICAgICAgICAgIGNhdGVnb3J5OiBub3RpZmljYXRpb24uY2F0ZWdvcnkgfHwgIlByb2R1dG8iLAogICAgICAgICAgICBjdXJyZW50T2NjdXBhbmN5OiAwLAogICAgICAgICAgICByZWNvbW1lbmRlZE9jY3VwYW5jeTogMTAwLAogICAgICAgICAgICBzdGF0dXM6IG5vdGlmaWNhdGlvbi5zdGF0dXMsCiAgICAgICAgICAgIG5vdGlmaWVkQXQ6IG5vdGlmaWNhdGlvbi5ub3RpZmllZEF0LAogICAgICAgICAgICBjb21wbGV0ZWRBdDogbm90aWZpY2F0aW9uLmNvbXBsZXRlZEF0LAogICAgICAgICAgICBsb2NhdGlvbnM6IFtsb2NhdGlvbl0sCiAgICAgICAgICB9CgogICAgICAgICAgcmVzdXBwbHlNYXAuc2V0KHByb2R1Y3RLZXksIG5ld0l0ZW0pCiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCByZXN1cHBseUl0ZW1zID0gQXJyYXkuZnJvbShyZXN1cHBseU1hcC52YWx1ZXMoKSkKCiAgICAgIC8vIE9yZGVuYXIgcG9yIGRhdGEgZGUgbm90aWZpY2HDp8OjbwogICAgICByZXN1cHBseUl0ZW1zLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBjb25zdCBhVGltZSA9IGEubm90aWZpZWRBdD8uZ2V0VGltZSgpIHx8IDAKICAgICAgICBjb25zdCBiVGltZSA9IGIubm90aWZpZWRBdD8uZ2V0VGltZSgpIHx8IDAKICAgICAgICByZXR1cm4gYlRpbWUgLSBhVGltZQogICAgICB9KQoKICAgICAgY29uc29sZS5sb2coYFtSRVNVUFBMWV0gRW5jb250cmFkb3MgJHtyZXN1cHBseUl0ZW1zLmxlbmd0aH0gaXRlbnMgbm90aWZpY2Fkb3MgcGFyYSByZXNzdXByaW1lbnRvYCkKICAgICAgcmV0dXJuIHJlc3VwcGx5SXRlbXMKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm8gYW8gYnVzY2FyIGl0ZW5zIGRlIHJlc3N1cHJpbWVudG86IiwgZXJyb3IpCiAgICAgIHJldHVybiBbXQogICAgfQogIH0pCn0KCi8vIEZ1bsOnw6NvIHBhcmEgb2J0ZXIgZXN0YXTDrXN0aWNhcyBkZSByZXNzdXByaW1lbnRvCmV4cG9ydCBjb25zdCBnZXRSZXN1cHBseVN0YXRzID0gYXN5bmMgKCk6IFByb21pc2U8UmVzdXBwbHlTdGF0cz4gPT4gewogIHJldHVybiBwZXJmb3JtYW5jZU1vbml0b3IudHJhY2tPcGVyYXRpb24oImdldFJlc3VwcGx5U3RhdHMiLCBhc3luYyAoKSA9PiB7CiAgICB0cnkgewogICAgICBjb25zdCBub3RpZmljYXRpb25zID0gYXdhaXQgZ2V0UmVzdXBwbHlOb3RpZmljYXRpb25zKCkKCiAgICAgIGNvbnN0IHN0YXRzOiBSZXN1cHBseVN0YXRzID0gewogICAgICAgIHRvdGFsSXRlbXM6IG5vdGlmaWNhdGlvbnMubGVuZ3RoLAogICAgICAgIHBlbmRpbmc6IG5vdGlmaWNhdGlvbnMuZmlsdGVyKChuKSA9PiBuLnN0YXR1cyA9PT0gInBlbmRpbmciKS5sZW5ndGgsCiAgICAgICAgaW5Qcm9ncmVzczogbm90aWZpY2F0aW9ucy5maWx0ZXIoKG4pID0+IG4uc3RhdHVzID09PSAiaW5fcHJvZ3Jlc3MiKS5sZW5ndGgsCiAgICAgICAgY29tcGxldGVkOiBub3RpZmljYXRpb25zLmZpbHRlcigobikgPT4gbi5zdGF0dXMgPT09ICJjb21wbGV0ZWQiKS5sZW5ndGgsCiAgICAgICAgb3V0T2ZTdG9jazogbm90aWZpY2F0aW9ucy5maWx0ZXIoKG4pID0+IG4uc3RhdHVzID09PSAib3V0X29mX3N0b2NrIikubGVuZ3RoLAogICAgICAgIHRvdGFsTG9jYXRpb25zOiBub3RpZmljYXRpb25zLmZpbHRlcigobikgPT4gbi5zdGF0dXMgIT09ICJjb21wbGV0ZWQiKS5sZW5ndGgsCiAgICAgIH0KCiAgICAgIHJldHVybiBzdGF0cwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcigiRXJybyBhbyBjYWxjdWxhciBlc3RhdMOtc3RpY2FzIGRlIHJlc3N1cHJpbWVudG86IiwgZXJyb3IpCiAgICAgIHJldHVybiB7CiAgICAgICAgdG90YWxJdGVtczogMCwKICAgICAgICBwZW5kaW5nOiAwLAogICAgICAgIGluUHJvZ3Jlc3M6IDAsCiAgICAgICAgY29tcGxldGVkOiAwLAogICAgICAgIG91dE9mU3RvY2s6IDAsCiAgICAgICAgdG90YWxMb2NhdGlvbnM6IDAsCiAgICAgIH0KICAgIH0KICB9KQp9Cg=="}