{"data":"aW1wb3J0IFJlZGlzIGZyb20gImlvcmVkaXMiCgovLyBDb25maWd1cmHDp8OjbyBkbyBSZWRpcwpjb25zdCByZWRpcyA9IG5ldyBSZWRpcyhwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgInJlZGlzOi8vbG9jYWxob3N0OjYzNzkiLCB7CiAgcmV0cnlEZWxheU9uRmFpbG92ZXI6IDEwMCwKICBlbmFibGVSZWFkeUNoZWNrOiBmYWxzZSwKICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogbnVsbCwKICBsYXp5Q29ubmVjdDogdHJ1ZSwKICBjb25uZWN0VGltZW91dDogMTAwMDAsCiAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsCn0pCgovLyBUVEwgKFRpbWUgVG8gTGl2ZSkgZW0gc2VndW5kb3MKZXhwb3J0IGNvbnN0IENBQ0hFX1RUTCA9IHsKICBTSE9SVDogNjAsIC8vIDEgbWludXRvCiAgTUVESVVNOiAzMDAsIC8vIDUgbWludXRvcwogIExPTkc6IDE4MDAsIC8vIDMwIG1pbnV0b3MKICBWRVJZX0xPTkc6IDM2MDAsIC8vIDEgaG9yYQp9CgovLyBDaGF2ZXMgZGUgY2FjaGUgb3JnYW5pemFkYXMKZXhwb3J0IGNvbnN0IENBQ0hFX0tFWVMgPSB7CiAgLy8gV2FyZWhvdXNlcwogIFdBUkVIT1VTRVM6ICJ3YXJlaG91c2VzOmFsbCIsCiAgV0FSRUhPVVNFOiAoaWQ6IHN0cmluZykgPT4gYHdhcmVob3VzZToke2lkfWAsCgogIC8vIEFpc2xlcwogIEFJU0xFU19CWV9XQVJFSE9VU0U6ICh3YXJlaG91c2VJZDogc3RyaW5nKSA9PiBgYWlzbGVzOndhcmVob3VzZToke3dhcmVob3VzZUlkfWAsCiAgQUlTTEU6IChpZDogc3RyaW5nKSA9PiBgYWlzbGU6JHtpZH1gLAoKICAvLyBQYWxsZXRzCiAgUEFMTEVUU19CWV9BSVNMRTogKGFpc2xlSWQ6IHN0cmluZykgPT4gYHBhbGxldHM6YWlzbGU6JHthaXNsZUlkfWAsCiAgUEFMTEVUOiAoaWQ6IHN0cmluZykgPT4gYHBhbGxldDoke2lkfWAsCgogIC8vIFNoZWx2ZXMKICBTSEVMVkVTX0JZX0FJU0xFOiAoYWlzbGVJZDogc3RyaW5nKSA9PiBgc2hlbHZlczphaXNsZToke2Fpc2xlSWR9YCwKICBTSEVMRjogKGlkOiBzdHJpbmcpID0+IGBzaGVsZjoke2lkfWAsCgogIC8vIFNlYXJjaAogIFNFQVJDSF9CWV9FQU46IChlYW46IHN0cmluZykgPT4gYHNlYXJjaDplYW46JHtlYW59YCwKICBEVVBMSUNBVEVEX0VBTlM6ICJkdXBsaWNhdGVkOmVhbnMiLAoKICAvLyBQcm9kdWN0cwogIFBST0RVQ1RfQllfRUFOOiAoZWFuOiBzdHJpbmcpID0+IGBwcm9kdWN0OmVhbjoke2Vhbn1gLAogIFBST0RVQ1RfQllfSUQ6IChpZDogc3RyaW5nKSA9PiBgcHJvZHVjdDppZDoke2lkfWAsCiAgUFJPRFVDVF9TRUFSQ0g6IChxdWVyeTogc3RyaW5nKSA9PiBgcHJvZHVjdDpzZWFyY2g6JHtxdWVyeX1gLAoKICAvLyBQYXR0ZXJucyBmb3IgYnVsayBvcGVyYXRpb25zCiAgUEFUVEVSTlM6IHsKICAgIFdBUkVIT1VTRTogKGlkOiBzdHJpbmcpID0+IGAqd2FyZWhvdXNlOiR7aWR9KmAsCiAgICBBSVNMRTogKGlkOiBzdHJpbmcpID0+IGAqYWlzbGU6JHtpZH0qYCwKICAgIFBBTExFVDogKGlkOiBzdHJpbmcpID0+IGAqcGFsbGV0OiR7aWR9KmAsCiAgICBTSEVMRjogKGlkOiBzdHJpbmcpID0+IGAqc2hlbGY6JHtpZH0qYCwKICAgIFNFQVJDSDogIipzZWFyY2g6KiIsCiAgICBQUk9EVUNUUzogIipwcm9kdWN0OioiLAogIH0sCn0KCmNsYXNzIFJlZGlzQ2FjaGUgewogIHByaXZhdGUgaXNDb25uZWN0ZWQgPSBmYWxzZQogIHByaXZhdGUgY29ubmVjdGlvblByb21pc2U6IFByb21pc2U8dm9pZD4gfCBudWxsID0gbnVsbAoKICBhc3luYyBjb25uZWN0KCk6IFByb21pc2U8dm9pZD4gewogICAgaWYgKHRoaXMuaXNDb25uZWN0ZWQpIHJldHVybgogICAgaWYgKHRoaXMuY29ubmVjdGlvblByb21pc2UpIHJldHVybiB0aGlzLmNvbm5lY3Rpb25Qcm9taXNlCgogICAgdGhpcy5jb25uZWN0aW9uUHJvbWlzZSA9IHRoaXMuX2Nvbm5lY3QoKQogICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvblByb21pc2UKICB9CgogIHByaXZhdGUgYXN5bmMgX2Nvbm5lY3QoKTogUHJvbWlzZTx2b2lkPiB7CiAgICB0cnkgewogICAgICBhd2FpdCByZWRpcy5waW5nKCkKICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IHRydWUKICAgICAgY29uc29sZS5sb2coIltSRURJU10g4pyFIENvbmVjdGFkbyBjb20gc3VjZXNzbyIpCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCJbUkVESVNdIOKdjCBFcnJvIGFvIGNvbmVjdGFyOiIsIGVycm9yKQogICAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2UKICAgICAgdGhpcy5jb25uZWN0aW9uUHJvbWlzZSA9IG51bGwKICAgICAgdGhyb3cgZXJyb3IKICAgIH0KICB9CgogIGFzeW5jIGdldDxUID0gYW55PihrZXk6IHN0cmluZyk6IFByb21pc2U8VCB8IG51bGw+IHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpCiAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgcmVkaXMuZ2V0KGtleSkKICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgIGNvbnNvbGUubG9nKGBbUkVESVNdIOKdjCBDYWNoZSBtaXNzOiAke2tleX1gKQogICAgICAgIHJldHVybiBudWxsCiAgICAgIH0KICAgICAgY29uc29sZS5sb2coYFtSRURJU10g4pyFIENhY2hlIGhpdDogJHtrZXl9YCkKICAgICAgcmV0dXJuIEpTT04ucGFyc2UodmFsdWUpCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKGBbUkVESVNdIEVycm8gYW8gYnVzY2FyICR7a2V5fTpgLCBlcnJvcikKICAgICAgcmV0dXJuIG51bGwKICAgIH0KICB9CgogIGFzeW5jIHNldDxUID0gYW55PihrZXk6IHN0cmluZywgdmFsdWU6IFQsIHR0bDogbnVtYmVyID0gQ0FDSEVfVFRMLk1FRElVTSk6IFByb21pc2U8Ym9vbGVhbj4gewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5jb25uZWN0KCkKICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKQogICAgICBhd2FpdCByZWRpcy5zZXRleChrZXksIHR0bCwgc2VyaWFsaXplZCkKICAgICAgY29uc29sZS5sb2coYFtSRURJU10g4pyFIENhY2hlIHNldDogJHtrZXl9IChUVEw6ICR7dHRsfXMpYCkKICAgICAgcmV0dXJuIHRydWUKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoYFtSRURJU10gRXJybyBhbyBzYWx2YXIgJHtrZXl9OmAsIGVycm9yKQogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICB9CgogIGFzeW5jIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4gewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5jb25uZWN0KCkKICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVkaXMuZGVsKGtleSkKICAgICAgY29uc29sZS5sb2coYFtSRURJU10g8J+Xke+4jyBDYWNoZSBkZWxldGVkOiAke2tleX1gKQogICAgICByZXR1cm4gcmVzdWx0ID4gMAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcihgW1JFRElTXSBFcnJvIGFvIGRlbGV0YXIgJHtrZXl9OmAsIGVycm9yKQogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICB9CgogIGFzeW5jIGRlbFBhdHRlcm4ocGF0dGVybjogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpCiAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCByZWRpcy5rZXlzKHBhdHRlcm4pCiAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDAKCiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlZGlzLmRlbCguLi5rZXlzKQogICAgICBjb25zb2xlLmxvZyhgW1JFRElTXSDwn5eR77iPIENhY2hlIHBhdHRlcm4gZGVsZXRlZDogJHtwYXR0ZXJufSAoJHtyZXN1bHR9IGtleXMpYCkKICAgICAgcmV0dXJuIHJlc3VsdAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcihgW1JFRElTXSBFcnJvIGFvIGRlbGV0YXIgcGF0dGVybiAke3BhdHRlcm59OmAsIGVycm9yKQogICAgICByZXR1cm4gMAogICAgfQogIH0KCiAgYXN5bmMgZXhpc3RzKGtleTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKQogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWRpcy5leGlzdHMoa2V5KQogICAgICByZXR1cm4gcmVzdWx0ID09PSAxCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKGBbUkVESVNdIEVycm8gYW8gdmVyaWZpY2FyIGV4aXN0w6puY2lhICR7a2V5fTpgLCBlcnJvcikKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfQoKICBhc3luYyBmbHVzaCgpOiBQcm9taXNlPGJvb2xlYW4+IHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMuY29ubmVjdCgpCiAgICAgIGF3YWl0IHJlZGlzLmZsdXNoYWxsKCkKICAgICAgY29uc29sZS5sb2coIltSRURJU10g8J+nuSBDYWNoZSBsaW1wbyBjb21wbGV0YW1lbnRlIikKICAgICAgcmV0dXJuIHRydWUKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIltSRURJU10gRXJybyBhbyBsaW1wYXIgY2FjaGU6IiwgZXJyb3IpCiAgICAgIHJldHVybiBmYWxzZQogICAgfQogIH0KCiAgYXN5bmMgZ2V0U3RhdHMoKTogUHJvbWlzZTx7CiAgICBjb25uZWN0ZWQ6IGJvb2xlYW4KICAgIG1lbW9yeTogc3RyaW5nCiAgICBrZXlzOiBudW1iZXIKICAgIGhpdHM6IG51bWJlcgogICAgbWlzc2VzOiBudW1iZXIKICB9PiB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKQogICAgICBjb25zdCBpbmZvID0gYXdhaXQgcmVkaXMuaW5mbygibWVtb3J5IikKICAgICAgY29uc3Qga2V5c3BhY2UgPSBhd2FpdCByZWRpcy5pbmZvKCJrZXlzcGFjZSIpCiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgcmVkaXMuaW5mbygic3RhdHMiKQoKICAgICAgLy8gUGFyc2UgbWVtb3J5IGluZm8KICAgICAgY29uc3QgbWVtb3J5TWF0Y2ggPSBpbmZvLm1hdGNoKC91c2VkX21lbW9yeV9odW1hbjooW15cclxuXSspLykKICAgICAgY29uc3QgbWVtb3J5ID0gbWVtb3J5TWF0Y2ggPyBtZW1vcnlNYXRjaFsxXSA6ICJOL0EiCgogICAgICAvLyBQYXJzZSBrZXlzcGFjZSBpbmZvCiAgICAgIGNvbnN0IGtleXNNYXRjaCA9IGtleXNwYWNlLm1hdGNoKC9rZXlzPShcZCspLykKICAgICAgY29uc3Qga2V5cyA9IGtleXNNYXRjaCA/IE51bWJlci5wYXJzZUludChrZXlzTWF0Y2hbMV0pIDogMAoKICAgICAgLy8gUGFyc2Ugc3RhdHMKICAgICAgY29uc3QgaGl0c01hdGNoID0gc3RhdHMubWF0Y2goL2tleXNwYWNlX2hpdHM6KFxkKykvKQogICAgICBjb25zdCBtaXNzZXNNYXRjaCA9IHN0YXRzLm1hdGNoKC9rZXlzcGFjZV9taXNzZXM6KFxkKykvKQogICAgICBjb25zdCBoaXRzID0gaGl0c01hdGNoID8gTnVtYmVyLnBhcnNlSW50KGhpdHNNYXRjaFsxXSkgOiAwCiAgICAgIGNvbnN0IG1pc3NlcyA9IG1pc3Nlc01hdGNoID8gTnVtYmVyLnBhcnNlSW50KG1pc3Nlc01hdGNoWzFdKSA6IDAKCiAgICAgIHJldHVybiB7CiAgICAgICAgY29ubmVjdGVkOiB0aGlzLmlzQ29ubmVjdGVkLAogICAgICAgIG1lbW9yeSwKICAgICAgICBrZXlzLAogICAgICAgIGhpdHMsCiAgICAgICAgbWlzc2VzLAogICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCJbUkVESVNdIEVycm8gYW8gb2J0ZXIgZXN0YXTDrXN0aWNhczoiLCBlcnJvcikKICAgICAgcmV0dXJuIHsKICAgICAgICBjb25uZWN0ZWQ6IGZhbHNlLAogICAgICAgIG1lbW9yeTogIk4vQSIsCiAgICAgICAga2V5czogMCwKICAgICAgICBoaXRzOiAwLAogICAgICAgIG1pc3NlczogMCwKICAgICAgfQogICAgfQogIH0KCiAgLy8gTcOpdG9kbyBwYXJhIGludmFsaWRhciBjYWNoZSByZWxhY2lvbmFkbwogIGFzeW5jIGludmFsaWRhdGVSZWxhdGVkKGVudGl0eVR5cGU6ICJ3YXJlaG91c2UiIHwgImFpc2xlIiB8ICJwYWxsZXQiIHwgInNoZWxmIiwgZW50aXR5SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gewogICAgdHJ5IHsKICAgICAgc3dpdGNoIChlbnRpdHlUeXBlKSB7CiAgICAgICAgY2FzZSAid2FyZWhvdXNlIjoKICAgICAgICAgIGF3YWl0IHRoaXMuZGVsUGF0dGVybihDQUNIRV9LRVlTLlBBVFRFUk5TLldBUkVIT1VTRShlbnRpdHlJZCkpCiAgICAgICAgICBhd2FpdCB0aGlzLmRlbChDQUNIRV9LRVlTLldBUkVIT1VTRVMpCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgImFpc2xlIjoKICAgICAgICAgIGF3YWl0IHRoaXMuZGVsUGF0dGVybihDQUNIRV9LRVlTLlBBVFRFUk5TLkFJU0xFKGVudGl0eUlkKSkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAicGFsbGV0IjoKICAgICAgICAgIGF3YWl0IHRoaXMuZGVsUGF0dGVybihDQUNIRV9LRVlTLlBBVFRFUk5TLlBBTExFVChlbnRpdHlJZCkpCiAgICAgICAgICBhd2FpdCB0aGlzLmRlbFBhdHRlcm4oQ0FDSEVfS0VZUy5QQVRURVJOUy5TRUFSQ0gpCiAgICAgICAgICBhd2FpdCB0aGlzLmRlbChDQUNIRV9LRVlTLkRVUExJQ0FURURfRUFOUykKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAic2hlbGYiOgogICAgICAgICAgYXdhaXQgdGhpcy5kZWxQYXR0ZXJuKENBQ0hFX0tFWVMuUEFUVEVSTlMuU0hFTEYoZW50aXR5SWQpKQogICAgICAgICAgYXdhaXQgdGhpcy5kZWxQYXR0ZXJuKENBQ0hFX0tFWVMuUEFUVEVSTlMuU0VBUkNIKQogICAgICAgICAgYXdhaXQgdGhpcy5kZWwoQ0FDSEVfS0VZUy5EVVBMSUNBVEVEX0VBTlMpCiAgICAgICAgICBicmVhawogICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKGBbUkVESVNdIEVycm8gYW8gaW52YWxpZGFyIGNhY2hlIHJlbGFjaW9uYWRvIHBhcmEgJHtlbnRpdHlUeXBlfToke2VudGl0eUlkfTpgLCBlcnJvcikKICAgIH0KICB9Cn0KCmV4cG9ydCBjb25zdCByZWRpc0NhY2hlID0gbmV3IFJlZGlzQ2FjaGUoKQoKLy8gRnVuw6fDo28gaGVscGVyIHBhcmEgb3BlcmHDp8O1ZXMgY29tIGZhbGxiYWNrCmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3aXRoQ2FjaGU8VD4oa2V5OiBzdHJpbmcsIGZldGNoRm46ICgpID0+IFByb21pc2U8VD4sIHR0bDogbnVtYmVyID0gQ0FDSEVfVFRMLk1FRElVTSk6IFByb21pc2U8VD4gewogIHRyeSB7CiAgICAvLyBUZW50YXIgYnVzY2FyIGRvIGNhY2hlIHByaW1laXJvCiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCByZWRpc0NhY2hlLmdldDxUPihrZXkpCiAgICBpZiAoY2FjaGVkICE9PSBudWxsKSB7CiAgICAgIHJldHVybiBjYWNoZWQKICAgIH0KCiAgICAvLyBTZSBuw6NvIGVuY29udHJvdSBubyBjYWNoZSwgYnVzY2FyIGRvcyBkYWRvcyBvcmlnaW5haXMKICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmZXRjaEZuKCkKCiAgICAvLyBTYWx2YXIgbm8gY2FjaGUgcGFyYSBwcsOzeGltYXMgY29uc3VsdGFzCiAgICBhd2FpdCByZWRpc0NhY2hlLnNldChrZXksIGRhdGEsIHR0bCkKCiAgICByZXR1cm4gZGF0YQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKGBbQ0FDSEVdIEVycm8gbmEgb3BlcmHDp8OjbyBjb20gY2FjaGUgcGFyYSAke2tleX06YCwgZXJyb3IpCiAgICAvLyBFbSBjYXNvIGRlIGVycm8sIHRlbnRhciBidXNjYXIgZGlyZXRhbWVudGUKICAgIHJldHVybiBhd2FpdCBmZXRjaEZuKCkKICB9Cn0K"}