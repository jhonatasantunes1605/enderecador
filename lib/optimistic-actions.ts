{"data":"aW1wb3J0IHsgdXNlQXBwU3RvcmUgfSBmcm9tICIuL3N0b3JlIg0KaW1wb3J0ICogYXMgc2VydmVyQWN0aW9ucyBmcm9tICJAL2FwcC9hY3Rpb25zIg0KDQpleHBvcnQgZnVuY3Rpb24gdXNlT3B0aW1pc3RpY0FjdGlvbnMoKSB7DQogIGNvbnN0IHN0b3JlID0gdXNlQXBwU3RvcmUoKQ0KDQogIGNvbnN0IGNyZWF0ZVdhcmVob3VzZU9wdGltaXN0aWMgPSBhc3luYyAoZm9ybURhdGE6IEZvcm1EYXRhKSA9PiB7DQogICAgY29uc3QgbmFtZSA9IGZvcm1EYXRhLmdldCgibmFtZSIpIGFzIHN0cmluZw0KICAgIGlmICghbmFtZT8udHJpbSgpKSByZXR1cm4geyBtZXNzYWdlOiAiTm9tZSDDqSBvYnJpZ2F0w7NyaW8iLCBzdWNjZXNzOiBmYWxzZSB9DQoNCiAgICAvLyBPcHRpbWlzdGljIHVwZGF0ZQ0KICAgIGNvbnN0IHRlbXBXYXJlaG91c2UgPSB7DQogICAgICBpZDogYHRlbXAtJHtEYXRlLm5vdygpfWAsDQogICAgICBuYW1lOiBuYW1lLnRyaW0oKSwNCiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgIH0NCiAgICBzdG9yZS5hZGRXYXJlaG91c2UodGVtcFdhcmVob3VzZSkNCg0KICAgIHRyeSB7DQogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2ZXJBY3Rpb25zLmNyZWF0ZVdhcmVob3VzZSh7fSwgZm9ybURhdGEpDQogICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsNCiAgICAgICAgLy8gUmVwbGFjZSB0ZW1wIHdpdGggcmVhbCBkYXRhIChzZXJ2ZXIgd2lsbCBwcm92aWRlIHJlYWwgSUQpDQogICAgICAgIHN0b3JlLnJlbW92ZVdhcmVob3VzZSh0ZW1wV2FyZWhvdXNlLmlkKQ0KICAgICAgICAvLyBUaGUgcmVhbCB3YXJlaG91c2Ugd2lsbCBiZSBhZGRlZCB3aGVuIGRhdGEgcmVmcmVzaGVzDQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBSZXZlcnQgb3B0aW1pc3RpYyB1cGRhdGUgb24gZmFpbHVyZQ0KICAgICAgICBzdG9yZS5yZW1vdmVXYXJlaG91c2UodGVtcFdhcmVob3VzZS5pZCkNCiAgICAgIH0NCiAgICAgIHJldHVybiByZXN1bHQNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgLy8gUmV2ZXJ0IG9wdGltaXN0aWMgdXBkYXRlIG9uIGVycm9yDQogICAgICBzdG9yZS5yZW1vdmVXYXJlaG91c2UodGVtcFdhcmVob3VzZS5pZCkNCiAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICJFcnJvIGFvIGNyaWFyIGdhbHDDo28iLCBzdWNjZXNzOiBmYWxzZSB9DQogICAgfQ0KICB9DQoNCiAgY29uc3QgZGVsZXRlV2FyZWhvdXNlT3B0aW1pc3RpYyA9IGFzeW5jICh3YXJlaG91c2VJZDogc3RyaW5nLCBmb3JtRGF0YTogRm9ybURhdGEpID0+IHsNCiAgICAvLyBTdG9yZSBvcmlnaW5hbCBkYXRhIGZvciByb2xsYmFjaw0KICAgIGNvbnN0IG9yaWdpbmFsV2FyZWhvdXNlcyA9IHN0b3JlLndhcmVob3VzZXMNCg0KICAgIC8vIE9wdGltaXN0aWMgdXBkYXRlDQogICAgc3RvcmUucmVtb3ZlV2FyZWhvdXNlKHdhcmVob3VzZUlkKQ0KDQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZlckFjdGlvbnMuZGVsZXRlV2FyZWhvdXNlQWN0aW9uKHdhcmVob3VzZUlkLCB7fSwgZm9ybURhdGEpDQogICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7DQogICAgICAgIC8vIFJldmVydCBvbiBmYWlsdXJlDQogICAgICAgIHN0b3JlLnNldFdhcmVob3VzZXMob3JpZ2luYWxXYXJlaG91c2VzKQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdA0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAvLyBSZXZlcnQgb24gZXJyb3INCiAgICAgIHN0b3JlLnNldFdhcmVob3VzZXMob3JpZ2luYWxXYXJlaG91c2VzKQ0KICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIkVycm8gYW8gZGVsZXRhciBnYWxww6NvIiwgc3VjY2VzczogZmFsc2UgfQ0KICAgIH0NCiAgfQ0KDQogIGNvbnN0IGNyZWF0ZUFpc2xlT3B0aW1pc3RpYyA9IGFzeW5jICh3YXJlaG91c2VJZDogc3RyaW5nLCBmb3JtRGF0YTogRm9ybURhdGEpID0+IHsNCiAgICBjb25zdCBuYW1lID0gZm9ybURhdGEuZ2V0KCJuYW1lIikgYXMgc3RyaW5nDQogICAgY29uc3Qgbm90ZXMgPSBmb3JtRGF0YS5nZXQoIm5vdGVzIikgYXMgc3RyaW5nIHwgbnVsbA0KICAgIGNvbnN0IGNhcGFjaXR5ID0gTnVtYmVyKGZvcm1EYXRhLmdldCgiY2FwYWNpdHkiKSkgfHwgMA0KICAgIGNvbnN0IHN0b3JhZ2VUeXBlID0gKGZvcm1EYXRhLmdldCgic3RvcmFnZVR5cGUiKSBhcyAicGFsbGV0IiB8ICJzaGVsZiIpIHx8ICJwYWxsZXQiDQogICAgY29uc3Qgc2hlbGZMZXZlbHMgPSBOdW1iZXIoZm9ybURhdGEuZ2V0KCJzaGVsZkxldmVscyIpKSB8fCAxDQoNCiAgICBpZiAoIW5hbWU/LnRyaW0oKSkgcmV0dXJuIHsgbWVzc2FnZTogIk5vbWUgw6kgb2JyaWdhdMOzcmlvIiwgc3VjY2VzczogZmFsc2UgfQ0KDQogICAgLy8gT3B0aW1pc3RpYyB1cGRhdGUNCiAgICBjb25zdCB0ZW1wQWlzbGUgPSB7DQogICAgICBpZDogYHRlbXAtJHtEYXRlLm5vdygpfWAsDQogICAgICB3YXJlaG91c2VJZCwNCiAgICAgIG5hbWU6IG5hbWUudHJpbSgpLA0KICAgICAgbm90ZXM6IG5vdGVzPy50cmltKCkgfHwgdW5kZWZpbmVkLA0KICAgICAgY2FwYWNpdHksDQogICAgICBzdG9yYWdlVHlwZSwNCiAgICAgIHNoZWxmTGV2ZWxzLA0KICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksDQogICAgfQ0KICAgIHN0b3JlLmFkZEFpc2xlKHRlbXBBaXNsZSkNCg0KICAgIHRyeSB7DQogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2ZXJBY3Rpb25zLmNyZWF0ZUFpc2xlKHdhcmVob3VzZUlkLCB7fSwgZm9ybURhdGEpDQogICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsNCiAgICAgICAgLy8gUmVtb3ZlIHRlbXAgYWlzbGUgKHJlYWwgb25lIHdpbGwgYmUgYWRkZWQgd2hlbiBkYXRhIHJlZnJlc2hlcykNCiAgICAgICAgY29uc3QgY3VycmVudEFpc2xlcyA9IHN0b3JlLmFpc2xlc1t3YXJlaG91c2VJZF0gfHwgW10NCiAgICAgICAgc3RvcmUuc2V0QWlzbGVzKA0KICAgICAgICAgIHdhcmVob3VzZUlkLA0KICAgICAgICAgIGN1cnJlbnRBaXNsZXMuZmlsdGVyKChhKSA9PiBhLmlkICE9PSB0ZW1wQWlzbGUuaWQpLA0KICAgICAgICApDQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBSZXZlcnQgb3B0aW1pc3RpYyB1cGRhdGUNCiAgICAgICAgY29uc3QgY3VycmVudEFpc2xlcyA9IHN0b3JlLmFpc2xlc1t3YXJlaG91c2VJZF0gfHwgW10NCiAgICAgICAgc3RvcmUuc2V0QWlzbGVzKA0KICAgICAgICAgIHdhcmVob3VzZUlkLA0KICAgICAgICAgIGN1cnJlbnRBaXNsZXMuZmlsdGVyKChhKSA9PiBhLmlkICE9PSB0ZW1wQWlzbGUuaWQpLA0KICAgICAgICApDQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIC8vIFJldmVydCBvcHRpbWlzdGljIHVwZGF0ZQ0KICAgICAgY29uc3QgY3VycmVudEFpc2xlcyA9IHN0b3JlLmFpc2xlc1t3YXJlaG91c2VJZF0gfHwgW10NCiAgICAgIHN0b3JlLnNldEFpc2xlcygNCiAgICAgICAgd2FyZWhvdXNlSWQsDQogICAgICAgIGN1cnJlbnRBaXNsZXMuZmlsdGVyKChhKSA9PiBhLmlkICE9PSB0ZW1wQWlzbGUuaWQpLA0KICAgICAgKQ0KICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIkVycm8gYW8gY3JpYXIgcnVhIiwgc3VjY2VzczogZmFsc2UgfQ0KICAgIH0NCiAgfQ0KDQogIGNvbnN0IGFkZFBhbGxldE9wdGltaXN0aWMgPSBhc3luYyAoYWlzbGVJZDogc3RyaW5nLCBmb3JtRGF0YTogRm9ybURhdGEpID0+IHsNCiAgICBjb25zdCBjdXJyZW50UGFsbGV0cyA9IHN0b3JlLnBhbGxldHNbYWlzbGVJZF0gfHwgW10NCiAgICBjb25zdCBuZXh0UG9zaXRpb24gPSBjdXJyZW50UGFsbGV0cy5sZW5ndGggPiAwID8gTWF0aC5tYXgoLi4uY3VycmVudFBhbGxldHMubWFwKChwKSA9PiBwLnBvc2l0aW9uKSkgKyAxIDogMQ0KDQogICAgLy8gT3B0aW1pc3RpYyB1cGRhdGUNCiAgICBjb25zdCB0ZW1wUGFsbGV0ID0gew0KICAgICAgaWQ6IGB0ZW1wLSR7RGF0ZS5ub3coKX1gLA0KICAgICAgYWlzbGVJZCwNCiAgICAgIHBvc2l0aW9uOiBuZXh0UG9zaXRpb24sDQogICAgICBpc1ZlcmlmaWVkOiBmYWxzZSwNCiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgIH0NCiAgICBzdG9yZS5hZGRQYWxsZXQodGVtcFBhbGxldCkNCg0KICAgIHRyeSB7DQogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2ZXJBY3Rpb25zLmFkZFNpbmdsZVBhbGxldChhaXNsZUlkLCB7fSwgZm9ybURhdGEpDQogICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsNCiAgICAgICAgLy8gUmVtb3ZlIHRlbXAgcGFsbGV0IChyZWFsIG9uZSB3aWxsIGJlIGFkZGVkIHdoZW4gZGF0YSByZWZyZXNoZXMpDQogICAgICAgIHN0b3JlLnJlbW92ZVBhbGxldCh0ZW1wUGFsbGV0LmlkKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gUmV2ZXJ0IG9wdGltaXN0aWMgdXBkYXRlDQogICAgICAgIHN0b3JlLnJlbW92ZVBhbGxldCh0ZW1wUGFsbGV0LmlkKQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdA0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAvLyBSZXZlcnQgb3B0aW1pc3RpYyB1cGRhdGUNCiAgICAgIHN0b3JlLnJlbW92ZVBhbGxldCh0ZW1wUGFsbGV0LmlkKQ0KICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIkVycm8gYW8gYWRpY2lvbmFyIHBhbGV0ZSIsIHN1Y2Nlc3M6IGZhbHNlIH0NCiAgICB9DQogIH0NCg0KICBjb25zdCBhc3NpZ25Qcm9kdWN0VG9QYWxsZXRPcHRpbWlzdGljID0gYXN5bmMgKHBhbGxldElkOiBzdHJpbmcsIGZvcm1EYXRhOiBGb3JtRGF0YSkgPT4gew0KICAgIGNvbnN0IGVhbiA9IGZvcm1EYXRhLmdldCgiZWFuIikgYXMgc3RyaW5nDQogICAgY29uc3QgcHJvZHVjdE5hbWUgPSBmb3JtRGF0YS5nZXQoInByb2R1Y3ROYW1lIikgYXMgc3RyaW5nDQogICAgY29uc3QgcHJvZHVjdENhdGVnb3J5ID0gZm9ybURhdGEuZ2V0KCJwcm9kdWN0Q2F0ZWdvcnkiKSBhcyBzdHJpbmcNCiAgICBjb25zdCBwcm9kdWN0RWFuID0gZm9ybURhdGEuZ2V0KCJwcm9kdWN0RWFuIikgYXMgc3RyaW5nDQoNCiAgICBpZiAoIWVhbj8udHJpbSgpIHx8ICFwcm9kdWN0TmFtZT8udHJpbSgpKSB7DQogICAgICByZXR1cm4geyBtZXNzYWdlOiAiRUFOIGUgbm9tZSBkbyBwcm9kdXRvIHPDo28gb2JyaWdhdMOzcmlvcyIsIHN1Y2Nlc3M6IGZhbHNlIH0NCiAgICB9DQoNCiAgICAvLyBTdG9yZSBvcmlnaW5hbCBwYWxsZXQgZm9yIHJvbGxiYWNrDQogICAgY29uc3QgY3VycmVudFBhbGxldHMgPSBzdG9yZS5wYWxsZXRzDQogICAgbGV0IG9yaWdpbmFsUGFsbGV0OiBhbnkgPSBudWxsDQogICAgT2JqZWN0LnZhbHVlcyhjdXJyZW50UGFsbGV0cykuZm9yRWFjaCgocGFsbGV0cykgPT4gew0KICAgICAgY29uc3QgZm91bmQgPSBwYWxsZXRzLmZpbmQoKHApID0+IHAuaWQgPT09IHBhbGxldElkKQ0KICAgICAgaWYgKGZvdW5kKSBvcmlnaW5hbFBhbGxldCA9IHsgLi4uZm91bmQgfQ0KICAgIH0pDQoNCiAgICAvLyBPcHRpbWlzdGljIHVwZGF0ZQ0KICAgIHN0b3JlLnVwZGF0ZVBhbGxldChwYWxsZXRJZCwgew0KICAgICAgZWFuOiBlYW4udHJpbSgpLA0KICAgICAgcHJvZHVjdE5hbWU6IHByb2R1Y3ROYW1lLnRyaW0oKSwNCiAgICAgIGNhdGVnb3J5OiBwcm9kdWN0Q2F0ZWdvcnk/LnRyaW0oKSB8fCB1bmRlZmluZWQsDQogICAgICBlYW4xMzogcHJvZHVjdEVhbj8udHJpbSgpIHx8IHVuZGVmaW5lZCwNCiAgICB9KQ0KDQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZlckFjdGlvbnMuYXNzaWduUHJvZHVjdFRvUGFsbGV0KHBhbGxldElkLCB7fSwgZm9ybURhdGEpDQogICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzICYmIG9yaWdpbmFsUGFsbGV0KSB7DQogICAgICAgIC8vIFJldmVydCBvbiBmYWlsdXJlDQogICAgICAgIHN0b3JlLnVwZGF0ZVBhbGxldChwYWxsZXRJZCwgb3JpZ2luYWxQYWxsZXQpDQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIC8vIFJldmVydCBvbiBlcnJvcg0KICAgICAgaWYgKG9yaWdpbmFsUGFsbGV0KSB7DQogICAgICAgIHN0b3JlLnVwZGF0ZVBhbGxldChwYWxsZXRJZCwgb3JpZ2luYWxQYWxsZXQpDQogICAgICB9DQogICAgICByZXR1cm4geyBtZXNzYWdlOiAiRXJybyBhbyBhdHJpYnVpciBwcm9kdXRvIiwgc3VjY2VzczogZmFsc2UgfQ0KICAgIH0NCiAgfQ0KDQogIGNvbnN0IHNlYXJjaFByb2R1Y3RPcHRpbWlzdGljID0gYXN5bmMgKGZvcm1EYXRhOiBGb3JtRGF0YSkgPT4gew0KICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBmb3JtRGF0YS5nZXQoImVhbiIpIGFzIHN0cmluZw0KICAgIGlmICghc2VhcmNoVGVybT8udHJpbSgpKSB7DQogICAgICByZXR1cm4geyBtZXNzYWdlOiAiUG9yIGZhdm9yLCBpbnNpcmEgdW0gRUFOIG91IElEIHBhcmEgcGVzcXVpc2FyLiIsIHN1Y2Nlc3M6IGZhbHNlLCByZXN1bHRzOiBbXSB9DQogICAgfQ0KDQogICAgLy8gU2V0IGxvYWRpbmcgc3RhdGUNCiAgICBzdG9yZS5zZXRMb2FkaW5nKCJzZWFyY2giLCB0cnVlKQ0KDQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZlckFjdGlvbnMuc2VhcmNoUHJvZHVjdEJ5RUFOKHsgbWVzc2FnZTogIiIsIHN1Y2Nlc3M6IGZhbHNlIH0sIGZvcm1EYXRhKQ0KDQogICAgICAvLyBVcGRhdGUgc2VhcmNoIHJlc3VsdHMNCiAgICAgIHN0b3JlLnNldFNlYXJjaFJlc3VsdHMocmVzdWx0LnJlc3VsdHMgfHwgW10pDQoNCiAgICAgIHJldHVybiByZXN1bHQNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIkVycm8gYW8gYnVzY2FyIHByb2R1dG8iLCBzdWNjZXNzOiBmYWxzZSwgcmVzdWx0czogW10gfQ0KICAgIH0gZmluYWxseSB7DQogICAgICBzdG9yZS5zZXRMb2FkaW5nKCJzZWFyY2giLCBmYWxzZSkNCiAgICB9DQogIH0NCg0KICBjb25zdCBzZWFyY2hBZGRyZXNzT3B0aW1pc3RpYyA9IGFzeW5jIChmb3JtRGF0YTogRm9ybURhdGEpID0+IHsNCiAgICBjb25zdCBhZGRyZXNzID0gZm9ybURhdGEuZ2V0KCJhZGRyZXNzIikgYXMgc3RyaW5nDQogICAgaWYgKCFhZGRyZXNzPy50cmltKCkpIHsNCiAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICJQb3IgZmF2b3IsIGluc2lyYSB1bSBlbmRlcmXDp28gcGFyYSBwZXNxdWlzYXIuIiwgc3VjY2VzczogZmFsc2UsIHJlc3VsdDogbnVsbCB9DQogICAgfQ0KDQogICAgLy8gU2V0IGxvYWRpbmcgc3RhdGUNCiAgICBzdG9yZS5zZXRMb2FkaW5nKCJhZGRyZXNzU2VhcmNoIiwgdHJ1ZSkNCg0KICAgIHRyeSB7DQogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2ZXJBY3Rpb25zLnNlYXJjaEJ5QWRkcmVzcyh7IG1lc3NhZ2U6ICIiLCBzdWNjZXNzOiBmYWxzZSB9LCBmb3JtRGF0YSkNCg0KICAgICAgLy8gVXBkYXRlIGFkZHJlc3Mgc2VhcmNoIHJlc3VsdA0KICAgICAgc3RvcmUuc2V0QWRkcmVzc1NlYXJjaFJlc3VsdChyZXN1bHQucmVzdWx0IHx8IG51bGwpDQoNCiAgICAgIHJldHVybiByZXN1bHQNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgcmV0dXJuIHsgbWVzc2FnZTogIkVycm8gYW8gYnVzY2FyIGVuZGVyZcOnbyIsIHN1Y2Nlc3M6IGZhbHNlLCByZXN1bHQ6IG51bGwgfQ0KICAgIH0gZmluYWxseSB7DQogICAgICBzdG9yZS5zZXRMb2FkaW5nKCJhZGRyZXNzU2VhcmNoIiwgZmFsc2UpDQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIHsNCiAgICBjcmVhdGVXYXJlaG91c2VPcHRpbWlzdGljLA0KICAgIGRlbGV0ZVdhcmVob3VzZU9wdGltaXN0aWMsDQogICAgY3JlYXRlQWlzbGVPcHRpbWlzdGljLA0KICAgIGFkZFBhbGxldE9wdGltaXN0aWMsDQogICAgYXNzaWduUHJvZHVjdFRvUGFsbGV0T3B0aW1pc3RpYywNCiAgICBzZWFyY2hQcm9kdWN0T3B0aW1pc3RpYywNCiAgICBzZWFyY2hBZGRyZXNzT3B0aW1pc3RpYywNCiAgfQ0KfQo="}