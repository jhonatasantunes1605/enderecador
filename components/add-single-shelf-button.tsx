{"data":"InVzZSBjbGllbnQiCgppbXBvcnQgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0IH0gZnJvbSAicmVhY3QiCmltcG9ydCB7IHVzZUFjdGlvblN0YXRlIH0gZnJvbSAicmVhY3QiCmltcG9ydCB7IHVzZUZvcm1TdGF0dXMgfSBmcm9tICJyZWFjdC1kb20iCmltcG9ydCB7IHVzZVJvdXRlciB9IGZyb20gIm5leHQvbmF2aWdhdGlvbiIKaW1wb3J0IHsgYWRkU2luZ2xlU2hlbGYgfSBmcm9tICJAL2FwcC9hY3Rpb25zIgppbXBvcnQgeyBCdXR0b24gfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvYnV0dG9uIgppbXBvcnQgeyBQbHVzIH0gZnJvbSAibHVjaWRlLXJlYWN0IgppbXBvcnQgeyB0b2FzdCB9IGZyb20gIkAvaG9va3MvdXNlLXRvYXN0IgppbXBvcnQgewogIERpYWxvZywKICBEaWFsb2dDb250ZW50LAogIERpYWxvZ0Rlc2NyaXB0aW9uLAogIERpYWxvZ0hlYWRlciwKICBEaWFsb2dUaXRsZSwKICBEaWFsb2dUcmlnZ2VyLAp9IGZyb20gIkAvY29tcG9uZW50cy91aS9kaWFsb2ciCgpmdW5jdGlvbiBTdWJtaXRCdXR0b24oKSB7CiAgY29uc3QgeyBwZW5kaW5nIH0gPSB1c2VGb3JtU3RhdHVzKCkKICByZXR1cm4gKAogICAgPEJ1dHRvbiB0eXBlPSJzdWJtaXQiIGFyaWEtZGlzYWJsZWQ9e3BlbmRpbmd9IGNsYXNzTmFtZT0idy1mdWxsIj4KICAgICAge3BlbmRpbmcgPyAiQWRpY2lvbmFuZG8uLi4iIDogIkFkaWNpb25hciBQcmF0ZWxlaXJhIn0KICAgIDwvQnV0dG9uPgogICkKfQoKZXhwb3J0IGZ1bmN0aW9uIEFkZFNpbmdsZVNoZWxmQnV0dG9uKHsgYWlzbGVJZCwgc2hlbGZMZXZlbHMgfTogeyBhaXNsZUlkOiBzdHJpbmc7IHNoZWxmTGV2ZWxzOiBudW1iZXIgfSkgewogIGNvbnN0IFtzdGF0ZSwgZm9ybUFjdGlvbl0gPSB1c2VBY3Rpb25TdGF0ZShhZGRTaW5nbGVTaGVsZi5iaW5kKG51bGwsIGFpc2xlSWQpLCB7IG1lc3NhZ2U6ICIiIH0pCiAgY29uc3QgW2lzRGlhbG9nT3Blbiwgc2V0SXNEaWFsb2dPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFthZGRFeHRyYUxldmVsLCBzZXRBZGRFeHRyYUxldmVsXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpCgogIGNvbnN0IHNhdmVTY3JvbGxQb3NpdGlvbiA9ICgpID0+IHsKICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oInNjcm9sbFBvc2l0aW9uIiwgd2luZG93LnNjcm9sbFkudG9TdHJpbmcoKSkKICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oCiAgICAgICJleHBhbmRlZFBvc2l0aW9ucyIsCiAgICAgIEpTT04uc3RyaW5naWZ5KAogICAgICAgIEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZXhwYW5kZWQ9InRydWUiXScpKS5tYXAoKGVsKSA9PiBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtcG9zaXRpb24iKSksCiAgICAgICksCiAgICApCiAgfQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHN0YXRlLm1lc3NhZ2UpIHsKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiBzdGF0ZS5tZXNzYWdlLAogICAgICAgIHZhcmlhbnQ6IHN0YXRlLm1lc3NhZ2UuaW5jbHVkZXMoInN1Y2Vzc28iKSA/ICJkZWZhdWx0IiA6ICJkZXN0cnVjdGl2ZSIsCiAgICAgIH0pCiAgICAgIGlmIChzdGF0ZS5tZXNzYWdlLmluY2x1ZGVzKCJzdWNlc3NvIikpIHsKICAgICAgICBzZXRJc0RpYWxvZ09wZW4oZmFsc2UpCiAgICAgICAgc2F2ZVNjcm9sbFBvc2l0aW9uKCkKICAgICAgICByb3V0ZXIucmVmcmVzaCgpCgogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgY29uc3Qgc2F2ZWRQb3NpdGlvbiA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInNjcm9sbFBvc2l0aW9uIikKICAgICAgICAgIGNvbnN0IGV4cGFuZGVkUG9zaXRpb25zID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJleHBhbmRlZFBvc2l0aW9ucyIpIHx8ICJbXSIpCgogICAgICAgICAgaWYgKHNhdmVkUG9zaXRpb24pIHsKICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIE51bWJlci5wYXJzZUludChzYXZlZFBvc2l0aW9uKSkKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgic2Nyb2xsUG9zaXRpb24iKQogICAgICAgICAgfQoKICAgICAgICAgIC8vIFJlc3RvcmUgZXhwYW5kZWQgcG9zaXRpb25zCiAgICAgICAgICBleHBhbmRlZFBvc2l0aW9ucy5mb3JFYWNoKChwb3NpdGlvbjogc3RyaW5nKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1wb3NpdGlvbj0iJHtwb3NpdGlvbn0iXWApCiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgZWxlbWVudC5jbGljaygpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCJleHBhbmRlZFBvc2l0aW9ucyIpCiAgICAgICAgfSwgMTAwKQogICAgICB9CiAgICB9CiAgfSwgW3N0YXRlLCByb3V0ZXJdKQoKICBjb25zdCBoYW5kbGVTdWJtaXQgPSBhc3luYyAoZm9ybURhdGE6IEZvcm1EYXRhKSA9PiB7CiAgICBpZiAoYWRkRXh0cmFMZXZlbCkgewogICAgICBmb3JtRGF0YS5hcHBlbmQoImFkZEV4dHJhTGV2ZWwiLCAidHJ1ZSIpCiAgICB9CiAgICBhd2FpdCBmb3JtQWN0aW9uKGZvcm1EYXRhKQogIH0KCiAgcmV0dXJuICgKICAgIDxEaWFsb2cgb3Blbj17aXNEaWFsb2dPcGVufSBvbk9wZW5DaGFuZ2U9e3NldElzRGlhbG9nT3Blbn0+CiAgICAgIDxEaWFsb2dUcmlnZ2VyIGFzQ2hpbGQ+CiAgICAgICAgPEJ1dHRvbgogICAgICAgICAgdmFyaWFudD0iZ2hvc3QiCiAgICAgICAgICBzaXplPSJzbSIKICAgICAgICAgIGNsYXNzTmFtZT0iaC04IHB4LTIgdGV4dC14cyB0ZXh0LWdyYXktNjAwIGhvdmVyOnRleHQtZ3JheS05MDAgaG92ZXI6YmctZ3JheS0xMDAgZGFyazp0ZXh0LWdyYXktNDAwIGRhcms6aG92ZXI6dGV4dC1ncmF5LTEwMCBkYXJrOmhvdmVyOmJnLWdyYXktODAwIgogICAgICAgID4KICAgICAgICAgIDxQbHVzIGNsYXNzTmFtZT0iaC0zIHctMyBtci0xIiAvPgogICAgICAgICAgUHJhdGVsZWlyYQogICAgICAgIDwvQnV0dG9uPgogICAgICA8L0RpYWxvZ1RyaWdnZXI+CiAgICAgIDxEaWFsb2dDb250ZW50IGNsYXNzTmFtZT0ic206bWF4LXctWzQwMHB4XSI+CiAgICAgICAgPERpYWxvZ0hlYWRlcj4KICAgICAgICAgIDxEaWFsb2dUaXRsZT5BZGljaW9uYXIgTm92YSBQcmF0ZWxlaXJhPC9EaWFsb2dUaXRsZT4KICAgICAgICAgIDxEaWFsb2dEZXNjcmlwdGlvbj5Db25maWd1cmFyIG5vdmEgcHJhdGVsZWlyYSBwYXJhIGVzdGEgcnVhLjwvRGlhbG9nRGVzY3JpcHRpb24+CiAgICAgICAgPC9EaWFsb2dIZWFkZXI+CiAgICAgICAgPGZvcm0gYWN0aW9uPXtoYW5kbGVTdWJtaXR9IGNsYXNzTmFtZT0iZ3JpZCBnYXAtNCBweS00Ij4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTMiPgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbSB0ZXh0LW11dGVkLWZvcmVncm91bmQiPgogICAgICAgICAgICAgIEEgcHJhdGVsZWlyYSBzZXLDoSBhZGljaW9uYWRhIG5hIHByw7N4aW1hIHBvc2nDp8OjbyBkaXNwb27DrXZlbCBkYSBydWEuCiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMiI+CiAgICAgICAgICAgICAgPGlucHV0CiAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIKICAgICAgICAgICAgICAgIGlkPSJhZGRFeHRyYUxldmVsIgogICAgICAgICAgICAgICAgY2hlY2tlZD17YWRkRXh0cmFMZXZlbH0KICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0QWRkRXh0cmFMZXZlbChlLnRhcmdldC5jaGVja2VkKX0KICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0icm91bmRlZCBib3JkZXItZ3JheS0zMDAiCiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj0iYWRkRXh0cmFMZXZlbCIgY2xhc3NOYW1lPSJ0ZXh0LXNtIj4KICAgICAgICAgICAgICAgIEFkaWNpb25hciB7c2hlbGZMZXZlbHMgKyAxfSBhbmRhcmVzIChpZ25vcmFyIGxpbWl0ZSBkZSB7c2hlbGZMZXZlbHN9IGFuZGFyZXMpCiAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4KICAgICAgICAgICAgICB7YWRkRXh0cmFMZXZlbAogICAgICAgICAgICAgICAgPyBgU2Vyw6EgY3JpYWRhIGNvbSAke3NoZWxmTGV2ZWxzICsgMX0gYW5kYXJlcyB2YXppb3NgCiAgICAgICAgICAgICAgICA6IGBTZXLDoSBjcmlhZGEgY29tICR7c2hlbGZMZXZlbHN9IGFuZGFyZXMgdmF6aW9zIChwYWRyw6NvKWB9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8U3VibWl0QnV0dG9uIC8+CiAgICAgICAgPC9mb3JtPgogICAgICA8L0RpYWxvZ0NvbnRlbnQ+CiAgICA8L0RpYWxvZz4KICApCn0K"}