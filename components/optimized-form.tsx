{"data":"InVzZSBjbGllbnQiCgppbXBvcnQgKiBhcyBSZWFjdCBmcm9tICJyZWFjdCIKaW1wb3J0IHsgdXNlQWN0aW9uU3RhdGUgfSBmcm9tICJyZWFjdCIKaW1wb3J0IHsgdXNlRm9ybVN0YXR1cyB9IGZyb20gInJlYWN0LWRvbSIKaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAiQC9jb21wb25lbnRzL3VpL2J1dHRvbiIKaW1wb3J0IHsgSW5wdXQgfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvaW5wdXQiCmltcG9ydCB7IExhYmVsIH0gZnJvbSAiQC9jb21wb25lbnRzL3VpL2xhYmVsIgppbXBvcnQgeyBUZXh0YXJlYSB9IGZyb20gIkAvY29tcG9uZW50cy91aS90ZXh0YXJlYSIKaW1wb3J0IHsgdG9hc3QgfSBmcm9tICJAL2hvb2tzL3VzZS10b2FzdCIKaW1wb3J0IHsgTG9hZGVyMiB9IGZyb20gImx1Y2lkZS1yZWFjdCIKaW1wb3J0IHsgY24gfSBmcm9tICJAL2xpYi91dGlscyIKCi8vIENvbXBvbmVudGUgZGUgYm90w6NvIGRlIHN1Ym1pdCBvdGltaXphZG8KaW50ZXJmYWNlIFN1Ym1pdEJ1dHRvblByb3BzIHsKICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlCiAgZGlzYWJsZWQ/OiBib29sZWFuCiAgbG9hZGluZ1RleHQ/OiBzdHJpbmcKICBjbGFzc05hbWU/OiBzdHJpbmcKICB2YXJpYW50PzogImRlZmF1bHQiIHwgImRlc3RydWN0aXZlIiB8ICJvdXRsaW5lIiB8ICJzZWNvbmRhcnkiIHwgImdob3N0IiB8ICJsaW5rIgp9CgpleHBvcnQgZnVuY3Rpb24gU3VibWl0QnV0dG9uKHsKICBjaGlsZHJlbiwKICBkaXNhYmxlZCA9IGZhbHNlLAogIGxvYWRpbmdUZXh0ID0gIlByb2Nlc3NhbmRvLi4uIiwKICBjbGFzc05hbWUsCiAgdmFyaWFudCA9ICJkZWZhdWx0IiwKfTogU3VibWl0QnV0dG9uUHJvcHMpIHsKICBjb25zdCB7IHBlbmRpbmcgfSA9IHVzZUZvcm1TdGF0dXMoKQoKICByZXR1cm4gKAogICAgPEJ1dHRvbiB0eXBlPSJzdWJtaXQiIGRpc2FibGVkPXtwZW5kaW5nIHx8IGRpc2FibGVkfSB2YXJpYW50PXt2YXJpYW50fSBjbGFzc05hbWU9e2NuKCJ3LWZ1bGwiLCBjbGFzc05hbWUpfT4KICAgICAge3BlbmRpbmcgPyAoCiAgICAgICAgPD4KICAgICAgICAgIDxMb2FkZXIyIGNsYXNzTmFtZT0iaC00IHctNCBhbmltYXRlLXNwaW4gbXItMiIgLz4KICAgICAgICAgIHtsb2FkaW5nVGV4dH0KICAgICAgICA8Lz4KICAgICAgKSA6ICgKICAgICAgICBjaGlsZHJlbgogICAgICApfQogICAgPC9CdXR0b24+CiAgKQp9CgovLyBIb29rIHBhcmEgZm9ybXVsw6FyaW9zIG90aW1pemFkbwppbnRlcmZhY2UgVXNlT3B0aW1pemVkRm9ybU9wdGlvbnMgewogIG9uU3VjY2Vzcz86IChkYXRhPzogYW55KSA9PiB2b2lkCiAgb25FcnJvcj86IChlcnJvcjogc3RyaW5nKSA9PiB2b2lkCiAgc3VjY2Vzc01lc3NhZ2U/OiBzdHJpbmcKICByZXNldE9uU3VjY2Vzcz86IGJvb2xlYW4KfQoKZXhwb3J0IGZ1bmN0aW9uIHVzZU9wdGltaXplZEZvcm0oCiAgYWN0aW9uOiBhbnksCiAgaW5pdGlhbFN0YXRlOiBhbnkgPSB7IG1lc3NhZ2U6ICIiLCBzdWNjZXNzOiBmYWxzZSB9LAogIG9wdGlvbnM6IFVzZU9wdGltaXplZEZvcm1PcHRpb25zID0ge30sCikgewogIGNvbnN0IFtzdGF0ZSwgZm9ybUFjdGlvbl0gPSB1c2VBY3Rpb25TdGF0ZShhY3Rpb24sIGluaXRpYWxTdGF0ZSkKICBjb25zdCBbaXNTdWJtaXR0aW5nLCBzZXRJc1N1Ym1pdHRpbmddID0gUmVhY3QudXNlU3RhdGUoZmFsc2UpCiAgY29uc3QgZm9ybVJlZiA9IFJlYWN0LnVzZVJlZjxIVE1MRm9ybUVsZW1lbnQ+KG51bGwpCgogIGNvbnN0IHsgb25TdWNjZXNzLCBvbkVycm9yLCBzdWNjZXNzTWVzc2FnZSwgcmVzZXRPblN1Y2Nlc3MgPSBmYWxzZSB9ID0gb3B0aW9ucwoKICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHN0YXRlLm1lc3NhZ2UpIHsKICAgICAgY29uc3QgaXNTdWNjZXNzID0gc3RhdGUuc3VjY2VzcyB8fCBzdGF0ZS5tZXNzYWdlLmluY2x1ZGVzKCJzdWNlc3NvIikKCiAgICAgIHRvYXN0KHsKICAgICAgICB0aXRsZTogc3RhdGUubWVzc2FnZSwKICAgICAgICB2YXJpYW50OiBpc1N1Y2Nlc3MgPyAiZGVmYXVsdCIgOiAiZGVzdHJ1Y3RpdmUiLAogICAgICB9KQoKICAgICAgaWYgKGlzU3VjY2VzcykgewogICAgICAgIGlmIChzdWNjZXNzTWVzc2FnZSkgewogICAgICAgICAgdG9hc3QoewogICAgICAgICAgICB0aXRsZTogc3VjY2Vzc01lc3NhZ2UsCiAgICAgICAgICAgIHZhcmlhbnQ6ICJkZWZhdWx0IiwKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGlmIChyZXNldE9uU3VjY2VzcyAmJiBmb3JtUmVmLmN1cnJlbnQpIHsKICAgICAgICAgIGZvcm1SZWYuY3VycmVudC5yZXNldCgpCiAgICAgICAgfQogICAgICAgIG9uU3VjY2Vzcz8uKHN0YXRlKQogICAgICB9IGVsc2UgewogICAgICAgIG9uRXJyb3I/LihzdGF0ZS5tZXNzYWdlKQogICAgICB9CgogICAgICBzZXRJc1N1Ym1pdHRpbmcoZmFsc2UpCiAgICB9CiAgfSwgW3N0YXRlLCBvblN1Y2Nlc3MsIG9uRXJyb3IsIHN1Y2Nlc3NNZXNzYWdlLCByZXNldE9uU3VjY2Vzc10pCgogIGNvbnN0IGhhbmRsZVN1Ym1pdCA9IFJlYWN0LnVzZUNhbGxiYWNrKAogICAgKGZvcm1EYXRhOiBGb3JtRGF0YSkgPT4gewogICAgICBzZXRJc1N1Ym1pdHRpbmcodHJ1ZSkKICAgICAgcmV0dXJuIGZvcm1BY3Rpb24oZm9ybURhdGEpCiAgICB9LAogICAgW2Zvcm1BY3Rpb25dLAogICkKCiAgcmV0dXJuIHsKICAgIHN0YXRlLAogICAgZm9ybUFjdGlvbjogaGFuZGxlU3VibWl0LAogICAgaXNTdWJtaXR0aW5nLAogICAgZm9ybVJlZiwKICB9Cn0KCi8vIENvbXBvbmVudGUgZGUgY2FtcG8gZGUgaW5wdXQgb3RpbWl6YWRvCmludGVyZmFjZSBPcHRpbWl6ZWRJbnB1dFByb3BzIGV4dGVuZHMgUmVhY3QuSW5wdXRIVE1MQXR0cmlidXRlczxIVE1MSW5wdXRFbGVtZW50PiB7CiAgbGFiZWw6IHN0cmluZwogIGVycm9yPzogc3RyaW5nCiAgcmVxdWlyZWQ/OiBib29sZWFuCn0KCmV4cG9ydCBmdW5jdGlvbiBPcHRpbWl6ZWRJbnB1dCh7IGxhYmVsLCBlcnJvciwgcmVxdWlyZWQgPSBmYWxzZSwgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBPcHRpbWl6ZWRJbnB1dFByb3BzKSB7CiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIGdhcC0yIj4KICAgICAgPExhYmVsIGh0bWxGb3I9e3Byb3BzLmlkfSBjbGFzc05hbWU9InRleHQtZ3JheS05MDAgZGFyazp0ZXh0LWdyYXktMTAwIj4KICAgICAgICB7bGFiZWx9CiAgICAgICAge3JlcXVpcmVkICYmIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1yZWQtNTAwIG1sLTEiPio8L3NwYW4+fQogICAgICA8L0xhYmVsPgogICAgICA8SW5wdXQKICAgICAgICB7Li4ucHJvcHN9CiAgICAgICAgcmVxdWlyZWQ9e3JlcXVpcmVkfQogICAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgICAiYmctd2hpdGUgZGFyazpiZy1ncmF5LTgwMCBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgdGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAiLAogICAgICAgICAgZXJyb3IgJiYgImJvcmRlci1yZWQtNTAwIGZvY3VzOmJvcmRlci1yZWQtNTAwIiwKICAgICAgICAgIGNsYXNzTmFtZSwKICAgICAgICApfQogICAgICAvPgogICAgICB7ZXJyb3IgJiYgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtcmVkLTYwMCBkYXJrOnRleHQtcmVkLTQwMCI+e2Vycm9yfTwvcD59CiAgICA8L2Rpdj4KICApCn0KCi8vIENvbXBvbmVudGUgZGUgdGV4dGFyZWEgb3RpbWl6YWRvCmludGVyZmFjZSBPcHRpbWl6ZWRUZXh0YXJlYVByb3BzIGV4dGVuZHMgUmVhY3QuVGV4dGFyZWFIVE1MQXR0cmlidXRlczxIVE1MVGV4dEFyZWFFbGVtZW50PiB7CiAgbGFiZWw6IHN0cmluZwogIGVycm9yPzogc3RyaW5nCiAgcmVxdWlyZWQ/OiBib29sZWFuCn0KCmV4cG9ydCBmdW5jdGlvbiBPcHRpbWl6ZWRUZXh0YXJlYSh7IGxhYmVsLCBlcnJvciwgcmVxdWlyZWQgPSBmYWxzZSwgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBPcHRpbWl6ZWRUZXh0YXJlYVByb3BzKSB7CiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIGdhcC0yIj4KICAgICAgPExhYmVsIGh0bWxGb3I9e3Byb3BzLmlkfSBjbGFzc05hbWU9InRleHQtZ3JheS05MDAgZGFyazp0ZXh0LWdyYXktMTAwIj4KICAgICAgICB7bGFiZWx9CiAgICAgICAge3JlcXVpcmVkICYmIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1yZWQtNTAwIG1sLTEiPio8L3NwYW4+fQogICAgICA8L0xhYmVsPgogICAgICA8VGV4dGFyZWEKICAgICAgICB7Li4ucHJvcHN9CiAgICAgICAgcmVxdWlyZWQ9e3JlcXVpcmVkfQogICAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgICAiYmctd2hpdGUgZGFyazpiZy1ncmF5LTgwMCBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgdGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAiLAogICAgICAgICAgZXJyb3IgJiYgImJvcmRlci1yZWQtNTAwIGZvY3VzOmJvcmRlci1yZWQtNTAwIiwKICAgICAgICAgIGNsYXNzTmFtZSwKICAgICAgICApfQogICAgICAvPgogICAgICB7ZXJyb3IgJiYgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtcmVkLTYwMCBkYXJrOnRleHQtcmVkLTQwMCI+e2Vycm9yfTwvcD59CiAgICA8L2Rpdj4KICApCn0KCi8vIFZhbGlkYWRvciBkZSBmb3JtdWzDoXJpbwpleHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVGb3JtKAogIGRhdGE6IEZvcm1EYXRhLAogIHJ1bGVzOiBSZWNvcmQ8c3RyaW5nLCB7IHJlcXVpcmVkPzogYm9vbGVhbjsgbWluTGVuZ3RoPzogbnVtYmVyOyBtYXhMZW5ndGg/OiBudW1iZXI7IHBhdHRlcm4/OiBSZWdFeHAgfT4sCikgewogIGNvbnN0IGVycm9yczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9CgogIGZvciAoY29uc3QgW2ZpZWxkLCBydWxlXSBvZiBPYmplY3QuZW50cmllcyhydWxlcykpIHsKICAgIGNvbnN0IHZhbHVlID0gZGF0YS5nZXQoZmllbGQpIGFzIHN0cmluZwoKICAgIGlmIChydWxlLnJlcXVpcmVkICYmICghdmFsdWUgfHwgdmFsdWUudHJpbSgpID09PSAiIikpIHsKICAgICAgZXJyb3JzW2ZpZWxkXSA9IGAke2ZpZWxkfSDDqSBvYnJpZ2F0w7NyaW9gCiAgICAgIGNvbnRpbnVlCiAgICB9CgogICAgaWYgKHZhbHVlICYmIHJ1bGUubWluTGVuZ3RoICYmIHZhbHVlLmxlbmd0aCA8IHJ1bGUubWluTGVuZ3RoKSB7CiAgICAgIGVycm9yc1tmaWVsZF0gPSBgJHtmaWVsZH0gZGV2ZSB0ZXIgcGVsbyBtZW5vcyAke3J1bGUubWluTGVuZ3RofSBjYXJhY3RlcmVzYAogICAgICBjb250aW51ZQogICAgfQoKICAgIGlmICh2YWx1ZSAmJiBydWxlLm1heExlbmd0aCAmJiB2YWx1ZS5sZW5ndGggPiBydWxlLm1heExlbmd0aCkgewogICAgICBlcnJvcnNbZmllbGRdID0gYCR7ZmllbGR9IGRldmUgdGVyIG5vIG3DoXhpbW8gJHtydWxlLm1heExlbmd0aH0gY2FyYWN0ZXJlc2AKICAgICAgY29udGludWUKICAgIH0KCiAgICBpZiAodmFsdWUgJiYgcnVsZS5wYXR0ZXJuICYmICFydWxlLnBhdHRlcm4udGVzdCh2YWx1ZSkpIHsKICAgICAgZXJyb3JzW2ZpZWxkXSA9IGAke2ZpZWxkfSB0ZW0gZm9ybWF0byBpbnbDoWxpZG9gCiAgICAgIGNvbnRpbnVlCiAgICB9CiAgfQoKICByZXR1cm4gewogICAgaXNWYWxpZDogT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGggPT09IDAsCiAgICBlcnJvcnMsCiAgfQp9Cg=="}