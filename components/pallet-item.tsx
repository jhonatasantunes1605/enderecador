{"data":"InVzZSBjbGllbnQiCgppbXBvcnQgdHlwZSBSZWFjdCBmcm9tICJyZWFjdCIKCmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICJyZWFjdCIKaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAibmV4dC9uYXZpZ2F0aW9uIgppbXBvcnQgeyB1c2VBY3Rpb25TdGF0ZSB9IGZyb20gInJlYWN0IgppbXBvcnQgeyB1c2VGb3JtU3RhdHVzIH0gZnJvbSAicmVhY3QtZG9tIgppbXBvcnQgeyBDYXJkLCBDYXJkQ29udGVudCB9IGZyb20gIkAvY29tcG9uZW50cy91aS9jYXJkIgppbXBvcnQgewogIEFsZXJ0RGlhbG9nLAogIEFsZXJ0RGlhbG9nQWN0aW9uLAogIEFsZXJ0RGlhbG9nQ2FuY2VsLAogIEFsZXJ0RGlhbG9nQ29udGVudCwKICBBbGVydERpYWxvZ0Rlc2NyaXB0aW9uLAogIEFsZXJ0RGlhbG9nRm9vdGVyLAogIEFsZXJ0RGlhbG9nSGVhZGVyLAogIEFsZXJ0RGlhbG9nVGl0bGUsCiAgQWxlcnREaWFsb2dUcmlnZ2VyLAp9IGZyb20gIkAvY29tcG9uZW50cy91aS9hbGVydC1kaWFsb2ciCmltcG9ydCB7IERpYWxvZywgRGlhbG9nQ29udGVudCwgRGlhbG9nRGVzY3JpcHRpb24sIERpYWxvZ0hlYWRlciwgRGlhbG9nVGl0bGUgfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvZGlhbG9nIgppbXBvcnQgeyBBc3NpZ25Qcm9kdWN0Rm9ybUVuaGFuY2VkIH0gZnJvbSAiLi9hc3NpZ24tcHJvZHVjdC1mb3JtLWVuaGFuY2VkIgppbXBvcnQgeyBBZGRQcm9kdWN0VG9QYWxsZXRCdXR0b24gfSBmcm9tICIuL2FkZC1wcm9kdWN0LXRvLXBhbGxldC1idXR0b24iCmltcG9ydCB7IEFkZFByb2R1Y3RUb1NoZWxmQnV0dG9uIH0gZnJvbSAiLi9hZGQtcHJvZHVjdC10by1zaGVsZi1idXR0b24iCmltcG9ydCB7IFByb2R1Y3RMaXN0TW9kYWwgfSBmcm9tICIuL3Byb2R1Y3QtbGlzdC1tb2RhbCIKaW1wb3J0IHsgY24gfSBmcm9tICJAL2xpYi91dGlscyIKaW1wb3J0IHsgWCwgQ2hlY2tDaXJjbGUyLCBBbGVydENpcmNsZSwgTG9hZGVyMiwgUGFja2FnZSwgQnJ1c2ggfSBmcm9tICJsdWNpZGUtcmVhY3QiCmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gIkAvY29tcG9uZW50cy91aS9idXR0b24iCmltcG9ydCB7IENoZWNrYm94IH0gZnJvbSAiQC9jb21wb25lbnRzL3VpL2NoZWNrYm94IgppbXBvcnQgeyB1bmFzc2lnblByb2R1Y3RGcm9tUGFsbGV0LCByZW1vdmVJbmRpdmlkdWFsUHJvZHVjdEZyb21QYWxsZXQgfSBmcm9tICJAL2FwcC9hY3Rpb25zIgppbXBvcnQgeyB0b2FzdCB9IGZyb20gIkAvaG9va3MvdXNlLXRvYXN0IgppbXBvcnQgewogIHZlcmlmeVBhbGxldEFjdGlvbiwKICB2ZXJpZnlTaGVsZkFjdGlvbiwKICB1bmFzc2lnblByb2R1Y3RGcm9tU2hlbGYsCiAgcmVtb3ZlSW5kaXZpZHVhbFByb2R1Y3RGcm9tU2hlbGYsCn0gZnJvbSAiQC9hcHAvYWN0aW9ucyIKCmludGVyZmFjZSBTaGVsZkl0ZW1Qcm9wcyB7CiAgaWQ6IHN0cmluZwogIHBvc2l0aW9uOiBudW1iZXIKICBsZXZlbDogbnVtYmVyCiAgZWFuOiBzdHJpbmcgfCBudWxsCiAgcHJvZHVjdE5hbWU6IHN0cmluZyB8IG51bGwKICBvY2N1cGFuY3lQZXJjZW50YWdlOiBudW1iZXIKICBsYXN0VmVyaWZpZWQ6IERhdGUgfCBudWxsCiAgaXNEdXBsaWNhdGVkRUFOOiBib29sZWFuCiAgb25Bc3NpZ25Qcm9kdWN0OiAoKSA9PiB2b2lkCiAgaXNTZWxlY3RlZD86IGJvb2xlYW4KICBvblNlbGVjdGlvbkNoYW5nZT86IChpZDogc3RyaW5nLCBzZWxlY3RlZDogYm9vbGVhbikgPT4gdm9pZAogIGlzSGlnaGxpZ2h0ZWQ/OiBib29sZWFuCiAgd2FyZWhvdXNlTmFtZT86IHN0cmluZwogIGFpc2xlTmFtZT86IHN0cmluZwp9CgppbnRlcmZhY2UgUGFsbGV0SXRlbVByb3BzIHsKICBpZDogc3RyaW5nCiAgcG9zaXRpb246IG51bWJlcgogIGVhbjogc3RyaW5nIHwgbnVsbAogIHByb2R1Y3ROYW1lOiBzdHJpbmcgfCBudWxsCiAgbGFzdFZlcmlmaWVkOiBEYXRlIHwgbnVsbAogIGlzRHVwbGljYXRlZEVBTjogYm9vbGVhbgogIGlzU2VsZWN0ZWQ/OiBib29sZWFuCiAgb25TZWxlY3Rpb25DaGFuZ2U/OiAoaWQ6IHN0cmluZywgc2VsZWN0ZWQ6IGJvb2xlYW4pID0+IHZvaWQKICBpc0hpZ2hsaWdodGVkPzogYm9vbGVhbgogIHdhcmVob3VzZU5hbWU/OiBzdHJpbmcKICBhaXNsZU5hbWU/OiBzdHJpbmcKfQoKZnVuY3Rpb24gZm9ybWF0RUFOc0ZvckRpc3BsYXkoZWFuU3RyaW5nOiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHsKICBpZiAoIWVhblN0cmluZyB8fCBlYW5TdHJpbmcudHJpbSgpID09PSAiIikgcmV0dXJuICIiCgogIGNvbnN0IGVhbnMgPSBlYW5TdHJpbmcKICAgIC5zcGxpdCgiOyIpCiAgICAubWFwKChlYW4pID0+IGVhbi50cmltKCkpCiAgICAuZmlsdGVyKChlYW4pID0+IGVhbi5sZW5ndGggPiAwKQoKICBpZiAoZWFucy5sZW5ndGggPT09IDEpIHsKICAgIHJldHVybiBlYW5zWzBdCiAgfSBlbHNlIGlmIChlYW5zLmxlbmd0aCA8PSAyKSB7CiAgICByZXR1cm4gZWFucy5qb2luKCI7ICIpCiAgfSBlbHNlIHsKICAgIHJldHVybiBgJHtlYW5zWzBdfTsgJHtlYW5zWzFdfSArJHtlYW5zLmxlbmd0aCAtIDJ9YAogIH0KfQoKZnVuY3Rpb24gY291bnRFQU5zKGVhblN0cmluZzogc3RyaW5nIHwgbnVsbCk6IG51bWJlciB7CiAgaWYgKCFlYW5TdHJpbmcgfHwgZWFuU3RyaW5nLnRyaW0oKSA9PT0gIiIpIHJldHVybiAwCiAgcmV0dXJuIGVhblN0cmluZwogICAgLnNwbGl0KCI7IikKICAgIC5tYXAoKGVhbikgPT4gZWFuLnRyaW0oKSkKICAgIC5maWx0ZXIoKGVhbikgPT4gZWFuLmxlbmd0aCA+IDApLmxlbmd0aAp9CgpmdW5jdGlvbiBVbmFzc2lnbkJ1dHRvbih7CiAgc2hlbGZJZCwKICBwb3NpdGlvbiwKICBsZXZlbCwKICBoYXNQcm9kdWN0LAogIG9uT3B0aW1pc3RpY1VwZGF0ZSwKfTogewogIHNoZWxmSWQ6IHN0cmluZwogIHBvc2l0aW9uOiBudW1iZXIKICBsZXZlbDogbnVtYmVyCiAgaGFzUHJvZHVjdDogYm9vbGVhbgogIG9uT3B0aW1pc3RpY1VwZGF0ZTogKCkgPT4gdm9pZAp9KSB7CiAgY29uc3QgW2lzT3Blbiwgc2V0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtpc1JlbW92aW5nLCBzZXRJc1JlbW92aW5nXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtzdGF0ZSwgZm9ybUFjdGlvbl0gPSB1c2VBY3Rpb25TdGF0ZSh1bmFzc2lnblByb2R1Y3RGcm9tU2hlbGYuYmluZChudWxsLCBzaGVsZklkKSwgewogICAgbWVzc2FnZTogIiIsCiAgICBzdWNjZXNzOiBmYWxzZSwKICB9KQogIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpCgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpZiAoc3RhdGUubWVzc2FnZSkgewogICAgICBzZXRJc1JlbW92aW5nKGZhbHNlKQogICAgICB0b2FzdCh7CiAgICAgICAgdGl0bGU6IHN0YXRlLm1lc3NhZ2UsCiAgICAgICAgdmFyaWFudDogc3RhdGUuc3VjY2VzcyA/ICJkZWZhdWx0IiA6ICJkZXN0cnVjdGl2ZSIsCiAgICAgIH0pCiAgICAgIGlmIChzdGF0ZS5zdWNjZXNzKSB7CiAgICAgICAgc2V0SXNPcGVuKGZhbHNlKQogICAgICAgIHJvdXRlci5yZWZyZXNoKCkKICAgICAgfQogICAgfQogIH0sIFtzdGF0ZV0pCgogIGNvbnN0IGhhbmRsZVVuYXNzaWduQ2xpY2sgPSAoZTogUmVhY3QuTW91c2VFdmVudCkgPT4gewogICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICBlLnN0b3BQcm9wYWdhdGlvbigpCiAgICBzZXRJc09wZW4odHJ1ZSkKICB9CgogIGNvbnN0IGhhbmRsZUNvbmZpcm1SZW1vdmUgPSBhc3luYyAoZTogUmVhY3QuTW91c2VFdmVudCkgPT4gewogICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICBlLnN0b3BQcm9wYWdhdGlvbigpCiAgICBzZXRJc1JlbW92aW5nKHRydWUpCiAgICBzZXRJc09wZW4oZmFsc2UpCgogICAgb25PcHRpbWlzdGljVXBkYXRlKCkKCiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpCiAgICBhd2FpdCBmb3JtQWN0aW9uKGZvcm1EYXRhKQogIH0KCiAgaWYgKCFoYXNQcm9kdWN0KSB7CiAgICByZXR1cm4gbnVsbAogIH0KCiAgcmV0dXJuICgKICAgIDxBbGVydERpYWxvZyBvcGVuPXtpc09wZW59IG9uT3BlbkNoYW5nZT17c2V0SXNPcGVufT4KICAgICAgPEFsZXJ0RGlhbG9nVHJpZ2dlciBhc0NoaWxkPgogICAgICAgIDxCdXR0b24KICAgICAgICAgIHZhcmlhbnQ9Imdob3N0IgogICAgICAgICAgc2l6ZT0iaWNvbiIKICAgICAgICAgIGNsYXNzTmFtZT0iYWJzb2x1dGUgdG9wLTAuNSByaWdodC0wLjUgaC00IHctNCBwLTAgdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LXJlZC01MDAgZGFyazp0ZXh0LWdyYXktNTAwIGRhcms6aG92ZXI6dGV4dC1yZWQtNDAwIHotMjAgdHJhbnNpdGlvbi1jb2xvcnMgZHVyYXRpb24tMjAwIHJvdW5kZWQtbWQiCiAgICAgICAgICBhcmlhLWxhYmVsPSJMaW1wYXIgQW5kYXIiCiAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVVbmFzc2lnbkNsaWNrfQogICAgICAgICAgZGlzYWJsZWQ9e2lzUmVtb3Zpbmd9CiAgICAgICAgPgogICAgICAgICAge2lzUmVtb3ZpbmcgPyA8TG9hZGVyMiBjbGFzc05hbWU9ImgtMi41IHctMi41IGFuaW1hdGUtc3BpbiIgLz4gOiA8QnJ1c2ggY2xhc3NOYW1lPSJoLTIuNSB3LTIuNSIgLz59CiAgICAgICAgPC9CdXR0b24+CiAgICAgIDwvQWxlcnREaWFsb2dUcmlnZ2VyPgogICAgICA8QWxlcnREaWFsb2dDb250ZW50IGNsYXNzTmFtZT0iYmctd2hpdGUgZGFyazpiZy1ncmF5LTkwMCBib3JkZXItZ3JheS0yMDAgZGFyazpib3JkZXItZ3JheS03MDAgcm91bmRlZC14bCI+CiAgICAgICAgPEFsZXJ0RGlhbG9nSGVhZGVyPgogICAgICAgICAgPEFsZXJ0RGlhbG9nVGl0bGUgY2xhc3NOYW1lPSJ0ZXh0LWdyYXktOTAwIGRhcms6dGV4dC1ncmF5LTEwMCI+CiAgICAgICAgICAgIExpbXBhciBBbmRhciB7bGV2ZWx9IGRhIFByYXRlbGVpcmEge3Bvc2l0aW9ufQogICAgICAgICAgPC9BbGVydERpYWxvZ1RpdGxlPgogICAgICAgICAgPEFsZXJ0RGlhbG9nRGVzY3JpcHRpb24gY2xhc3NOYW1lPSJ0ZXh0LWdyYXktNjAwIGRhcms6dGV4dC1ncmF5LTMwMCI+CiAgICAgICAgICAgIEVzdGEgYcOnw6NvIGlyw6EgcmVtb3ZlciB0b2RvcyBvcyBwcm9kdXRvcyBkZXN0ZSBhbmRhciBkYSBwcmF0ZWxlaXJhLCBkZWl4YW5kby1vIHZhemlvLiBBIHByYXRlbGVpcmEKICAgICAgICAgICAgcGVybWFuZWNlcsOhIG5hIHJ1YS4KICAgICAgICAgIDwvQWxlcnREaWFsb2dEZXNjcmlwdGlvbj4KICAgICAgICA8L0FsZXJ0RGlhbG9nSGVhZGVyPgogICAgICAgIDxBbGVydERpYWxvZ0Zvb3Rlcj4KICAgICAgICAgIDxBbGVydERpYWxvZ0NhbmNlbAogICAgICAgICAgICBkaXNhYmxlZD17aXNSZW1vdmluZ30KICAgICAgICAgICAgY2xhc3NOYW1lPSJiZy1ncmF5LTEwMCBkYXJrOmJnLWdyYXktODAwIHRleHQtZ3JheS05MDAgZGFyazp0ZXh0LWdyYXktMTAwIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCBob3ZlcjpiZy1ncmF5LTIwMCBkYXJrOmhvdmVyOmJnLWdyYXktNzAwIHJvdW5kZWQtbGciCiAgICAgICAgICA+CiAgICAgICAgICAgIENhbmNlbGFyCiAgICAgICAgICA8L0FsZXJ0RGlhbG9nQ2FuY2VsPgogICAgICAgICAgPEFsZXJ0RGlhbG9nQWN0aW9uIGFzQ2hpbGQ+CiAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0iZGVzdHJ1Y3RpdmUiIG9uQ2xpY2s9e2hhbmRsZUNvbmZpcm1SZW1vdmV9IGRpc2FibGVkPXtpc1JlbW92aW5nfSBjbGFzc05hbWU9InJvdW5kZWQtbGciPgogICAgICAgICAgICAgIHtpc1JlbW92aW5nID8gKAogICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgPExvYWRlcjIgY2xhc3NOYW1lPSJoLTQgdy00IGFuaW1hdGUtc3BpbiBtci0yIiAvPgogICAgICAgICAgICAgICAgICBMaW1wYW5kby4uLgogICAgICAgICAgICAgICAgPC8+CiAgICAgICAgICAgICAgKSA6ICgKICAgICAgICAgICAgICAgICJMaW1wYXIgQW5kYXIiCiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICA8L0FsZXJ0RGlhbG9nQWN0aW9uPgogICAgICAgIDwvQWxlcnREaWFsb2dGb290ZXI+CiAgICAgIDwvQWxlcnREaWFsb2dDb250ZW50PgogICAgPC9BbGVydERpYWxvZz4KICApCn0KCmZ1bmN0aW9uIFZlcmlmeUJ1dHRvbih7IHNoZWxmSWQgfTogeyBzaGVsZklkOiBzdHJpbmcgfSkgewogIGNvbnN0IFtzdGF0ZSwgZm9ybUFjdGlvbl0gPSB1c2VBY3Rpb25TdGF0ZSh2ZXJpZnlTaGVsZkFjdGlvbi5iaW5kKG51bGwsIHNoZWxmSWQpLCB7IG1lc3NhZ2U6ICIiLCBzdWNjZXNzOiBmYWxzZSB9KQogIGNvbnN0IHsgcGVuZGluZyB9ID0gdXNlRm9ybVN0YXR1cygpCiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCkKICBjb25zdCBzZWFyY2hQYXJhbXMgPSB1c2VTZWFyY2hQYXJhbXMoKQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHN0YXRlLm1lc3NhZ2UpIHsKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiBzdGF0ZS5tZXNzYWdlLAogICAgICAgIHZhcmlhbnQ6IHN0YXRlLnN1Y2Nlc3MgPyAiZGVmYXVsdCIgOiAiZGVzdHJ1Y3RpdmUiLAogICAgICB9KQogICAgICBpZiAoc3RhdGUuc3VjY2VzcykgewogICAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoc2VhcmNoUGFyYW1zLnRvU3RyaW5nKCkpCiAgICAgICAgcGFyYW1zLnNldCgiaGlnaGxpZ2h0Iiwgc2hlbGZJZCkKICAgICAgICBwYXJhbXMuc2V0KCJ0eXBlIiwgInNoZWxmIikKICAgICAgICBjb25zdCBuZXdVcmwgPSBgJHt3aW5kb3cubG9jYXRpb24ucGF0aG5hbWV9PyR7cGFyYW1zLnRvU3RyaW5nKCl9YAogICAgICAgIHJvdXRlci5yZXBsYWNlKG5ld1VybCwgeyBzY3JvbGw6IGZhbHNlIH0pCiAgICAgICAgcm91dGVyLnJlZnJlc2goKQogICAgICB9CiAgICB9CiAgfSwgW3N0YXRlXSkKCiAgcmV0dXJuICgKICAgIDxmb3JtIGFjdGlvbj17Zm9ybUFjdGlvbn0gY2xhc3NOYW1lPSJ3LWZ1bGwiPgogICAgICA8QnV0dG9uCiAgICAgICAgdHlwZT0ic3VibWl0IgogICAgICAgIHZhcmlhbnQ9Im91dGxpbmUiCiAgICAgICAgc2l6ZT0ic20iCiAgICAgICAgYXJpYS1kaXNhYmxlZD17cGVuZGluZ30KICAgICAgICBjbGFzc05hbWU9InctZnVsbCBtdC0yIHRleHQteHMgaC03IHRyYW5zaXRpb24tY29sb3JzIGR1cmF0aW9uLTIwMCBiZy10cmFuc3BhcmVudCBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0yMDAgaG92ZXI6YmctZ3JheS0xMDAgZGFyazpob3ZlcjpiZy1ncmF5LTgwMCByb3VuZGVkLWxnIgogICAgICA+CiAgICAgICAge3BlbmRpbmcgPyAoCiAgICAgICAgICA8PgogICAgICAgICAgICA8TG9hZGVyMiBjbGFzc05hbWU9ImgtMyB3LTMgYW5pbWF0ZS1zcGluIG1yLTIiIC8+CiAgICAgICAgICAgIFZlcmlmaWNhbmRvLi4uCiAgICAgICAgICA8Lz4KICAgICAgICApIDogKAogICAgICAgICAgIlZlcmlmaWNhciBBZ29yYSIKICAgICAgICApfQogICAgICA8L0J1dHRvbj4KICAgIDwvZm9ybT4KICApCn0KCmZ1bmN0aW9uIFVuYXNzaWduUGFsbGV0QnV0dG9uKHsKICBwYWxsZXRJZCwKICBwb3NpdGlvbiwKICBoYXNQcm9kdWN0LAogIG9uT3B0aW1pc3RpY1VwZGF0ZSwKfTogewogIHBhbGxldElkOiBzdHJpbmcKICBwb3NpdGlvbjogbnVtYmVyCiAgaGFzUHJvZHVjdDogYm9vbGVhbgogIG9uT3B0aW1pc3RpY1VwZGF0ZTogKCkgPT4gdm9pZAp9KSB7CiAgY29uc3QgW2lzT3Blbiwgc2V0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtpc1JlbW92aW5nLCBzZXRJc1JlbW92aW5nXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtzdGF0ZSwgZm9ybUFjdGlvbl0gPSB1c2VBY3Rpb25TdGF0ZSh1bmFzc2lnblByb2R1Y3RGcm9tUGFsbGV0LmJpbmQobnVsbCwgcGFsbGV0SWQpLCB7CiAgICBtZXNzYWdlOiAiIiwKICAgIHN1Y2Nlc3M6IGZhbHNlLAogIH0pCiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCkKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChzdGF0ZS5tZXNzYWdlKSB7CiAgICAgIHNldElzUmVtb3ZpbmcoZmFsc2UpCiAgICAgIHRvYXN0KHsKICAgICAgICB0aXRsZTogc3RhdGUubWVzc2FnZSwKICAgICAgICB2YXJpYW50OiBzdGF0ZS5zdWNjZXNzID8gImRlZmF1bHQiIDogImRlc3RydWN0aXZlIiwKICAgICAgfSkKICAgICAgaWYgKHN0YXRlLnN1Y2Nlc3MpIHsKICAgICAgICBzZXRJc09wZW4oZmFsc2UpCiAgICAgICAgcm91dGVyLnJlZnJlc2goKQogICAgICB9CiAgICB9CiAgfSwgW3N0YXRlXSkKCiAgY29uc3QgaGFuZGxlVW5hc3NpZ25DbGljayA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50KSA9PiB7CiAgICBlLnByZXZlbnREZWZhdWx0KCkKICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgIHNldElzT3Blbih0cnVlKQogIH0KCiAgY29uc3QgaGFuZGxlQ29uZmlybVJlbW92ZSA9IGFzeW5jIChlOiBSZWFjdC5Nb3VzZUV2ZW50KSA9PiB7CiAgICBlLnByZXZlbnREZWZhdWx0KCkKICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgIHNldElzUmVtb3ZpbmcodHJ1ZSkKICAgIHNldElzT3BlbihmYWxzZSkKCiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpCiAgICBhd2FpdCBmb3JtQWN0aW9uKGZvcm1EYXRhKQogIH0KCiAgaWYgKCFoYXNQcm9kdWN0KSB7CiAgICByZXR1cm4gbnVsbAogIH0KCiAgcmV0dXJuICgKICAgIDxBbGVydERpYWxvZyBvcGVuPXtpc09wZW59IG9uT3BlbkNoYW5nZT17c2V0SXNPcGVufT4KICAgICAgPEFsZXJ0RGlhbG9nVHJpZ2dlciBhc0NoaWxkPgogICAgICAgIDxCdXR0b24KICAgICAgICAgIHZhcmlhbnQ9Imdob3N0IgogICAgICAgICAgc2l6ZT0iaWNvbiIKICAgICAgICAgIGNsYXNzTmFtZT0iYWJzb2x1dGUgdG9wLTAuNSByaWdodC0wLjUgaC00IHctNCBwLTAgdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LXJlZC01MDAgZGFyazp0ZXh0LWdyYXktNTAwIGRhcms6aG92ZXI6dGV4dC1yZWQtNDAwIHotMjAgdHJhbnNpdGlvbi1jb2xvcnMgZHVyYXRpb24tMjAwIHJvdW5kZWQtbWQiCiAgICAgICAgICBhcmlhLWxhYmVsPSJMaW1wYXIgUGFsZXRlIgogICAgICAgICAgb25DbGljaz17aGFuZGxlVW5hc3NpZ25DbGlja30KICAgICAgICAgIGRpc2FibGVkPXtpc1JlbW92aW5nfQogICAgICAgID4KICAgICAgICAgIHtpc1JlbW92aW5nID8gPExvYWRlcjIgY2xhc3NOYW1lPSJoLTIuNSB3LTIuNSBhbmltYXRlLXNwaW4iIC8+IDogPEJydXNoIGNsYXNzTmFtZT0iaC0yLjUgdy0yLjUiIC8+fQogICAgICAgIDwvQnV0dG9uPgogICAgICA8L0FsZXJ0RGlhbG9nVHJpZ2dlcj4KICAgICAgPEFsZXJ0RGlhbG9nQ29udGVudCBjbGFzc05hbWU9ImJnLXdoaXRlIGRhcms6YmctZ3JheS05MDAgYm9yZGVyLWdyYXktMjAwIGRhcms6Ym9yZGVyLWdyYXktNzAwIHJvdW5kZWQteGwiPgogICAgICAgIDxBbGVydERpYWxvZ0hlYWRlcj4KICAgICAgICAgIDxBbGVydERpYWxvZ1RpdGxlIGNsYXNzTmFtZT0idGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAiPkxpbXBhciBQYWxldGUge3Bvc2l0aW9ufTwvQWxlcnREaWFsb2dUaXRsZT4KICAgICAgICAgIDxBbGVydERpYWxvZ0Rlc2NyaXB0aW9uIGNsYXNzTmFtZT0idGV4dC1ncmF5LTYwMCBkYXJrOnRleHQtZ3JheS0zMDAiPgogICAgICAgICAgICBFc3RhIGHDp8OjbyBpcsOhIHJlbW92ZXIgdG9kb3Mgb3MgcHJvZHV0b3MgZGVzdGUgcGFsZXRlLCBkZWl4YW5kby1vIHZhemlvLiBPIHBhbGV0ZSBwZXJtYW5lY2Vyw6EgbmEgcnVhLgogICAgICAgICAgPC9BbGVydERpYWxvZ0Rlc2NyaXB0aW9uPgogICAgICAgIDwvQWxlcnREaWFsb2dIZWFkZXI+CiAgICAgICAgPEFsZXJ0RGlhbG9nRm9vdGVyPgogICAgICAgICAgPEFsZXJ0RGlhbG9nQ2FuY2VsCiAgICAgICAgICAgIGRpc2FibGVkPXtpc1JlbW92aW5nfQogICAgICAgICAgICBjbGFzc05hbWU9ImJnLWdyYXktMTAwIGRhcms6YmctZ3JheS04MDAgdGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAgYm9yZGVyLWdyYXktMzAwIGRhcms6Ym9yZGVyLWdyYXktNjAwIGhvdmVyOmJnLWdyYXktMjAwIGRhcms6aG92ZXI6YmctZ3JheS03MDAgcm91bmRlZC1sZyIKICAgICAgICAgID4KICAgICAgICAgICAgQ2FuY2VsYXIKICAgICAgICAgIDwvQWxlcnREaWFsb2dDYW5jZWw+CiAgICAgICAgICA8QWxlcnREaWFsb2dBY3Rpb24gYXNDaGlsZD4KICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJkZXN0cnVjdGl2ZSIgb25DbGljaz17aGFuZGxlQ29uZmlybVJlbW92ZX0gZGlzYWJsZWQ9e2lzUmVtb3Zpbmd9IGNsYXNzTmFtZT0icm91bmRlZC1sZyI+CiAgICAgICAgICAgICAge2lzUmVtb3ZpbmcgPyAoCiAgICAgICAgICAgICAgICA8PgogICAgICAgICAgICAgICAgICA8TG9hZGVyMiBjbGFzc05hbWU9ImgtNCB3LTQgYW5pbWF0ZS1zcGluIG1yLTIiIC8+CiAgICAgICAgICAgICAgICAgIExpbXBhbmRvLi4uCiAgICAgICAgICAgICAgICA8Lz4KICAgICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICAgIkxpbXBhciBQYWxldGUiCiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICA8L0FsZXJ0RGlhbG9nQWN0aW9uPgogICAgICAgIDwvQWxlcnREaWFsb2dGb290ZXI+CiAgICAgIDwvQWxlcnREaWFsb2dDb250ZW50PgogICAgPC9BbGVydERpYWxvZz4KICApCn0KCmZ1bmN0aW9uIFZlcmlmeVBhbGxldEJ1dHRvbih7IHBhbGxldElkIH06IHsgcGFsbGV0SWQ6IHN0cmluZyB9KSB7CiAgY29uc3QgW3N0YXRlLCBmb3JtQWN0aW9uXSA9IHVzZUFjdGlvblN0YXRlKHZlcmlmeVBhbGxldEFjdGlvbi5iaW5kKG51bGwsIHBhbGxldElkKSwgeyBtZXNzYWdlOiAiIiwgc3VjY2VzczogZmFsc2UgfSkKICBjb25zdCB7IHBlbmRpbmcgfSA9IHVzZUZvcm1TdGF0dXMoKQogIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpCiAgY29uc3Qgc2VhcmNoUGFyYW1zID0gdXNlU2VhcmNoUGFyYW1zKCkKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChzdGF0ZS5tZXNzYWdlKSB7CiAgICAgIHRvYXN0KHsKICAgICAgICB0aXRsZTogc3RhdGUubWVzc2FnZSwKICAgICAgICB2YXJpYW50OiBzdGF0ZS5zdWNjZXNzID8gImRlZmF1bHQiIDogImRlc3RydWN0aXZlIiwKICAgICAgfSkKICAgICAgaWYgKHN0YXRlLnN1Y2Nlc3MpIHsKICAgICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHNlYXJjaFBhcmFtcy50b1N0cmluZygpKQogICAgICAgIHBhcmFtcy5zZXQoImhpZ2hsaWdodCIsIHBhbGxldElkKQogICAgICAgIHBhcmFtcy5zZXQoInR5cGUiLCAicGFsbGV0IikKICAgICAgICBjb25zdCBuZXdVcmwgPSBgJHt3aW5kb3cubG9jYXRpb24ucGF0aG5hbWV9PyR7cGFyYW1zLnRvU3RyaW5nKCl9YAogICAgICAgIHJvdXRlci5yZXBsYWNlKG5ld1VybCwgeyBzY3JvbGw6IGZhbHNlIH0pCiAgICAgICAgcm91dGVyLnJlZnJlc2goKQogICAgICB9CiAgICB9CiAgfSwgW3N0YXRlXSkKCiAgcmV0dXJuICgKICAgIDxmb3JtIGFjdGlvbj17Zm9ybUFjdGlvbn0gY2xhc3NOYW1lPSJ3LWZ1bGwiPgogICAgICA8QnV0dG9uCiAgICAgICAgdHlwZT0ic3VibWl0IgogICAgICAgIHZhcmlhbnQ9Im91dGxpbmUiCiAgICAgICAgc2l6ZT0ic20iCiAgICAgICAgYXJpYS1kaXNhYmxlZD17cGVuZGluZ30KICAgICAgICBjbGFzc05hbWU9InctZnVsbCBtdC0yIHRleHQteHMgaC03IHRyYW5zaXRpb24tY29sb3JzIGR1cmF0aW9uLTIwMCBiZy10cmFuc3BhcmVudCBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0yMDAgaG92ZXI6YmctZ3JheS0xMDAgZGFyazpob3ZlcjpiZy1ncmF5LTgwMCByb3VuZGVkLWxnIgogICAgICA+CiAgICAgICAge3BlbmRpbmcgPyAoCiAgICAgICAgICA8PgogICAgICAgICAgICA8TG9hZGVyMiBjbGFzc05hbWU9ImgtMyB3LTMgYW5pbWF0ZS1zcGluIG1yLTIiIC8+CiAgICAgICAgICAgIFZlcmlmaWNhbmRvLi4uCiAgICAgICAgICA8Lz4KICAgICAgICApIDogKAogICAgICAgICAgIlZlcmlmaWNhciBBZ29yYSIKICAgICAgICApfQogICAgICA8L0J1dHRvbj4KICAgIDwvZm9ybT4KICApCn0KCmV4cG9ydCBmdW5jdGlvbiBTaGVsZkl0ZW0oewogIGlkLAogIHBvc2l0aW9uLAogIGxldmVsLAogIGVhbiwKICBwcm9kdWN0TmFtZSwKICBvY2N1cGFuY3lQZXJjZW50YWdlLAogIGxhc3RWZXJpZmllZCwKICBpc0R1cGxpY2F0ZWRFQU4sCiAgb25Bc3NpZ25Qcm9kdWN0LAogIGlzU2VsZWN0ZWQgPSBmYWxzZSwKICBvblNlbGVjdGlvbkNoYW5nZSwKICBpc0hpZ2hsaWdodGVkID0gZmFsc2UsCiAgd2FyZWhvdXNlTmFtZSA9ICJHYWxww6NvIiwKICBhaXNsZU5hbWUgPSAiUjEiLAp9OiBTaGVsZkl0ZW1Qcm9wcykgewogIGNvbnN0IFtpc1Byb2R1Y3RMaXN0T3Blbiwgc2V0SXNQcm9kdWN0TGlzdE9wZW5dID0gdXNlU3RhdGUoZmFsc2UpCiAgY29uc3QgW2lzQXNzaWduRGlhbG9nT3Blbiwgc2V0SXNBc3NpZ25EaWFsb2dPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtvcHRpbWlzdGljU3RhdGUsIHNldE9wdGltaXN0aWNTdGF0ZV0gPSB1c2VTdGF0ZSh7CiAgICBlYW46IGVhbiwKICAgIHByb2R1Y3ROYW1lOiBwcm9kdWN0TmFtZSwKICAgIGxhc3RWZXJpZmllZDogbGFzdFZlcmlmaWVkLAogIH0pCgogIGNvbnN0IGlzSGlnaGxpZ2h0ZWRFcnJvciA9IG9wdGltaXN0aWNTdGF0ZS5lYW4gJiYgb3B0aW1pc3RpY1N0YXRlLmVhbi5zdGFydHNXaXRoKCJFUlJPUiIpCgogIGNvbnN0IFRIUkVTSE9MRF9EQVlTID0gMzAKICBjb25zdCBuZWVkc1ZlcmlmaWNhdGlvbiA9IG9wdGltaXN0aWNTdGF0ZS5sYXN0VmVyaWZpZWQKICAgID8gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gb3B0aW1pc3RpY1N0YXRlLmxhc3RWZXJpZmllZC5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpID4gVEhSRVNIT0xEX0RBWVMKICAgIDogdHJ1ZQoKICBjb25zdCBoYW5kbGVSZW1vdmVTZWxlY3RlZFByb2R1Y3RzID0gYXN5bmMgKHNlbGVjdGVkRWFuczogc3RyaW5nW10pID0+IHsKICAgIGlmICghb3B0aW1pc3RpY1N0YXRlLmVhbiB8fCAhb3B0aW1pc3RpY1N0YXRlLnByb2R1Y3ROYW1lKSByZXR1cm4KCiAgICB0cnkgewogICAgICBmb3IgKGNvbnN0IGVhblRvUmVtb3ZlIG9mIHNlbGVjdGVkRWFucykgewogICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCkKICAgICAgICBjb25zdCByZW1vdmVBY3Rpb24gPSByZW1vdmVJbmRpdmlkdWFsUHJvZHVjdEZyb21TaGVsZi5iaW5kKG51bGwsIGlkLCBlYW5Ub1JlbW92ZSkKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZW1vdmVBY3Rpb24oeyBtZXNzYWdlOiAiIiwgc3VjY2VzczogZmFsc2UgfSwgZm9ybURhdGEpCgogICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgIHRvYXN0KHsKICAgICAgICAgICAgdGl0bGU6IGBFcnJvIGFvIHJlbW92ZXIgcHJvZHV0byAke2VhblRvUmVtb3ZlfTogJHtyZXN1bHQubWVzc2FnZX1gLAogICAgICAgICAgICB2YXJpYW50OiAiZGVzdHJ1Y3RpdmUiLAogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgY3VycmVudEVhbnMgPSBvcHRpbWlzdGljU3RhdGUuZWFuLnNwbGl0KCI7IikubWFwKChlYW4pID0+IGVhbi50cmltKCkpCiAgICAgIGNvbnN0IGN1cnJlbnROYW1lcyA9IG9wdGltaXN0aWNTdGF0ZS5wcm9kdWN0TmFtZS5zcGxpdCgiOyIpLm1hcCgobmFtZSkgPT4gbmFtZS50cmltKCkpCgogICAgICBjb25zdCByZW1haW5pbmdFYW5zOiBzdHJpbmdbXSA9IFtdCiAgICAgIGNvbnN0IHJlbWFpbmluZ05hbWVzOiBzdHJpbmdbXSA9IFtdCgogICAgICBjdXJyZW50RWFucy5mb3JFYWNoKChlYW4sIGluZGV4KSA9PiB7CiAgICAgICAgaWYgKCFzZWxlY3RlZEVhbnMuaW5jbHVkZXMoZWFuKSkgewogICAgICAgICAgcmVtYWluaW5nRWFucy5wdXNoKGVhbikKICAgICAgICAgIHJlbWFpbmluZ05hbWVzLnB1c2goY3VycmVudE5hbWVzW2luZGV4XSB8fCAiIikKICAgICAgICB9CiAgICAgIH0pCgogICAgICBzZXRPcHRpbWlzdGljU3RhdGUoewogICAgICAgIGVhbjogcmVtYWluaW5nRWFucy5sZW5ndGggPiAwID8gcmVtYWluaW5nRWFucy5qb2luKCI7ICIpIDogbnVsbCwKICAgICAgICBwcm9kdWN0TmFtZTogcmVtYWluaW5nTmFtZXMubGVuZ3RoID4gMCA/IHJlbWFpbmluZ05hbWVzLmpvaW4oIjsgIikgOiBudWxsLAogICAgICAgIGxhc3RWZXJpZmllZDogbmV3IERhdGUoKSwKICAgICAgfSkKCiAgICAgIHNldElzUHJvZHVjdExpc3RPcGVuKGZhbHNlKQoKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiBgJHtzZWxlY3RlZEVhbnMubGVuZ3RofSBwcm9kdXRvKHMpIHJlbW92aWRvKHMpIGRvIGFuZGFyICR7bGV2ZWx9YCwKICAgICAgICB2YXJpYW50OiAiZGVmYXVsdCIsCiAgICAgIH0pCgogICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpCiAgICAgIHBhcmFtcy5zZXQoImhpZ2hsaWdodCIsIGlkKQogICAgICBwYXJhbXMuc2V0KCJ0eXBlIiwgInNoZWxmIikKICAgICAgY29uc3QgbmV3VXJsID0gYCR7d2luZG93LmxvY2F0aW9uLnBhdGhuYW1lfT8ke3BhcmFtcy50b1N0cmluZygpfWAKICAgICAgcm91dGVyLnJlcGxhY2UobmV3VXJsLCB7IHNjcm9sbDogZmFsc2UgfSkKICAgICAgcm91dGVyLnJlZnJlc2goKQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcigiRXJybyBhbyByZW1vdmVyIHByb2R1dG9zOiIsIGVycm9yKQogICAgICB0b2FzdCh7CiAgICAgICAgdGl0bGU6ICJFcnJvIGFvIHJlbW92ZXIgcHJvZHV0b3MiLAogICAgICAgIHZhcmlhbnQ6ICJkZXN0cnVjdGl2ZSIsCiAgICAgIH0pCiAgICB9CiAgfQoKICBjb25zdCBoYW5kbGVQcmludFNlbGVjdGVkUHJvZHVjdHMgPSAoc2VsZWN0ZWRFYW5zOiBzdHJpbmdbXSwgc2VsZWN0ZWRQcm9kdWN0czogYW55W10pID0+IHsKICAgIGNvbnN0IGV4dHJhY3RXYXJlaG91c2VOdW1iZXIgPSAod2FyZWhvdXNlTmFtZTogc3RyaW5nKTogc3RyaW5nID0+IHsKICAgICAgY29uc3QgcGF0dGVybnMgPSBbL0dhbHDDo29ccyooXGQrKS9pLCAvQShcZCspL2ksIC8oXGQrKS9dCgogICAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgcGF0dGVybnMpIHsKICAgICAgICBjb25zdCBtYXRjaCA9IHdhcmVob3VzZU5hbWUubWF0Y2gocGF0dGVybikKICAgICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHsKICAgICAgICAgIHJldHVybiBtYXRjaFsxXQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuICIxIgogICAgfQoKICAgIGNvbnN0IGxhYmVsc0RhdGEgPSBzZWxlY3RlZFByb2R1Y3RzLm1hcCgocHJvZHVjdCwgaW5kZXgpID0+ICh7CiAgICAgIGlkOiBgJHtpZH0tJHtwcm9kdWN0LmVhbn1gLAogICAgICB0eXBlOiAic2hlbGYiIGFzIGNvbnN0LAogICAgICB3YXJlaG91c2VOYW1lOiB3YXJlaG91c2VOYW1lLAogICAgICBhaXNsZU5hbWU6IGFpc2xlTmFtZSwKICAgICAgcG9zaXRpb246IHBvc2l0aW9uLAogICAgICBsZXZlbDogbGV2ZWwsCiAgICAgIGVhbjogcHJvZHVjdC5lYW4sCiAgICAgIHByb2R1Y3ROYW1lOiBwcm9kdWN0Lm5hbWUsCiAgICB9KSkKCiAgICBjb25zdCBwcmludENvbnRlbnQgPSBgCiAgICAgIDwhRE9DVFlQRSBodG1sPgogICAgICA8aHRtbD4KICAgICAgPGhlYWQ+CiAgICAgICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogICAgICAgIDx0aXRsZT5FdGlxdWV0YXMgZGUgUHJvZHV0b3MgU2VsZWNpb25hZG9zPC90aXRsZT4KICAgICAgICA8c3R5bGU+CiAgICAgICAgICAqIHsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9CiAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IH0KICAgICAgICAgIC5sYWJlbC1wYWdlIHsgCiAgICAgICAgICAgIHdpZHRoOiAxMDBtbTsgCiAgICAgICAgICAgIGhlaWdodDogNTBtbTsgCiAgICAgICAgICAgIG1hcmdpbjogMDsgCiAgICAgICAgICAgIHBhZGRpbmc6IDA7IAogICAgICAgICAgICBwYWdlLWJyZWFrLWFmdGVyOiBhbHdheXM7IAogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OyAKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7IAogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICB9CiAgICAgICAgICAubGFiZWwtcGFnZTpsYXN0LWNoaWxkIHsgcGFnZS1icmVhay1hZnRlcjogYXZvaWQ7IH0KICAgICAgICAgIC5sYWJlbC1sb2NhdGlvbiB7IAogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogM21tOwogICAgICAgICAgICBsZWZ0OiA1MCU7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICAgICAgICAgICAgZm9udC1zaXplOiAxNHB0OyAKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7IAogICAgICAgICAgICBjb2xvcjogIzM3NDE1MTsgCiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjI7IAogICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7IAogICAgICAgICAgICBtYXgtd2lkdGg6IDk1JTsgCiAgICAgICAgICB9CiAgICAgICAgICAubGFiZWwtZWFuIHsgCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogODBweDsgCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOyAKICAgICAgICAgICAgY29sb3I6ICMwMDA7IAogICAgICAgICAgICBsaW5lLWhlaWdodDogMTsgCiAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsgCiAgICAgICAgICAgIG1heC13aWR0aDogOTUlOyAKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgfQogICAgICAgICAgLmxhYmVsLXByb2R1Y3QgeyAKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICBib3R0b206IDNtbTsKICAgICAgICAgICAgbGVmdDogNTAlOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogOHB0OyAKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsgCiAgICAgICAgICAgIGNvbG9yOiAjNkI3MjgwOyAKICAgICAgICAgICAgbWF4LXdpZHRoOiA4NW1tOyAKICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOyAKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjsgCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICB9CiAgICAgICAgICBAbWVkaWEgcHJpbnQgeyAKICAgICAgICAgICAgYm9keSB7IG1hcmdpbjogMDsgfSAKICAgICAgICAgICAgLmxhYmVsLXBhZ2UgeyBtYXJnaW46IDA7IH0gCiAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgICAgPC9oZWFkPgogICAgICA8Ym9keT4KICAgICAgICAke2xhYmVsc0RhdGEKICAgICAgICAgIC5tYXAoKGxhYmVsKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHdhcmVob3VzZU51bWJlciA9IGV4dHJhY3RXYXJlaG91c2VOdW1iZXIobGFiZWwud2FyZWhvdXNlTmFtZSkKICAgICAgICAgICAgY29uc3QgYWlzbGVOdW1iZXIgPSBsYWJlbC5haXNsZU5hbWUucmVwbGFjZSgvXEQvZywgIiIpIHx8IGxhYmVsLmFpc2xlTmFtZQoKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgIDxkaXYgY2xhc3M9ImxhYmVsLXBhZ2UiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsYWJlbC1sb2NhdGlvbiI+CiAgICAgICAgICAgICAgQSR7d2FyZWhvdXNlTnVtYmVyfT5SJHthaXNsZU51bWJlcn0+UCR7bGFiZWwucG9zaXRpb259PkEke2xhYmVsLmxldmVsfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGFiZWwtZWFuIj4ke2xhYmVsLmVhbn08L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGFiZWwtcHJvZHVjdCI+JHtsYWJlbC5wcm9kdWN0TmFtZS5sZW5ndGggPiA1MCA/IGxhYmVsLnByb2R1Y3ROYW1lLnN1YnN0cmluZygwLCA1MCkgKyAiLi4uIiA6IGxhYmVsLnByb2R1Y3ROYW1lfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgYAogICAgICAgICAgfSkKICAgICAgICAgIC5qb2luKCIiKX0KICAgICAgPC9ib2R5PgogICAgICA8L2h0bWw+CiAgICBgCgogICAgY29uc3QgcHJpbnRXaW5kb3cgPSB3aW5kb3cub3BlbigiIiwgIl9ibGFuayIsICJ3aWR0aD04MDAsaGVpZ2h0PTYwMCIpCiAgICBpZiAocHJpbnRXaW5kb3cpIHsKICAgICAgcHJpbnRXaW5kb3cuZG9jdW1lbnQud3JpdGUocHJpbnRDb250ZW50KQogICAgICBwcmludFdpbmRvdy5kb2N1bWVudC5jbG9zZSgpCiAgICAgIHByaW50V2luZG93Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHByaW50V2luZG93LnByaW50KCkKICAgICAgICAgIHByaW50V2luZG93LmNsb3NlKCkKICAgICAgICB9LCA1MDApCiAgICAgIH0KICAgIH0KCiAgICBzZXRJc1Byb2R1Y3RMaXN0T3BlbihmYWxzZSkKICB9CgogIGNvbnN0IGhhbmRsZUNhcmRDbGljayA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50KSA9PiB7CiAgICBjb25zb2xlLmxvZyhgQ2FyZCBjbGlja2VkIC0gQW5kYXIgSUQ6ICR7aWR9LCBQb3Npw6fDo286ICR7cG9zaXRpb259LCBOw612ZWw6ICR7bGV2ZWx9YCkKCiAgICBlLnByZXZlbnREZWZhdWx0KCkKICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKCiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudAogICAgaWYgKAogICAgICB0YXJnZXQuY2xvc2VzdCgnYnV0dG9uW2FyaWEtbGFiZWw9IkxpbXBhciBBbmRhciJdJykgfHwKICAgICAgdGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvblt0aXRsZT0iQWRpY2lvbmFyIFByb2R1dG8iXScpIHx8CiAgICAgIHRhcmdldC5jbG9zZXN0KCdbcm9sZT0iY2hlY2tib3giXScpIHx8CiAgICAgIHRhcmdldC5jbG9zZXN0KCdbcm9sZT0iZGlhbG9nIl0nKSB8fAogICAgICB0YXJnZXQuY2xvc2VzdCgiLmRpYWxvZy1jb250ZW50IikKICAgICkgewogICAgICBjb25zb2xlLmxvZygiQ2xpcXVlIGZvaSBlbSBib3TDo28sIGNoZWNrYm94IG91IG1vZGFsLCBpZ25vcmFuZG8uLi4iKQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAoaGFzUHJvZHVjdCkgewogICAgICBjb25zb2xlLmxvZygiQWJyaW5kbyBtb2RhbCBkZSBsaXN0YSBkZSBwcm9kdXRvcy4uLiIpCiAgICAgIHNldElzUHJvZHVjdExpc3RPcGVuKHRydWUpCiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLmxvZygiQW5kYXIgdmF6aW8sIHVzZSBvIGJvdMOjbyArIHBhcmEgYWRpY2lvbmFyIHByb2R1dG8iKQogICAgfQogIH0KCiAgY29uc3QgaGFuZGxlU2VsZWN0aW9uQ2hhbmdlID0gKGNoZWNrZWQ6IGJvb2xlYW4pID0+IHsKICAgIGlmIChvblNlbGVjdGlvbkNoYW5nZSkgewogICAgICBvblNlbGVjdGlvbkNoYW5nZShpZCwgY2hlY2tlZCkKICAgIH0KICB9CgogIGNvbnN0IGhhbmRsZU9wdGltaXN0aWNSZW1vdmUgPSAoKSA9PiB7CiAgICBjb25zb2xlLmxvZyhgQXR1YWxpemHDp8OjbyBvdGltaXN0YSAtIHJlbW92ZW5kbyBwcm9kdXRvIGRhIHByYXRlbGVpcmEgJHtpZH1gKQogICAgc2V0T3B0aW1pc3RpY1N0YXRlKHsKICAgICAgZWFuOiBudWxsLAogICAgICBwcm9kdWN0TmFtZTogbnVsbCwKICAgICAgbGFzdFZlcmlmaWVkOiBuZXcgRGF0ZSgpLAogICAgfSkKICB9CgogIGNvbnN0IGhhbmRsZUFzc2lnblN1Y2Nlc3MgPSAoKSA9PiB7CiAgICBzZXRJc0Fzc2lnbkRpYWxvZ09wZW4oZmFsc2UpCiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpCiAgICB9LCA1MDApCiAgfQoKICBjb25zdCBoYXNQcm9kdWN0ID0gb3B0aW1pc3RpY1N0YXRlLmVhbiAmJiBvcHRpbWlzdGljU3RhdGUuZWFuLnRyaW0oKSAhPT0gIiIKICBjb25zdCBlYW5Db3VudCA9IGNvdW50RUFOcyhvcHRpbWlzdGljU3RhdGUuZWFuKQogIGNvbnN0IGRpc3BsYXlFQU4gPSBmb3JtYXRFQU5zRm9yRGlzcGxheShvcHRpbWlzdGljU3RhdGUuZWFuKQoKICByZXR1cm4gKAogICAgPD4KICAgICAgPENhcmQKICAgICAgICBkYXRhLWhpZ2hsaWdodC1pZD17aWR9CiAgICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAgICJyZWxhdGl2ZSB3LWZ1bGwgaC0xMiBmbGV4IGl0ZW1zLWNlbnRlciBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgYm9yZGVyIHJvdW5kZWQtbGciLAogICAgICAgICAgImJvcmRlci1iLTAgbGFzdDpib3JkZXItYiIsCiAgICAgICAgICAiaG92ZXI6YmctZ3JheS01MCBkYXJrOmhvdmVyOmJnLWdyYXktODAwLzUwIiwKICAgICAgICAgIGlzU2VsZWN0ZWQgJiYgInJpbmctMiByaW5nLWJsdWUtNTAwIGJnLWJsdWUtNTAgZGFyazpiZy1ibHVlLTkwMC8yMCBkYXJrOnJpbmctYmx1ZS00MDAiLAogICAgICAgICAgaXNIaWdobGlnaHRlZCAmJiAiYmctcmVkLTEwMCBib3JkZXItcmVkLTUwMCBib3JkZXItMiBkYXJrOmJnLXJlZC05MDAvMzAgZGFyazpib3JkZXItcmVkLTQwMCIsCiAgICAgICAgICBpc0hpZ2hsaWdodGVkRXJyb3IKICAgICAgICAgICAgPyAiYmctcmVkLTEwMCBib3JkZXItcmVkLTQwMCB0ZXh0LXJlZC04MDAgaG92ZXI6YmctcmVkLTIwMCBkYXJrOmJnLXJlZC05MDAvNDAgZGFyazpib3JkZXItcmVkLTUwMCBkYXJrOnRleHQtcmVkLTMwMCBkYXJrOmhvdmVyOmJnLXJlZC05MDAvNjAiCiAgICAgICAgICAgIDogIiIsCiAgICAgICAgICAiIiwKICAgICAgICApfQogICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNhcmRDbGlja30KICAgICAgPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJhYnNvbHV0ZSB0b3AtMC41IGxlZnQtMC41IHotMjAiPgogICAgICAgICAgPENoZWNrYm94CiAgICAgICAgICAgIGNoZWNrZWQ9e2lzU2VsZWN0ZWR9CiAgICAgICAgICAgIG9uQ2hlY2tlZENoYW5nZT17aGFuZGxlU2VsZWN0aW9uQ2hhbmdlfQogICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKX0KICAgICAgICAgICAgY2xhc3NOYW1lPSJoLTMgdy0zIHJvdW5kZWQiCiAgICAgICAgICAvPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSJwLTIgZmxleCBpdGVtcy1jZW50ZXIgaC1mdWxsIHctZnVsbCI+CiAgICAgICAgICB7aGFzUHJvZHVjdCA/ICgKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiB3LWZ1bGwiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyBmbGV4LTEgbWluLXctMCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbSBmb250LWJvbGQgdGV4dC1ncmF5LTgwMCBkYXJrOnRleHQtZ3JheS0xMDAgZmxleC1zaHJpbmstMCI+QXtsZXZlbH08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBmbGV4LTEgbWluLXctMCI+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS02MDAgZGFyazp0ZXh0LWdyYXktMzAwIHRydW5jYXRlIj57ZGlzcGxheUVBTn08L2Rpdj4KICAgICAgICAgICAgICAgICAge2VhbkNvdW50ID4gMSAmJiAoCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj4KICAgICAgICAgICAgICAgICAgICAgIDxQYWNrYWdlIGNsYXNzTmFtZT0iaC0zIHctMyB0ZXh0LWJsdWUtNjAwIGRhcms6dGV4dC1ibHVlLTQwMCIgLz4KICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMC42cmVtXSBiZy1ibHVlLTEwMCBkYXJrOmJnLWJsdWUtOTAwLzMwIHRleHQtYmx1ZS03MDAgZGFyazp0ZXh0LWJsdWUtMzAwIHB4LTEgcm91bmRlZCI+CiAgICAgICAgICAgICAgICAgICAgICAgIHtlYW5Db3VudH0gaXRlbnMKICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgZmxleC1zaHJpbmstMCI+CiAgICAgICAgICAgICAgICB7b3B0aW1pc3RpY1N0YXRlLmxhc3RWZXJpZmllZCAmJiAoCiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSI+CiAgICAgICAgICAgICAgICAgICAgPENoZWNrQ2lyY2xlMgogICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAgICAgICAgICAgICAgICAgImgtMyB3LTMiLAogICAgICAgICAgICAgICAgICAgICAgICAidGV4dC1ncmVlbi02MDAgZGFyazp0ZXh0LWdyZWVuLTQwMCIsCiAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LVswLjY1cmVtXSB0ZXh0LWdyYXktNTAwIGRhcms6dGV4dC1ncmF5LTQwMCBoaWRkZW4gc206aW5saW5lIj4KICAgICAgICAgICAgICAgICAgICAgIHtvcHRpbWlzdGljU3RhdGUubGFzdFZlcmlmaWVkLnRvTG9jYWxlRGF0ZVN0cmluZygicHQtQlIiLCB7IGRheTogIjItZGlnaXQiLCBtb250aDogIjItZGlnaXQiIH0pfQogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgIHtpc0R1cGxpY2F0ZWRFQU4gJiYgKAogICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgdGV4dC1vcmFuZ2UtNTAwIGRhcms6dGV4dC1vcmFuZ2UtNDAwIj4KICAgICAgICAgICAgICAgICAgICA8QWxlcnRDaXJjbGUgY2xhc3NOYW1lPSJoLTMgdy0zIiAvPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMC42NXJlbV0gZm9udC1tZWRpdW0gaGlkZGVuIHNtOmlubGluZSI+RHVwPC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgKSA6ICgKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiB3LWZ1bGwiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbSBmb250LWJvbGQgdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0yMDAiPkF7bGV2ZWx9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LWdyYXktNDAwIGRhcms6dGV4dC1ncmF5LTUwMCI+KFZhemlvKTwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICA8QWRkUHJvZHVjdFRvU2hlbGZCdXR0b24KICAgICAgICAgICAgICAgICAgc2hlbGZJZD17aWR9CiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uPXtwb3NpdGlvbn0KICAgICAgICAgICAgICAgICAgbGV2ZWw9e2xldmVsfQogICAgICAgICAgICAgICAgICBjdXJyZW50RWFuPXtvcHRpbWlzdGljU3RhdGUuZWFuIHx8ICIifQogICAgICAgICAgICAgICAgICBjdXJyZW50UHJvZHVjdE5hbWU9e29wdGltaXN0aWNTdGF0ZS5wcm9kdWN0TmFtZSB8fCAiIn0KICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1bMC42NXJlbV0gdGV4dC1ibHVlLTUwMCBkYXJrOnRleHQtYmx1ZS00MDAgZm9udC1tZWRpdW0iPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImhpZGRlbiBzbTppbmxpbmUiPkFkaWNpb25hciBwcm9kdXRvPC9zcGFuPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InNtOmhpZGRlbiI+Kzwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICl9CiAgICAgICAgPC9DYXJkQ29udGVudD4KCiAgICAgICAgPFVuYXNzaWduQnV0dG9uCiAgICAgICAgICBzaGVsZklkPXtpZH0KICAgICAgICAgIHBvc2l0aW9uPXtwb3NpdGlvbn0KICAgICAgICAgIGxldmVsPXtsZXZlbH0KICAgICAgICAgIGhhc1Byb2R1Y3Q9e2hhc1Byb2R1Y3R9CiAgICAgICAgICBvbk9wdGltaXN0aWNVcGRhdGU9e2hhbmRsZU9wdGltaXN0aWNSZW1vdmV9CiAgICAgICAgLz4KICAgICAgPC9DYXJkPgoKICAgICAgPFByb2R1Y3RMaXN0TW9kYWwKICAgICAgICBpc09wZW49e2lzUHJvZHVjdExpc3RPcGVufQogICAgICAgIG9uQ2xvc2U9eygpID0+IHNldElzUHJvZHVjdExpc3RPcGVuKGZhbHNlKX0KICAgICAgICB0aXRsZT17YFByb2R1dG9zIC0gQW5kYXIgJHtsZXZlbH1gfQogICAgICAgIGRlc2NyaXB0aW9uPXtgRXN0ZSBhbmRhciBjb250w6ltICR7ZWFuQ291bnR9ICR7ZWFuQ291bnQgPT09IDEgPyAicHJvZHV0byIgOiAicHJvZHV0b3MgZGlmZXJlbnRlcyJ9LmB9CiAgICAgICAgZWFucz17b3B0aW1pc3RpY1N0YXRlLmVhbiB8fCAiIn0KICAgICAgICBwcm9kdWN0TmFtZXM9e29wdGltaXN0aWNTdGF0ZS5wcm9kdWN0TmFtZSB8fCAiIn0KICAgICAgICBzdG9yYWdlVHlwZT0ic2hlbGYiCiAgICAgICAgb25SZW1vdmVTZWxlY3RlZD17aGFuZGxlUmVtb3ZlU2VsZWN0ZWRQcm9kdWN0c30KICAgICAgICBvblByaW50U2VsZWN0ZWQ9e2hhbmRsZVByaW50U2VsZWN0ZWRQcm9kdWN0c30KICAgICAgLz4KCiAgICAgIDxEaWFsb2cgb3Blbj17aXNBc3NpZ25EaWFsb2dPcGVufSBvbk9wZW5DaGFuZ2U9e3NldElzQXNzaWduRGlhbG9nT3Blbn0+CiAgICAgICAgPERpYWxvZ0NvbnRlbnQgY2xhc3NOYW1lPSJzbTptYXgtdy1bNDI1cHhdIHctWzk1dnddIG1heC1oLVs5MHZoXSBvdmVyZmxvdy15LWF1dG8gcm91bmRlZC14bCI+CiAgICAgICAgICA8RGlhbG9nSGVhZGVyPgogICAgICAgICAgICA8RGlhbG9nVGl0bGU+QWRpY2lvbmFyIFByb2R1dG8gLSBBbmRhciB7bGV2ZWx9PC9EaWFsb2dUaXRsZT4KICAgICAgICAgICAgPERpYWxvZ0Rlc2NyaXB0aW9uPkFkaWNpb25lIHVtIHByb2R1dG8gYSBlc3RlIGFuZGFyIGRhIHByYXRlbGVpcmEge3Bvc2l0aW9ufS48L0RpYWxvZ0Rlc2NyaXB0aW9uPgogICAgICAgICAgPC9EaWFsb2dIZWFkZXI+CiAgICAgICAgICB7LyogSW1wbGVtZW50YW5kbyBmb3JtdWzDoXJpbyBkZSBhdHJpYnVpw6fDo28gZGUgcHJvZHV0byBwYXJhIHByYXRlbGVpcmFzICovfQogICAgICAgICAgey8qIDxGT1JNPiAqL30KICAgICAgICAgIHsvKiA8L0ZPUk0+ICovfQogICAgICAgICAge2hhc1Byb2R1Y3QgJiYgPFZlcmlmeUJ1dHRvbiBzaGVsZklkPXtpZH0gLz59CiAgICAgICAgPC9EaWFsb2dDb250ZW50PgogICAgICA8L0RpYWxvZz4KICAgIDwvPgogICkKfQoKZXhwb3J0IGZ1bmN0aW9uIFBhbGxldEl0ZW0oewogIGlkLAogIHBvc2l0aW9uLAogIGVhbiwKICBwcm9kdWN0TmFtZSwKICBsYXN0VmVyaWZpZWQsCiAgaXNEdXBsaWNhdGVkRUFOLAogIGlzU2VsZWN0ZWQgPSBmYWxzZSwKICBvblNlbGVjdGlvbkNoYW5nZSwKICBpc0hpZ2hsaWdodGVkID0gZmFsc2UsCiAgd2FyZWhvdXNlTmFtZSA9ICJHYWxww6NvIiwKICBhaXNsZU5hbWUgPSAiUjEiLAp9OiBQYWxsZXRJdGVtUHJvcHMpIHsKICBjb25zdCBbaXNQcm9kdWN0TGlzdE9wZW4sIHNldElzUHJvZHVjdExpc3RPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtpc0Fzc2lnbkRpYWxvZ09wZW4sIHNldElzQXNzaWduRGlhbG9nT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSkKICBjb25zdCBbb3B0aW1pc3RpY1N0YXRlLCBzZXRPcHRpbWlzdGljU3RhdGVdID0gdXNlU3RhdGUoewogICAgZWFuOiBlYW4sCiAgICBwcm9kdWN0TmFtZTogcHJvZHVjdE5hbWUsCiAgICBsYXN0VmVyaWZpZWQ6IGxhc3RWZXJpZmllZCwKICB9KQoKICBjb25zdCBpc0hpZ2hsaWdodGVkRXJyb3IgPSBvcHRpbWlzdGljU3RhdGUuZWFuICYmIG9wdGltaXN0aWNTdGF0ZS5lYW4uc3RhcnRzV2l0aCgiRVJST1IiKQoKICBjb25zdCBUSFJFU0hPTERfREFZUyA9IDMwCiAgY29uc3QgbmVlZHNWZXJpZmljYXRpb24gPSBvcHRpbWlzdGljU3RhdGUubGFzdFZlcmlmaWVkCiAgICA/IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIG9wdGltaXN0aWNTdGF0ZS5sYXN0VmVyaWZpZWQuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSA+IFRIUkVTSE9MRF9EQVlTCiAgICA6IHRydWUKCiAgY29uc3QgaGFuZGxlUmVtb3ZlU2VsZWN0ZWRQcm9kdWN0cyA9IGFzeW5jIChzZWxlY3RlZEVhbnM6IHN0cmluZ1tdKSA9PiB7CiAgICBpZiAoIW9wdGltaXN0aWNTdGF0ZS5lYW4gfHwgIW9wdGltaXN0aWNTdGF0ZS5wcm9kdWN0TmFtZSkgcmV0dXJuCgogICAgdHJ5IHsKICAgICAgZm9yIChjb25zdCBlYW5Ub1JlbW92ZSBvZiBzZWxlY3RlZEVhbnMpIHsKICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpCiAgICAgICAgY29uc3QgcmVtb3ZlQWN0aW9uID0gcmVtb3ZlSW5kaXZpZHVhbFByb2R1Y3RGcm9tUGFsbGV0LmJpbmQobnVsbCwgaWQsIGVhblRvUmVtb3ZlKQogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlbW92ZUFjdGlvbih7IG1lc3NhZ2U6ICIiLCBzdWNjZXNzOiBmYWxzZSB9LCBmb3JtRGF0YSkKCiAgICAgICAgaWYgKCFyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgdG9hc3QoewogICAgICAgICAgICB0aXRsZTogYEVycm8gYW8gcmVtb3ZlciBwcm9kdXRvICR7ZWFuVG9SZW1vdmV9OiAke3Jlc3VsdC5tZXNzYWdlfWAsCiAgICAgICAgICAgIHZhcmlhbnQ6ICJkZXN0cnVjdGl2ZSIsCiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBjdXJyZW50RWFucyA9IG9wdGltaXN0aWNTdGF0ZS5lYW4uc3BsaXQoIjsiKS5tYXAoKGVhbikgPT4gZWFuLnRyaW0oKSkKICAgICAgY29uc3QgY3VycmVudE5hbWVzID0gb3B0aW1pc3RpY1N0YXRlLnByb2R1Y3ROYW1lLnNwbGl0KCI7IikubWFwKChuYW1lKSA9PiBuYW1lLnRyaW0oKSkKCiAgICAgIGNvbnN0IHJlbWFpbmluZ0VhbnM6IHN0cmluZ1tdID0gW10KICAgICAgY29uc3QgcmVtYWluaW5nTmFtZXM6IHN0cmluZ1tdID0gW10KCiAgICAgIGN1cnJlbnRFYW5zLmZvckVhY2goKGVhbiwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoIXNlbGVjdGVkRWFucy5pbmNsdWRlcyhlYW4pKSB7CiAgICAgICAgICByZW1haW5pbmdFYW5zLnB1c2goZWFuKQogICAgICAgICAgcmVtYWluaW5nTmFtZXMucHVzaChjdXJyZW50TmFtZXNbaW5kZXhdIHx8ICIiKQogICAgICAgIH0KICAgICAgfSkKCiAgICAgIHNldE9wdGltaXN0aWNTdGF0ZSh7CiAgICAgICAgZWFuOiByZW1haW5pbmdFYW5zLmxlbmd0aCA+IDAgPyByZW1haW5pbmdFYW5zLmpvaW4oIjsgIikgOiBudWxsLAogICAgICAgIHByb2R1Y3ROYW1lOiByZW1haW5pbmdOYW1lcy5sZW5ndGggPiAwID8gcmVtYWluaW5nTmFtZXMuam9pbigiOyAiKSA6IG51bGwsCiAgICAgICAgbGFzdFZlcmlmaWVkOiBuZXcgRGF0ZSgpLAogICAgICB9KQoKICAgICAgc2V0SXNQcm9kdWN0TGlzdE9wZW4oZmFsc2UpCgogICAgICB0b2FzdCh7CiAgICAgICAgdGl0bGU6IGAke3NlbGVjdGVkRWFucy5sZW5ndGh9IHByb2R1dG8ocykgcmVtb3ZpZG8ocykgZG8gcGFsZXRlICR7cG9zaXRpb259YCwKICAgICAgICB2YXJpYW50OiAiZGVmYXVsdCIsCiAgICAgIH0pCgogICAgICBzZXRUaW1lb3V0KCgpID0+IHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSwgMTAwMCkKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm8gYW8gcmVtb3ZlciBwcm9kdXRvczoiLCBlcnJvcikKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiAiRXJybyBhbyByZW1vdmVyIHByb2R1dG9zIiwKICAgICAgICB2YXJpYW50OiAiZGVzdHJ1Y3RpdmUiLAogICAgICB9KQogICAgfQogIH0KCiAgY29uc3QgaGFuZGxlUHJpbnRTZWxlY3RlZFByb2R1Y3RzID0gKHNlbGVjdGVkRWFuczogc3RyaW5nW10sIHNlbGVjdGVkUHJvZHVjdHM6IGFueVtdKSA9PiB7CiAgICBjb25zdCBleHRyYWN0V2FyZWhvdXNlTnVtYmVyID0gKHdhcmVob3VzZU5hbWU6IHN0cmluZyk6IHN0cmluZyA9PiB7CiAgICAgIGNvbnN0IHBhdHRlcm5zID0gWy9HYWxww6NvXHMqKFxkKykvaSwgL0EoXGQrKS9pLCAvKFxkKykvXQoKICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7CiAgICAgICAgY29uc3QgbWF0Y2ggPSB3YXJlaG91c2VOYW1lLm1hdGNoKHBhdHRlcm4pCiAgICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7CiAgICAgICAgICByZXR1cm4gbWF0Y2hbMV0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAiMSIKICAgIH0KCiAgICBjb25zdCBsYWJlbHNEYXRhID0gc2VsZWN0ZWRQcm9kdWN0cy5tYXAoKHByb2R1Y3QsIGluZGV4KSA9PiAoewogICAgICBpZDogYCR7aWR9LSR7cHJvZHVjdC5lYW59YCwKICAgICAgdHlwZTogInBhbGxldCIgYXMgY29uc3QsCiAgICAgIHdhcmVob3VzZU5hbWU6IHdhcmVob3VzZU5hbWUsCiAgICAgIGFpc2xlTmFtZTogYWlzbGVOYW1lLAogICAgICBwb3NpdGlvbjogcG9zaXRpb24sCiAgICAgIGVhbjogcHJvZHVjdC5lYW4sCiAgICAgIHByb2R1Y3ROYW1lOiBwcm9kdWN0Lm5hbWUsCiAgICB9KSkKCiAgICBjb25zdCBwcmludENvbnRlbnQgPSBgCiAgICAgIDwhRE9DVFlQRSBodG1sPgogICAgICA8aHRtbD4KICAgICAgPGhlYWQ+CiAgICAgICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogICAgICAgIDx0aXRsZT5FdGlxdWV0YXMgZGUgUHJvZHV0b3MgU2VsZWNpb25hZG9zPC90aXRsZT4KICAgICAgICA8c3R5bGU+CiAgICAgICAgICAqIHsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9CiAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IH0KICAgICAgICAgIC5sYWJlbC1wYWdlIHsgCiAgICAgICAgICAgIHdpZHRoOiAxMDBtbTsgCiAgICAgICAgICAgIGhlaWdodDogNTBtbTsgCiAgICAgICAgICAgIG1hcmdpbjogMDsgCiAgICAgICAgICAgIHBhZGRpbmc6IDA7IAogICAgICAgICAgICBwYWdlLWJyZWFrLWFmdGVyOiBhbHdheXM7IAogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OyAKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7IAogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICB9CiAgICAgICAgICAubGFiZWwtcGFnZTpsYXN0LWNoaWxkIHsgcGFnZS1icmVhay1hZnRlcjogYXZvaWQ7IH0KICAgICAgICAgIC5sYWJlbC1sb2NhdGlvbiB7IAogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogM21tOwogICAgICAgICAgICBsZWZ0OiA1MCU7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICAgICAgICAgICAgZm9udC1zaXplOiAxNHB0OyAKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7IAogICAgICAgICAgICBjb2xvcjogIzM3NDE1MTsgCiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjI7IAogICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7IAogICAgICAgICAgICBtYXgtd2lkdGg6IDk1JTsgCiAgICAgICAgICB9CiAgICAgICAgICAubGFiZWwtZWFuIHsgCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogODBweDsgCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOyAKICAgICAgICAgICAgY29sb3I6ICMwMDA7IAogICAgICAgICAgICBsaW5lLWhlaWdodDogMTsgCiAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsgCiAgICAgICAgICAgIG1heC13aWR0aDogOTUlOyAKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgfQogICAgICAgICAgLmxhYmVsLXByb2R1Y3QgeyAKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICBib3R0b206IDNtbTsKICAgICAgICAgICAgbGVmdDogNTAlOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogOHB0OyAKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsgCiAgICAgICAgICAgIGNvbG9yOiAjNkI3MjgwOyAKICAgICAgICAgICAgbWF4LXdpZHRoOiA4NW1tOyAKICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOyAKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjsgCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICB9CiAgICAgICAgICBAbWVkaWEgcHJpbnQgeyAKICAgICAgICAgICAgYm9keSB7IG1hcmdpbjogMDsgfSAKICAgICAgICAgICAgLmxhYmVsLXBhZ2UgeyBtYXJnaW46IDA7IH0gCiAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgICAgPC9oZWFkPgogICAgICA8Ym9keT4KICAgICAgICAke2xhYmVsc0RhdGEKICAgICAgICAgIC5tYXAoKGxhYmVsKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHdhcmVob3VzZU51bWJlciA9IGV4dHJhY3RXYXJlaG91c2VOdW1iZXIobGFiZWwud2FyZWhvdXNlTmFtZSkKICAgICAgICAgICAgY29uc3QgYWlzbGVOdW1iZXIgPSBsYWJlbC5haXNsZU5hbWUucmVwbGFjZSgvXEQvZywgIiIpIHx8IGxhYmVsLmFpc2xlTmFtZQoKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgIDxkaXYgY2xhc3M9ImxhYmVsLXBhZ2UiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsYWJlbC1sb2NhdGlvbiI+CiAgICAgICAgICAgICAgQSR7d2FyZWhvdXNlTnVtYmVyfT5SJHthaXNsZU51bWJlcn0+UCR7bGFiZWwucG9zaXRpb259CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsYWJlbC1lYW4iPiR7bGFiZWwuZWFufTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsYWJlbC1wcm9kdWN0Ij4ke2xhYmVsLnByb2R1Y3ROYW1lLmxlbmd0aCA+IDUwID8gbGFiZWwucHJvZHVjdE5hbWUuc3Vic3RyaW5nKDAsIDUwKSArICIuLi4iIDogbGFiZWwucHJvZHVjdE5hbWV9PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICBgCiAgICAgICAgICB9KQogICAgICAgICAgLmpvaW4oIiIpfQogICAgICA8L2JvZHk+CiAgICAgIDwvaHRtbD4KICAgIGAKCiAgICBjb25zdCBwcmludFdpbmRvdyA9IHdpbmRvdy5vcGVuKCIiLCAiX2JsYW5rIiwgIndpZHRoPTgwMCxoZWlnaHQ9NjAwIikKICAgIGlmIChwcmludFdpbmRvdykgewogICAgICBwcmludFdpbmRvdy5kb2N1bWVudC53cml0ZShwcmludENvbnRlbnQpCiAgICAgIHByaW50V2luZG93LmRvY3VtZW50LmNsb3NlKCkKICAgICAgcHJpbnRXaW5kb3cub25sb2FkID0gKCkgPT4gewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcHJpbnRXaW5kb3cucHJpbnQoKQogICAgICAgICAgcHJpbnRXaW5kb3cuY2xvc2UoKQogICAgICAgIH0sIDUwMCkKICAgICAgfQogICAgfQoKICAgIHNldElzUHJvZHVjdExpc3RPcGVuKGZhbHNlKQogIH0KCiAgY29uc3QgaGFuZGxlQ2FyZENsaWNrID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQpID0+IHsKICAgIGUucHJldmVudERlZmF1bHQoKQogICAgZS5zdG9wUHJvcGFnYXRpb24oKQoKICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50CiAgICBpZiAoCiAgICAgIHRhcmdldC5jbG9zZXN0KCdidXR0b25bYXJpYS1sYWJlbD0iTGltcGFyIFBhbGV0ZSJdJykgfHwKICAgICAgdGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvblt0aXRsZT0iQWRpY2lvbmFyIFByb2R1dG8iXScpIHx8CiAgICAgIHRhcmdldC5jbG9zZXN0KCdbcm9sZT0iY2hlY2tib3giXScpIHx8CiAgICAgIHRhcmdldC5jbG9zZXN0KCdbcm9sZT0iZGlhbG9nIl0nKSB8fAogICAgICB0YXJnZXQuY2xvc2VzdCgiLmRpYWxvZy1jb250ZW50IikKICAgICkgewogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAoaGFzUHJvZHVjdCkgewogICAgICBzZXRJc1Byb2R1Y3RMaXN0T3Blbih0cnVlKQogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS5sb2coIlBhbGV0ZSB2YXppbywgdXNlIG8gYm90w6NvICsgcGFyYSBhZGljaW9uYXIgcHJvZHV0byIpCiAgICB9CiAgfQoKICBjb25zdCBoYW5kbGVTZWxlY3Rpb25DaGFuZ2UgPSAoY2hlY2tlZDogYm9vbGVhbikgPT4gewogICAgaWYgKG9uU2VsZWN0aW9uQ2hhbmdlKSB7CiAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlKGlkLCBjaGVja2VkKQogICAgfQogIH0KCiAgY29uc3QgaGFuZGxlT3B0aW1pc3RpY1JlbW92ZSA9ICgpID0+IHsKICAgIGNvbnNvbGUubG9nKGBBdHVhbGl6YcOnw6NvIG90aW1pc3RhIC0gcmVtb3ZlbmRvIHByb2R1dG8gZG8gcGFsZXRlICR7aWR9YCkKICAgIHNldE9wdGltaXN0aWNTdGF0ZSh7CiAgICAgIGVhbjogbnVsbCwKICAgICAgcHJvZHVjdE5hbWU6IG51bGwsCiAgICAgIGxhc3RWZXJpZmllZDogbmV3IERhdGUoKSwKICAgIH0pCiAgfQoKICBjb25zdCBoYW5kbGVBc3NpZ25TdWNjZXNzID0gKCkgPT4gewogICAgc2V0SXNBc3NpZ25EaWFsb2dPcGVuKGZhbHNlKQogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKQogICAgfSwgNTAwKQogIH0KCiAgY29uc3QgaGFzUHJvZHVjdCA9IG9wdGltaXN0aWNTdGF0ZS5lYW4gJiYgb3B0aW1pc3RpY1N0YXRlLmVhbi50cmltKCkgIT09ICIiCiAgY29uc3QgZWFuQ291bnQgPSBjb3VudEVBTnMob3B0aW1pc3RpY1N0YXRlLmVhbikKICBjb25zdCBkaXNwbGF5RUFOID0gZm9ybWF0RUFOc0ZvckRpc3BsYXkob3B0aW1pc3RpY1N0YXRlLmVhbikKCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIDxDYXJkCiAgICAgICAgZGF0YS1oaWdobGlnaHQtaWQ9e2lkfQogICAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgICAicmVsYXRpdmUgdy1mdWxsIGgtMTIgZmxleCBpdGVtcy1jZW50ZXIgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMjAwIGJvcmRlciByb3VuZGVkLWxnIiwKICAgICAgICAgICJib3JkZXItYi0wIGxhc3Q6Ym9yZGVyLWIiLAogICAgICAgICAgImhvdmVyOmJnLWdyYXktNTAgZGFyazpob3ZlcjpiZy1ncmF5LTgwMC81MCIsCiAgICAgICAgICBpc1NlbGVjdGVkICYmICJyaW5nLTIgcmluZy1ibHVlLTUwMCBiZy1ibHVlLTUwIGRhcms6YmctYmx1ZS05MDAvMjAgZGFyazpyaW5nLWJsdWUtNDAwIiwKICAgICAgICAgIGlzSGlnaGxpZ2h0ZWQgJiYgImJnLXJlZC0xMDAgYm9yZGVyLXJlZC01MDAgYm9yZGVyLTIgZGFyazpiZy1yZWQtOTAwLzMwIGRhcms6Ym9yZGVyLXJlZC00MDAiLAogICAgICAgICAgaXNIaWdobGlnaHRlZEVycm9yCiAgICAgICAgICAgID8gImJnLXJlZC0xMDAgYm9yZGVyLXJlZC00MDAgdGV4dC1yZWQtODAwIGhvdmVyOmJnLXJlZC0yMDAgZGFyazpiZy1yZWQtOTAwLzQwIGRhcms6Ym9yZGVyLXJlZC01MDAgZGFyazp0ZXh0LXJlZC0zMDAgZGFyazpob3ZlcjpiZy1yZWQtOTAwLzYwIgogICAgICAgICAgICA6ICIiLAogICAgICAgICAgIiIsCiAgICAgICAgKX0KICAgICAgICBvbkNsaWNrPXtoYW5kbGVDYXJkQ2xpY2t9CiAgICAgID4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWJzb2x1dGUgdG9wLTAuNSBsZWZ0LTAuNSB6LTIwIj4KICAgICAgICAgIDxDaGVja2JveAogICAgICAgICAgICBjaGVja2VkPXtpc1NlbGVjdGVkfQogICAgICAgICAgICBvbkNoZWNrZWRDaGFuZ2U9e2hhbmRsZVNlbGVjdGlvbkNoYW5nZX0KICAgICAgICAgICAgb25DbGljaz17KGUpID0+IGUuc3RvcFByb3BhZ2F0aW9uKCl9CiAgICAgICAgICAgIGNsYXNzTmFtZT0iaC0zIHctMyByb3VuZGVkIgogICAgICAgICAgLz4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT0icC0yIGZsZXggaXRlbXMtY2VudGVyIGgtZnVsbCB3LWZ1bGwiPgogICAgICAgICAge2hhc1Byb2R1Y3QgPyAoCiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gdy1mdWxsIj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgZmxleC0xIG1pbi13LTAiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtc20gZm9udC1ib2xkIHRleHQtZ3JheS04MDAgZGFyazp0ZXh0LWdyYXktMTAwIGZsZXgtc2hyaW5rLTAiPlB7cG9zaXRpb259PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgZmxleC0xIG1pbi13LTAiPgogICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyBmb250LW1lZGl1bSB0ZXh0LWdyYXktNjAwIGRhcms6dGV4dC1ncmF5LTMwMCB0cnVuY2F0ZSI+e2Rpc3BsYXlFQU59PC9kaXY+CiAgICAgICAgICAgICAgICAgIHtlYW5Db3VudCA+IDEgJiYgKAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSI+CiAgICAgICAgICAgICAgICAgICAgICA8UGFja2FnZSBjbGFzc05hbWU9ImgtMyB3LTMgdGV4dC1ibHVlLTYwMCBkYXJrOnRleHQtYmx1ZS00MDAiIC8+CiAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtWzAuNnJlbV0gYmctYmx1ZS0xMDAgZGFyazpiZy1ibHVlLTkwMC8zMCB0ZXh0LWJsdWUtNzAwIGRhcms6dGV4dC1ibHVlLTMwMCBweC0xIHJvdW5kZWQiPgogICAgICAgICAgICAgICAgICAgICAgICB7ZWFuQ291bnR9IGl0ZW5zCiAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGZsZXgtc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgPEFkZFByb2R1Y3RUb1BhbGxldEJ1dHRvbgogICAgICAgICAgICAgICAgICBwYWxsZXRJZD17aWR9CiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uPXtwb3NpdGlvbn0KICAgICAgICAgICAgICAgICAgY3VycmVudEVhbj17b3B0aW1pc3RpY1N0YXRlLmVhbiB8fCAiIn0KICAgICAgICAgICAgICAgICAgY3VycmVudFByb2R1Y3ROYW1lPXtvcHRpbWlzdGljU3RhdGUucHJvZHVjdE5hbWUgfHwgIiJ9CiAgICAgICAgICAgICAgICAvPgoKICAgICAgICAgICAgICAgIHtvcHRpbWlzdGljU3RhdGUubGFzdFZlcmlmaWVkICYmICgKICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj4KICAgICAgICAgICAgICAgICAgICA8Q2hlY2tDaXJjbGUyCiAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICAgICAgICAgICAgICAgICAiaC0zIHctMyIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0LWdyZWVuLTYwMCBkYXJrOnRleHQtZ3JlZW4tNDAwIiwKICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtWzAuNjVyZW1dIHRleHQtZ3JheS01MDAgZGFyazp0ZXh0LWdyYXktNDAwIGhpZGRlbiBzbTppbmxpbmUiPgogICAgICAgICAgICAgICAgICAgICAge29wdGltaXN0aWNTdGF0ZS5sYXN0VmVyaWZpZWQudG9Mb2NhbGVEYXRlU3RyaW5nKCJwdC1CUiIsIHsgZGF5OiAiMi1kaWdpdCIsIG1vbnRoOiAiMi1kaWdpdCIgfSl9CiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAge2lzRHVwbGljYXRlZEVBTiAmJiAoCiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSB0ZXh0LW9yYW5nZS01MDAgZGFyazp0ZXh0LW9yYW5nZS00MDAiPgogICAgICAgICAgICAgICAgICAgIDxBbGVydENpcmNsZSBjbGFzc05hbWU9ImgtMyB3LTMiIC8+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LVswLjY1cmVtXSBmb250LW1lZGl1bSBoaWRkZW4gc206aW5saW5lIj5EdXA8L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApIDogKAogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHctZnVsbCI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIGZvbnQtYm9sZCB0ZXh0LWdyYXktNzAwIGRhcms6dGV4dC1ncmF5LTIwMCI+UHtwb3NpdGlvbn08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtZ3JheS00MDAgZGFyazp0ZXh0LWdyYXktNTAwIj4oVmF6aW8pPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgIDxBZGRQcm9kdWN0VG9QYWxsZXRCdXR0b24gcGFsbGV0SWQ9e2lkfSBwb3NpdGlvbj17cG9zaXRpb259IC8+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1bMC42NXJlbV0gdGV4dC1ibHVlLTUwMCBkYXJrOnRleHQtYmx1ZS00MDAgZm9udC1tZWRpdW0iPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImhpZGRlbiBzbTppbmxpbmUiPkFkaWNpb25hciBwcm9kdXRvPC9zcGFuPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InNtOmhpZGRlbiI+Kzwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICl9CiAgICAgICAgPC9DYXJkQ29udGVudD4KCiAgICAgICAgPFVuYXNzaWduUGFsbGV0QnV0dG9uCiAgICAgICAgICBwYWxsZXRJZD17aWR9CiAgICAgICAgICBwb3NpdGlvbj17cG9zaXRpb259CiAgICAgICAgICBoYXNQcm9kdWN0PXtoYXNQcm9kdWN0fQogICAgICAgICAgb25PcHRpbWlzdGljVXBkYXRlPXtoYW5kbGVPcHRpbWlzdGljUmVtb3ZlfQogICAgICAgIC8+CiAgICAgIDwvQ2FyZD4KCiAgICAgIDxQcm9kdWN0TGlzdE1vZGFsCiAgICAgICAgaXNPcGVuPXtpc1Byb2R1Y3RMaXN0T3Blbn0KICAgICAgICBvbkNsb3NlPXsoKSA9PiBzZXRJc1Byb2R1Y3RMaXN0T3BlbihmYWxzZSl9CiAgICAgICAgdGl0bGU9e2BQcm9kdXRvcyAtIFBhbGV0ZSAke3Bvc2l0aW9ufWB9CiAgICAgICAgZGVzY3JpcHRpb249e2BFc3RlIHBhbGV0ZSBjb250w6ltICR7ZWFuQ291bnR9ICR7ZWFuQ291bnQgPT09IDEgPyAicHJvZHV0byIgOiAicHJvZHV0b3MgZGlmZXJlbnRlcyJ9LmB9CiAgICAgICAgZWFucz17b3B0aW1pc3RpY1N0YXRlLmVhbiB8fCAiIn0KICAgICAgICBwcm9kdWN0TmFtZXM9e29wdGltaXN0aWNTdGF0ZS5wcm9kdWN0TmFtZSB8fCAiIn0KICAgICAgICBzdG9yYWdlVHlwZT0icGFsbGV0IgogICAgICAgIG9uUmVtb3ZlU2VsZWN0ZWQ9e2hhbmRsZVJlbW92ZVNlbGVjdGVkUHJvZHVjdHN9CiAgICAgICAgb25QcmludFNlbGVjdGVkPXtoYW5kbGVQcmludFNlbGVjdGVkUHJvZHVjdHN9CiAgICAgIC8+CgogICAgICA8RGlhbG9nIG9wZW49e2lzQXNzaWduRGlhbG9nT3Blbn0gb25PcGVuQ2hhbmdlPXtzZXRJc0Fzc2lnbkRpYWxvZ09wZW59PgogICAgICAgIDxEaWFsb2dDb250ZW50IGNsYXNzTmFtZT0ic206bWF4LXctWzQyNXB4XSB3LVs5NXZ3XSBtYXgtaC1bOTB2aF0gb3ZlcmZsb3cteS1hdXRvIHJvdW5kZWQteGwiPgogICAgICAgICAgPERpYWxvZ0hlYWRlcj4KICAgICAgICAgICAgPERpYWxvZ1RpdGxlPkFkaWNpb25hciBQcm9kdXRvIC0gUGFsZXRlIHtwb3NpdGlvbn08L0RpYWxvZ1RpdGxlPgogICAgICAgICAgICA8RGlhbG9nRGVzY3JpcHRpb24+QWRpY2lvbmUgdW0gcHJvZHV0byBhIGVzdGUgcGFsZXRlIHtwb3NpdGlvbn0uPC9EaWFsb2dEZXNjcmlwdGlvbj4KICAgICAgICAgIDwvRGlhbG9nSGVhZGVyPgogICAgICAgICAgPEFzc2lnblByb2R1Y3RGb3JtRW5oYW5jZWQKICAgICAgICAgICAgcGFsbGV0SWQ9e2lkfQogICAgICAgICAgICBjdXJyZW50RWFuPSIiCiAgICAgICAgICAgIGN1cnJlbnRQcm9kdWN0TmFtZT0iIgogICAgICAgICAgICBvblN1Y2Nlc3M9e2hhbmRsZUFzc2lnblN1Y2Nlc3N9CiAgICAgICAgICAgIGlzQWRkTW9kZT17ZmFsc2V9CiAgICAgICAgICAvPgogICAgICAgICAge2hhc1Byb2R1Y3QgJiYgPFZlcmlmeVBhbGxldEJ1dHRvbiBwYWxsZXRJZD17aWR9IC8+fQogICAgICAgIDwvRGlhbG9nQ29udGVudD4KICAgICAgPC9EaWFsb2c+CiAgICA8Lz4KICApCn0K"}