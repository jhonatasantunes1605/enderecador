{"data":"InVzZSBjbGllbnQiCgppbXBvcnQgdHlwZSBSZWFjdCBmcm9tICJyZWFjdCIKCmltcG9ydCB7IHVzZVN0YXRlLCB1c2VUcmFuc2l0aW9uLCB1c2VDYWxsYmFjayB9IGZyb20gInJlYWN0IgppbXBvcnQgeyBhc3NpZ25Qcm9kdWN0VG9QYWxsZXQgfSBmcm9tICJAL2FwcC9hY3Rpb25zIgppbXBvcnQgeyBCdXR0b24gfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvYnV0dG9uIgppbXBvcnQgeyBJbnB1dCB9IGZyb20gIkAvY29tcG9uZW50cy91aS9pbnB1dCIKaW1wb3J0IHsgTGFiZWwgfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvbGFiZWwiCmltcG9ydCB7IHRvYXN0IH0gZnJvbSAiQC9ob29rcy91c2UtdG9hc3QiCmltcG9ydCB7IExvYWRpbmdPdmVybGF5IH0gZnJvbSAiLi9sb2FkaW5nLW92ZXJsYXkiCmltcG9ydCB7IExvYWRlcjIsIFNlYXJjaCwgQ2hlY2tDaXJjbGUsIEFsZXJ0VHJpYW5nbGUsIE1hcFBpbiB9IGZyb20gImx1Y2lkZS1yZWFjdCIKaW1wb3J0IHsgdXNlUm91dGVyLCB1c2VTZWFyY2hQYXJhbXMgfSBmcm9tICJuZXh0L25hdmlnYXRpb24iCmltcG9ydCB7IHVzZUFjdGlvbkZlZWRiYWNrIH0gZnJvbSAiQC9ob29rcy91c2UtYWN0aW9uLWZlZWRiYWNrIgoKZnVuY3Rpb24gdXNlRGVib3VuY2U8VCBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gYW55PihjYWxsYmFjazogVCwgZGVsYXk6IG51bWJlcikgewogIGNvbnN0IFtkZWJvdW5jZVRpbWVyLCBzZXREZWJvdW5jZVRpbWVyXSA9IHVzZVN0YXRlPE5vZGVKUy5UaW1lb3V0IHwgbnVsbD4obnVsbCkKCiAgY29uc3QgZGVib3VuY2VkQ2FsbGJhY2sgPSB1c2VDYWxsYmFjaygKICAgICguLi5hcmdzOiBQYXJhbWV0ZXJzPFQ+KSA9PiB7CiAgICAgIGlmIChkZWJvdW5jZVRpbWVyKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlVGltZXIpCiAgICAgIH0KCiAgICAgIGNvbnN0IG5ld1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgY2FsbGJhY2soLi4uYXJncykKICAgICAgfSwgZGVsYXkpCgogICAgICBzZXREZWJvdW5jZVRpbWVyKG5ld1RpbWVyKQogICAgfSwKICAgIFtjYWxsYmFjaywgZGVsYXksIGRlYm91bmNlVGltZXJdLAogICkKCiAgcmV0dXJuIGRlYm91bmNlZENhbGxiYWNrCn0KCmludGVyZmFjZSBBc3NpZ25Qcm9kdWN0Rm9ybUVuaGFuY2VkUHJvcHMgewogIHBhbGxldElkOiBzdHJpbmcKICBjdXJyZW50RWFuPzogc3RyaW5nCiAgY3VycmVudFByb2R1Y3ROYW1lPzogc3RyaW5nCiAgb25TdWNjZXNzPzogKCkgPT4gdm9pZAogIGlzQWRkTW9kZT86IGJvb2xlYW4KfQoKaW50ZXJmYWNlIER1cGxpY2F0ZUxvY2F0aW9uIHsKICBhZGRyZXNzOiBzdHJpbmcKICB3YXJlaG91c2VJZDogc3RyaW5nCiAgYWlzbGVJZDogc3RyaW5nCiAgcG9zaXRpb246IG51bWJlcgogIGxldmVsPzogbnVtYmVyCiAgcHJvZHVjdE5hbWU6IHN0cmluZwogIHN0b3JhZ2VUeXBlOiBzdHJpbmcKICBwYWxsZXRJZDogc3RyaW5nCiAgYWlzbGVOYW1lOiBzdHJpbmcKICB3YXJlaG91c2VOYW1lOiBzdHJpbmcKfQoKZXhwb3J0IGZ1bmN0aW9uIEFzc2lnblByb2R1Y3RGb3JtRW5oYW5jZWQoewogIHBhbGxldElkLAogIGN1cnJlbnRFYW4gPSAiIiwKICBjdXJyZW50UHJvZHVjdE5hbWUgPSAiIiwKICBvblN1Y2Nlc3MsCiAgaXNBZGRNb2RlID0gZmFsc2UsCn06IEFzc2lnblByb2R1Y3RGb3JtRW5oYW5jZWRQcm9wcykgewogIC8vIEVzdGFkb3MgZG8gZm9ybXVsw6FyaW8KICBjb25zdCBbZWFuLCBzZXRFYW5dID0gdXNlU3RhdGUoIiIpIC8vIENhbXBvIEVBTiBhZ29yYSBzdXBvcnRhIG3Dumx0aXBsb3MgRUFOcyBzZXBhcmFkb3MgcG9yIHbDrXJndWxhCiAgY29uc3QgW2lkLCBzZXRJZF0gPSB1c2VTdGF0ZShpc0FkZE1vZGUgPyAiIiA6IGN1cnJlbnRFYW4pIC8vIENhbXBvIElEIChhbnRpZ28gRUFOLCBjb2x1bmEgRSkKICBjb25zdCBbcHJvZHVjdE5hbWUsIHNldFByb2R1Y3ROYW1lXSA9IHVzZVN0YXRlKGlzQWRkTW9kZSA/ICIiIDogY3VycmVudFByb2R1Y3ROYW1lKQogIGNvbnN0IFtpc1NlYXJjaGluZywgc2V0SXNTZWFyY2hpbmddID0gdXNlU3RhdGUoZmFsc2UpCiAgY29uc3QgW3Byb2R1Y3RGb3VuZCwgc2V0UHJvZHVjdEZvdW5kXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtkdXBsaWNhdGVMb2NhdGlvbiwgc2V0RHVwbGljYXRlTG9jYXRpb25dID0gdXNlU3RhdGU8RHVwbGljYXRlTG9jYXRpb24gfCBudWxsPihudWxsKQogIGNvbnN0IFtpc0NoZWNraW5nRHVwbGljYXRlLCBzZXRJc0NoZWNraW5nRHVwbGljYXRlXSA9IHVzZVN0YXRlKGZhbHNlKQoKICAvLyBVc2FyIHVzZVRyYW5zaXRpb24gcGFyYSBjb250cm9sYXIgbyBlc3RhZG8gZGUgc3VibWlzc8OjbwogIGNvbnN0IFtpc1BlbmRpbmcsIHN0YXJ0VHJhbnNpdGlvbl0gPSB1c2VUcmFuc2l0aW9uKCkKICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKQogIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHVzZVNlYXJjaFBhcmFtcygpCiAgY29uc3QgeyBzdWNjZXNzLCBlcnJvciB9ID0gdXNlQWN0aW9uRmVlZGJhY2soKQoKICBjb25zb2xlLmxvZygi8J+UhCBBc3NpZ25Qcm9kdWN0Rm9ybUVuaGFuY2VkIHJlbmRlcml6YWRvOiIsIHsKICAgIHBhbGxldElkLAogICAgaXNBZGRNb2RlLAogICAgY3VycmVudEVhbiwKICAgIGN1cnJlbnRQcm9kdWN0TmFtZSwKICAgIGVhbiwKICAgIGlkLAogICAgcHJvZHVjdE5hbWUsCiAgfSkKCiAgY29uc3QgY2hlY2tGb3JEdXBsaWNhdGVFQU4gPSB1c2VDYWxsYmFjayhhc3luYyAoZWFuVmFsdWU6IHN0cmluZykgPT4gewogICAgaWYgKCFlYW5WYWx1ZSB8fCBlYW5WYWx1ZS5sZW5ndGggPCA0KSB7CiAgICAgIHNldER1cGxpY2F0ZUxvY2F0aW9uKG51bGwpCiAgICAgIHJldHVybgogICAgfQoKICAgIHNldElzQ2hlY2tpbmdEdXBsaWNhdGUodHJ1ZSkKICAgIHRyeSB7CiAgICAgIGNvbnNvbGUubG9nKCLwn5SNIFZlcmlmaWNhbmRvIEVBTiBkdXBsaWNhZG8gKGNvbSBkZWJvdW5jZSk6IiwgZWFuVmFsdWUpCiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC9hcGkvcHJvZHVjdHMvY2hlY2stZHVwbGljYXRlP2Vhbj0ke2VuY29kZVVSSUNvbXBvbmVudChlYW5WYWx1ZSl9YCkKICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKQoKICAgICAgaWYgKGRhdGEuc3VjY2VzcyAmJiBkYXRhLmxvY2F0aW9uKSB7CiAgICAgICAgY29uc29sZS5sb2coIuKaoO+4jyBFQU4gZHVwbGljYWRvIGVuY29udHJhZG86IiwgZGF0YS5sb2NhdGlvbikKICAgICAgICBzZXREdXBsaWNhdGVMb2NhdGlvbihkYXRhLmxvY2F0aW9uKQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCLinIUgRUFOIG7Do28gZHVwbGljYWRvIikKICAgICAgICBzZXREdXBsaWNhdGVMb2NhdGlvbihudWxsKQogICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCLinYwgRXJybyBhbyB2ZXJpZmljYXIgRUFOIGR1cGxpY2FkbzoiLCBlcnJvcikKICAgICAgc2V0RHVwbGljYXRlTG9jYXRpb24obnVsbCkKICAgIH0gZmluYWxseSB7CiAgICAgIHNldElzQ2hlY2tpbmdEdXBsaWNhdGUoZmFsc2UpCiAgICB9CiAgfSwgW10pCgogIGNvbnN0IHNlYXJjaFByb2R1Y3RCeUVBTiA9IHVzZUNhbGxiYWNrKGFzeW5jIChlYW5WYWx1ZTogc3RyaW5nKSA9PiB7CiAgICBpZiAoIWVhblZhbHVlIHx8IGVhblZhbHVlLmxlbmd0aCA8IDQpIHsKICAgICAgc2V0UHJvZHVjdEZvdW5kKGZhbHNlKQogICAgICBzZXRJZCgiIikKICAgICAgc2V0UHJvZHVjdE5hbWUoIiIpCiAgICAgIHJldHVybgogICAgfQoKICAgIHNldElzU2VhcmNoaW5nKHRydWUpCiAgICB0cnkgewogICAgICBjb25zb2xlLmxvZygi8J+UjSBCdXNjYW5kbyBwcm9kdXRvIGNvbSBFQU4gKGNvbSBkZWJvdW5jZSk6IiwgZWFuVmFsdWUpCiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC9hcGkvcHJvZHVjdHMvc2VhcmNoP2Vhbj0ke2VuY29kZVVSSUNvbXBvbmVudChlYW5WYWx1ZSl9YCkKICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKQoKICAgICAgaWYgKGRhdGEuc3VjY2VzcyAmJiBkYXRhLnByb2R1Y3QpIHsKICAgICAgICBjb25zb2xlLmxvZygi4pyFIFByb2R1dG8gZW5jb250cmFkbzoiLCBkYXRhLnByb2R1Y3QpCiAgICAgICAgc2V0SWQoZGF0YS5wcm9kdWN0LmlkKSAvLyBQcmVlbmNoZXIgbyBjYW1wbyBJRCBjb20gbyB2YWxvciBkYSBjb2x1bmEgRQogICAgICAgIHNldFByb2R1Y3ROYW1lKGRhdGEucHJvZHVjdC5kZXNjcmlwdGlvbikKICAgICAgICBzZXRQcm9kdWN0Rm91bmQodHJ1ZSkKICAgICAgICB0b2FzdCh7CiAgICAgICAgICB0aXRsZTogIlByb2R1dG8gZW5jb250cmFkbyEiLAogICAgICAgICAgZGVzY3JpcHRpb246IGAke2RhdGEucHJvZHVjdC5kZXNjcmlwdGlvbn0gLSAke2RhdGEucHJvZHVjdC5icmFuZH1gLAogICAgICAgIH0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coIuKdjCBQcm9kdXRvIG7Do28gZW5jb250cmFkbyIpCiAgICAgICAgc2V0UHJvZHVjdEZvdW5kKGZhbHNlKQogICAgICAgIHNldElkKCIiKQogICAgICAgIHNldFByb2R1Y3ROYW1lKCIiKQogICAgICAgIGlmIChlYW5WYWx1ZS5sZW5ndGggPj0gNCkgewogICAgICAgICAgdG9hc3QoewogICAgICAgICAgICB0aXRsZTogIlByb2R1dG8gbsOjbyBlbmNvbnRyYWRvIiwKICAgICAgICAgICAgZGVzY3JpcHRpb246ICJFQU4gbsOjbyBlbmNvbnRyYWRvIG5hIGJhc2UgZGUgZGFkb3MuIFZvY8OqIHBvZGUgaW5zZXJpciBvIElEIGUgbm9tZSBtYW51YWxtZW50ZS4iLAogICAgICAgICAgICB2YXJpYW50OiAiZGVzdHJ1Y3RpdmUiLAogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIuKdjCBFcnJvIGFvIGJ1c2NhciBwcm9kdXRvOiIsIGVycm9yKQogICAgICBzZXRQcm9kdWN0Rm91bmQoZmFsc2UpCiAgICAgIHNldElkKCIiKQogICAgICBzZXRQcm9kdWN0TmFtZSgiIikKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiAiRXJybyBuYSBidXNjYSIsCiAgICAgICAgZGVzY3JpcHRpb246ICJOw6NvIGZvaSBwb3Nzw612ZWwgYnVzY2FyIG8gcHJvZHV0by4gVGVudGUgbm92YW1lbnRlLiIsCiAgICAgICAgdmFyaWFudDogImRlc3RydWN0aXZlIiwKICAgICAgfSkKICAgIH0gZmluYWxseSB7CiAgICAgIHNldElzU2VhcmNoaW5nKGZhbHNlKQogICAgfQogIH0sIFtdKQoKICBjb25zdCBkZWJvdW5jZWRDaGVja0R1cGxpY2F0ZSA9IHVzZURlYm91bmNlKGNoZWNrRm9yRHVwbGljYXRlRUFOLCA4MDApCiAgY29uc3QgZGVib3VuY2VkU2VhcmNoUHJvZHVjdCA9IHVzZURlYm91bmNlKHNlYXJjaFByb2R1Y3RCeUVBTiwgNjAwKQoKICBjb25zdCBoYW5kbGVFYW5DaGFuZ2UgPSAodmFsdWU6IHN0cmluZykgPT4gewogICAgc2V0RWFuKHZhbHVlKQoKICAgIGNvbnN0IGZpcnN0RWFuID0gdmFsdWUuc3BsaXQoIjsiKVswXS50cmltKCkgLy8gQ2hhbmdlZCB0byBzcGxpdCBieSBzZW1pY29sb24KCiAgICBpZiAoZmlyc3RFYW4ubGVuZ3RoIDwgNCkgewogICAgICBzZXRQcm9kdWN0Rm91bmQoZmFsc2UpCiAgICAgIHNldElkKCIiKQogICAgICBzZXRQcm9kdWN0TmFtZSgiIikKICAgICAgc2V0RHVwbGljYXRlTG9jYXRpb24obnVsbCkKICAgICAgcmV0dXJuCiAgICB9CgogICAgZGVib3VuY2VkQ2hlY2tEdXBsaWNhdGUoZmlyc3RFYW4pCiAgICBkZWJvdW5jZWRTZWFyY2hQcm9kdWN0KGZpcnN0RWFuKQogIH0KCiAgY29uc3QgaGFuZGxlRWFuS2V5RG93biA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7CiAgICBpZiAoZS5rZXkgPT09ICJFbnRlciIpIHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgIGNvbnN0IGZpcnN0RWFuID0gZWFuLnNwbGl0KCI7IilbMF0udHJpbSgpIC8vIENoYW5nZWQgdG8gc3BsaXQgYnkgc2VtaWNvbG9uCiAgICAgIGlmIChmaXJzdEVhbi5sZW5ndGggPj0gNCkgewogICAgICAgIGNoZWNrRm9yRHVwbGljYXRlRUFOKGZpcnN0RWFuKQogICAgICAgIHNlYXJjaFByb2R1Y3RCeUVBTihmaXJzdEVhbikKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdCh7CiAgICAgICAgICB0aXRsZTogIkVBTiBtdWl0byBjdXJ0byIsCiAgICAgICAgICBkZXNjcmlwdGlvbjogIkRpZ2l0ZSBwZWxvIG1lbm9zIDQgY2FyYWN0ZXJlcyBwYXJhIGJ1c2NhciBvIHByb2R1dG8uIiwKICAgICAgICAgIHZhcmlhbnQ6ICJkZXN0cnVjdGl2ZSIsCiAgICAgICAgfSkKICAgICAgfQogICAgfQogIH0KCiAgY29uc3QgaGFuZGxlRHVwbGljYXRlTG9jYXRpb25DbGljayA9ICgpID0+IHsKICAgIGlmIChkdXBsaWNhdGVMb2NhdGlvbikgewogICAgICBjb25zdCBjdXJyZW50U2VsZWN0ZWRBaXNsZSA9IHNlYXJjaFBhcmFtcy5nZXQoInNlbGVjdGVkQWlzbGUiKQogICAgICBjb25zdCB3YXJlaG91c2VVcmwgPSBgL3dhcmVob3VzZXMvJHtkdXBsaWNhdGVMb2NhdGlvbi53YXJlaG91c2VJZH0/aGlnaGxpZ2h0PSR7ZHVwbGljYXRlTG9jYXRpb24ucGFsbGV0SWR9JnR5cGU9JHtkdXBsaWNhdGVMb2NhdGlvbi5zdG9yYWdlVHlwZX0ke2N1cnJlbnRTZWxlY3RlZEFpc2xlID8gYCZzZWxlY3RlZEFpc2xlPSR7Y3VycmVudFNlbGVjdGVkQWlzbGV9YCA6ICIifWAKICAgICAgcm91dGVyLnB1c2god2FyZWhvdXNlVXJsKQoKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiAiTmF2ZWdhbmRvIHBhcmEgbG9jYWxpemHDp8OjbyIsCiAgICAgICAgZGVzY3JpcHRpb246IGBJbmRvIHBhcmEgJHtkdXBsaWNhdGVMb2NhdGlvbi5hZGRyZXNzfWAsCiAgICAgIH0pCiAgICB9CiAgfQoKICBjb25zdCBoYW5kbGVTdWJtaXQgPSBhc3luYyAoKSA9PiB7CiAgICBjb25zb2xlLmxvZygi8J+agCBJbmljaWFuZG8gc3VibWlzc8OjbyBkbyBmb3JtdWzDoXJpby4uLiIpCiAgICBjb25zb2xlLmxvZygi8J+TnSBEYWRvcyBkbyBmb3JtdWzDoXJpbzoiLCB7CiAgICAgIHBhbGxldElkLAogICAgICBlYW46IGVhbi50cmltKCksCiAgICAgIGlkOiBpZC50cmltKCksCiAgICAgIHByb2R1Y3ROYW1lOiBwcm9kdWN0TmFtZS50cmltKCksCiAgICAgIGlzQWRkTW9kZSwKICAgICAgY3VycmVudEVhbiwKICAgICAgY3VycmVudFByb2R1Y3ROYW1lLAogICAgfSkKCiAgICBpZiAoIWlkLnRyaW0oKSB8fCAhcHJvZHVjdE5hbWUudHJpbSgpKSB7CiAgICAgIGNvbnNvbGUubG9nKCLinYwgVmFsaWRhw6fDo28gZmFsaG91IC0gY2FtcG9zIG9icmlnYXTDs3Jpb3MgdmF6aW9zIikKICAgICAgdG9hc3QoewogICAgICAgIHRpdGxlOiAiQ2FtcG9zIG9icmlnYXTDs3Jpb3MiLAogICAgICAgIGRlc2NyaXB0aW9uOiAiSUQgZSBOb21lIGRvIFByb2R1dG8gc8OjbyBvYnJpZ2F0w7NyaW9zLiIsCiAgICAgICAgdmFyaWFudDogImRlc3RydWN0aXZlIiwKICAgICAgfSkKICAgICAgcmV0dXJuCiAgICB9CgogICAgc3RhcnRUcmFuc2l0aW9uKGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBmaW5hbEVhbiA9IGVhbi50cmltKCkKICAgICAgICBsZXQgZmluYWxJZCA9IGlkLnRyaW0oKQogICAgICAgIGxldCBmaW5hbFByb2R1Y3ROYW1lID0gcHJvZHVjdE5hbWUudHJpbSgpCiAgICAgICAgbGV0IGZpbmFsUHJvZHVjdEVhbiA9IGZpbmFsRWFuIC8vIE5vdm8gY2FtcG8gcGFyYSBzYWx2YXIgbcO6bHRpcGxvcyBFQU5zCgogICAgICAgIGlmIChpc0FkZE1vZGUgJiYgY3VycmVudEVhbiAmJiBjdXJyZW50RWFuLnRyaW0oKSAhPT0gIiIpIHsKICAgICAgICAgIGZpbmFsSWQgPSBgJHtjdXJyZW50RWFuLnRyaW0oKX07ICR7aWQudHJpbSgpfWAgLy8gQ2hhbmdlZCB0byBzZW1pY29sb24KICAgICAgICAgIGZpbmFsUHJvZHVjdE5hbWUgPQogICAgICAgICAgICBjdXJyZW50UHJvZHVjdE5hbWUgJiYgY3VycmVudFByb2R1Y3ROYW1lLnRyaW0oKSAhPT0gIiIKICAgICAgICAgICAgICA/IGAke2N1cnJlbnRQcm9kdWN0TmFtZS50cmltKCl9OyAke3Byb2R1Y3ROYW1lLnRyaW0oKX1gIC8vIENoYW5nZWQgdG8gc2VtaWNvbG9uCiAgICAgICAgICAgICAgOiBwcm9kdWN0TmFtZS50cmltKCkKICAgICAgICAgIGNvbnN0IGN1cnJlbnRQcm9kdWN0RWFuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHBhbGxldC0ke3BhbGxldElkfS1lYW5gKSB8fCAiIgogICAgICAgICAgZmluYWxQcm9kdWN0RWFuID0gY3VycmVudFByb2R1Y3RFYW4gPyBgJHtjdXJyZW50UHJvZHVjdEVhbn07ICR7ZmluYWxFYW59YCA6IGZpbmFsRWFuIC8vIENoYW5nZWQgdG8gc2VtaWNvbG9uCiAgICAgICAgICBjb25zb2xlLmxvZygi8J+UhCBNb2RvIGFkacOnw6NvIC0gRUFOcyBjb21iaW5hZG9zOiIsIGZpbmFsUHJvZHVjdEVhbikKICAgICAgICB9CgogICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCkKICAgICAgICBmb3JtRGF0YS5zZXQoImVhbiIsIGZpbmFsSWQpCiAgICAgICAgZm9ybURhdGEuc2V0KCJwcm9kdWN0TmFtZSIsIGZpbmFsUHJvZHVjdE5hbWUpCiAgICAgICAgZm9ybURhdGEuc2V0KCJwcm9kdWN0RWFuIiwgZmluYWxQcm9kdWN0RWFuKSAvLyBTYWx2YXIgbcO6bHRpcGxvcyBFQU5zCgogICAgICAgIGNvbnNvbGUubG9nKCLwn5OkIEVudmlhbmRvIGRhZG9zOiIsIE9iamVjdC5mcm9tRW50cmllcyhmb3JtRGF0YS5lbnRyaWVzKCkpKQoKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhc3NpZ25Qcm9kdWN0VG9QYWxsZXQocGFsbGV0SWQsIHsgbWVzc2FnZTogIiIsIHN1Y2Nlc3M6IGZhbHNlIH0sIGZvcm1EYXRhKQoKICAgICAgICBjb25zb2xlLmxvZygi8J+TpSBSZXN1bHRhZG8gZGEgYWN0aW9uOiIsIHJlc3VsdCkKCiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi4pyFIFByb2R1dG8gc2Fsdm8gY29tIHN1Y2Vzc28hIikKICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGBwYWxsZXQtJHtwYWxsZXRJZH0tZWFuYCwgZmluYWxQcm9kdWN0RWFuKQoKICAgICAgICAgIHRvYXN0KHsKICAgICAgICAgICAgdGl0bGU6ICJTdWNlc3NvISIsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiByZXN1bHQubWVzc2FnZSwKICAgICAgICAgIH0pCgogICAgICAgICAgaWYgKG9uU3VjY2VzcykgewogICAgICAgICAgICBjb25zb2xlLmxvZygi8J+UhCBDaGFtYW5kbyBvblN1Y2Nlc3MuLi4iKQogICAgICAgICAgICBvblN1Y2Nlc3MoKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3VjY2VzcyhyZXN1bHQubWVzc2FnZSwgcGFsbGV0SWQsICJwYWxsZXQiKQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi4p2MIEVycm8gYW8gc2FsdmFyOiIsIHJlc3VsdC5tZXNzYWdlKQogICAgICAgICAgZXJyb3IocmVzdWx0Lm1lc3NhZ2UpCiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIuKdjCBFcnJvIG5hIHN1Ym1pc3PDo286IiwgZXJyb3IpCiAgICAgICAgdG9hc3QoewogICAgICAgICAgdGl0bGU6ICJFcnJvIiwKICAgICAgICAgIGRlc2NyaXB0aW9uOiAiRXJybyBpbmVzcGVyYWRvIGFvIHNhbHZhciBwcm9kdXRvLiBUZW50ZSBub3ZhbWVudGUuIiwKICAgICAgICAgIHZhcmlhbnQ6ICJkZXN0cnVjdGl2ZSIsCiAgICAgICAgfSkKICAgICAgfQogICAgfSkKICB9CgogIHJldHVybiAoCiAgICA8PgogICAgICA8ZGl2IGNsYXNzTmFtZT0idy1mdWxsIj4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBnYXAtNCI+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBnYXAtMiI+CiAgICAgICAgICAgIDxMYWJlbCBodG1sRm9yPSJlYW4iIGNsYXNzTmFtZT0idGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAiPgogICAgICAgICAgICAgIEVBTiBkbyBQcm9kdXRvIHsvKiBBdHVhbGl6YWRvIGxhYmVsIHBhcmEgaW5kaWNhciBzdXBvcnRlIGEgbcO6bHRpcGxvcyBFQU5zICovfQogICAgICAgICAgICA8L0xhYmVsPgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icmVsYXRpdmUiPgogICAgICAgICAgICAgIDxJbnB1dAogICAgICAgICAgICAgICAgaWQ9ImVhbiIKICAgICAgICAgICAgICAgIG5hbWU9ImVhbiIKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJFeDogNzg5MTIzNDU2Nzg5MCBvdSAxMjM7NDU2Ozc4OSAobcO6bHRpcGxvcyBFQU5zIHNlcGFyYWRvcyBwb3IgcG9udG8gZSB2w61yZ3VsYSkiIC8vIFBsYWNlaG9sZGVyIGF0dWFsaXphZG8KICAgICAgICAgICAgICAgIHZhbHVlPXtlYW59CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IGhhbmRsZUVhbkNoYW5nZShlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgICBvbktleURvd249e2hhbmRsZUVhbktleURvd259CiAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9Im9mZiIKICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7cHJvZHVjdEZvdW5kID8gImJvcmRlci1ncmVlbi01MDAgYmctZ3JlZW4tNTAgZGFyazpiZy1ncmVlbi05MDAvMjAiIDogIiJ9IGJnLXdoaXRlIGRhcms6YmctZ3JheS04MDAgYm9yZGVyLWdyYXktMzAwIGRhcms6Ym9yZGVyLWdyYXktNjAwIHRleHQtZ3JheS05MDAgZGFyazp0ZXh0LWdyYXktMTAwYH0KICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJhYnNvbHV0ZSByaWdodC0yIHRvcC0xLzIgdHJhbnNmb3JtIC10cmFuc2xhdGUteS0xLzIiPgogICAgICAgICAgICAgICAgeyhpc1NlYXJjaGluZyB8fCBpc0NoZWNraW5nRHVwbGljYXRlKSAmJiA8TG9hZGVyMiBjbGFzc05hbWU9ImgtNCB3LTQgYW5pbWF0ZS1zcGluIHRleHQtYmx1ZS01MDAiIC8+fQogICAgICAgICAgICAgICAge3Byb2R1Y3RGb3VuZCAmJiA8Q2hlY2tDaXJjbGUgY2xhc3NOYW1lPSJoLTQgdy00IHRleHQtZ3JlZW4tNTAwIiAvPn0KICAgICAgICAgICAgICAgIHshaXNTZWFyY2hpbmcgJiYgIWlzQ2hlY2tpbmdEdXBsaWNhdGUgJiYgIXByb2R1Y3RGb3VuZCAmJiBlYW4ubGVuZ3RoID49IDQgJiYgKAogICAgICAgICAgICAgICAgICA8U2VhcmNoIGNsYXNzTmFtZT0iaC00IHctNCB0ZXh0LWdyYXktNDAwIiAvPgogICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LWdyYXktNTAwIGRhcms6dGV4dC1ncmF5LTQwMCI+CiAgICAgICAgICAgICAgRGlnaXRlIHVtIG91IG3Dumx0aXBsb3MgRUFOcyBzZXBhcmFkb3MgcG9yIHBvbnRvIGUgdsOtcmd1bGEuIEEgYnVzY2EgYXV0b23DoXRpY2EgdXNhIG8gcHJpbWVpcm8gRUFOLgogICAgICAgICAgICA8L3A+CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBnYXAtMiI+CiAgICAgICAgICAgIDxMYWJlbCBodG1sRm9yPSJpZCIgY2xhc3NOYW1lPSJ0ZXh0LWdyYXktOTAwIGRhcms6dGV4dC1ncmF5LTEwMCI+CiAgICAgICAgICAgICAgSUQgZG8gUHJvZHV0byAqCiAgICAgICAgICAgIDwvTGFiZWw+CiAgICAgICAgICAgIDxJbnB1dAogICAgICAgICAgICAgIGlkPSJpZCIKICAgICAgICAgICAgICBuYW1lPSJpZCIKICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iRXg6IDEyMzQ1NiIKICAgICAgICAgICAgICB2YWx1ZT17aWR9CiAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRJZChlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgcmVxdWlyZWQKICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9Im9mZiIKICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake3Byb2R1Y3RGb3VuZCA/ICJib3JkZXItZ3JlZW4tNTAwIGJnLWdyZWVuLTUwIGRhcms6YmctZ3JlZW4tOTAwLzIwIiA6ICIifSBiZy13aGl0ZSBkYXJrOmJnLWdyYXktODAwIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCB0ZXh0LWdyYXktOTAwIGRhcms6dGV4dC1ncmF5LTEwMGB9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LWdyYXktNTAwIGRhcms6dGV4dC1ncmF5LTQwMCI+CiAgICAgICAgICAgICAgSUQgaW50ZXJubyBkbyBwcm9kdXRvIChwcmVlbmNoaWRvIGF1dG9tYXRpY2FtZW50ZSBhbyBidXNjYXIgcG9yIEVBTikKICAgICAgICAgICAgPC9wPgogICAgICAgICAgPC9kaXY+CgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ2FwLTIiPgogICAgICAgICAgICA8TGFiZWwgaHRtbEZvcj0icHJvZHVjdE5hbWUiIGNsYXNzTmFtZT0idGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAiPgogICAgICAgICAgICAgIE5vbWUgZG8gUHJvZHV0byAqCiAgICAgICAgICAgIDwvTGFiZWw+CiAgICAgICAgICAgIDxJbnB1dAogICAgICAgICAgICAgIGlkPSJwcm9kdWN0TmFtZSIKICAgICAgICAgICAgICBuYW1lPSJwcm9kdWN0TmFtZSIKICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iRXg6IENhaXhhIGRlIFBhcmFmdXNvcyIKICAgICAgICAgICAgICB2YWx1ZT17cHJvZHVjdE5hbWV9CiAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRQcm9kdWN0TmFtZShlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgcmVxdWlyZWQKICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9Im9mZiIKICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake3Byb2R1Y3RGb3VuZCA/ICJib3JkZXItZ3JlZW4tNTAwIGJnLWdyZWVuLTUwIGRhcms6YmctZ3JlZW4tOTAwLzIwIiA6ICIifSBiZy13aGl0ZSBkYXJrOmJnLWdyYXktODAwIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCB0ZXh0LWdyYXktOTAwIGRhcms6dGV4dC1ncmF5LTEwMGB9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIHtwcm9kdWN0Rm91bmQgJiYgKAogICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LWdyZWVuLTYwMCBkYXJrOnRleHQtZ3JlZW4tNDAwIj4KICAgICAgICAgICAgICAgIOKckyBQcm9kdXRvIGVuY29udHJhZG8gYXV0b21hdGljYW1lbnRlIG5hIGJhc2UgZGUgZGFkb3MKICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICl9CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICB7ZHVwbGljYXRlTG9jYXRpb24gJiYgKAogICAgICAgICAgICA8ZGl2CiAgICAgICAgICAgICAgY2xhc3NOYW1lPSJiZy1hbWJlci01MCBkYXJrOmJnLWFtYmVyLTkwMC8yMCBib3JkZXIgYm9yZGVyLWFtYmVyLTIwMCBkYXJrOmJvcmRlci1hbWJlci03MDAgcm91bmRlZC1sZyBwLTMgY3Vyc29yLXBvaW50ZXIgaG92ZXI6YmctYW1iZXItMTAwIGRhcms6aG92ZXI6YmctYW1iZXItOTAwLzMwIHRyYW5zaXRpb24tY29sb3JzIgogICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUR1cGxpY2F0ZUxvY2F0aW9uQ2xpY2t9CiAgICAgICAgICAgID4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1zdGFydCBnYXAtMiI+CiAgICAgICAgICAgICAgICA8QWxlcnRUcmlhbmdsZSBjbGFzc05hbWU9ImgtNCB3LTQgdGV4dC1hbWJlci02MDAgZGFyazp0ZXh0LWFtYmVyLTQwMCBtdC0wLjUgZmxleC1zaHJpbmstMCIgLz4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtYW1iZXItODAwIGRhcms6dGV4dC1hbWJlci0yMDAgZmxleC0xIj4KICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJmb250LW1lZGl1bSBtYi0xIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj4KICAgICAgICAgICAgICAgICAgICA8TWFwUGluIGNsYXNzTmFtZT0iaC0zIHctMyIgLz4KICAgICAgICAgICAgICAgICAgICBFQU4gasOhIHBvc3N1aSBlbmRlcmXDp2FtZW50bwogICAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0ibWItMSI+CiAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5Mb2NhbGl6YcOnw6NvOjwvc3Ryb25nPiB7U3RyaW5nKGR1cGxpY2F0ZUxvY2F0aW9uLmFkZHJlc3MgfHwgIiIpfQogICAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1hbWJlci03MDAgZGFyazp0ZXh0LWFtYmVyLTMwMCBtYi0xIj4KICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkdhbHDDo286PC9zdHJvbmc+IHtTdHJpbmcoZHVwbGljYXRlTG9jYXRpb24ud2FyZWhvdXNlTmFtZSB8fCAiIil9CiAgICAgICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LWFtYmVyLTcwMCBkYXJrOnRleHQtYW1iZXItMzAwIGZvbnQtbWVkaXVtIj4KICAgICAgICAgICAgICAgICAgICDwn5GGIENsaXF1ZSBhcXVpIHBhcmEgaXIgYXTDqSBhIGxvY2FsaXphw6fDo28gZG8gcHJvZHV0bwogICAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApfQoKICAgICAgICAgIDxCdXR0b24gb25DbGljaz17aGFuZGxlU3VibWl0fSBkaXNhYmxlZD17aXNQZW5kaW5nIHx8ICFpZC50cmltKCkgfHwgIXByb2R1Y3ROYW1lLnRyaW0oKX0gY2xhc3NOYW1lPSJ3LWZ1bGwiPgogICAgICAgICAgICB7aXNQZW5kaW5nID8gKAogICAgICAgICAgICAgIDw+CiAgICAgICAgICAgICAgICA8TG9hZGVyMiBjbGFzc05hbWU9ImgtNCB3LTQgYW5pbWF0ZS1zcGluIG1yLTIiIC8+CiAgICAgICAgICAgICAgICBTYWx2YW5kby4uLgogICAgICAgICAgICAgIDwvPgogICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICJTYWx2YXIgUHJvZHV0byIKICAgICAgICAgICAgKX0KICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxMb2FkaW5nT3ZlcmxheSBpc0xvYWRpbmc9e2lzU2VhcmNoaW5nIHx8IGlzUGVuZGluZyB8fCBpc0NoZWNraW5nRHVwbGljYXRlfSBtZXNzYWdlPSJQcm9jZXNzYW5kby4uLiIgLz4KICAgIDwvPgogICkKfQo="}