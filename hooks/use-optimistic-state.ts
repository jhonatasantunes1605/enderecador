{"data":"InVzZSBjbGllbnQiCgppbXBvcnQgeyB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIHVzZVJlZiB9IGZyb20gInJlYWN0IgoKaW50ZXJmYWNlIE9wdGltaXN0aWNTdGF0ZTxUPiB7CiAgZGF0YTogVAogIGlzT3B0aW1pc3RpYzogYm9vbGVhbgogIGVycm9yPzogc3RyaW5nCn0KCmV4cG9ydCBmdW5jdGlvbiB1c2VPcHRpbWlzdGljU3RhdGU8VD4oaW5pdGlhbERhdGE6IFQpIHsKICBjb25zdCBbc3RhdGUsIHNldFN0YXRlXSA9IHVzZVN0YXRlPE9wdGltaXN0aWNTdGF0ZTxUPj4oewogICAgZGF0YTogaW5pdGlhbERhdGEsCiAgICBpc09wdGltaXN0aWM6IGZhbHNlLAogIH0pCgogIGNvbnN0IHRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQ+KCkKCiAgY29uc3Qgc2V0T3B0aW1pc3RpYyA9IHVzZUNhbGxiYWNrKAogICAgKG5ld0RhdGE6IFQsIHJldmVydEFmdGVyPzogbnVtYmVyKSA9PiB7CiAgICAgIHNldFN0YXRlKHsKICAgICAgICBkYXRhOiBuZXdEYXRhLAogICAgICAgIGlzT3B0aW1pc3RpYzogdHJ1ZSwKICAgICAgfSkKCiAgICAgIGlmIChyZXZlcnRBZnRlcikgewogICAgICAgIGlmICh0aW1lb3V0UmVmLmN1cnJlbnQpIHsKICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0UmVmLmN1cnJlbnQpCiAgICAgICAgfQoKICAgICAgICB0aW1lb3V0UmVmLmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHNldFN0YXRlKChwcmV2KSA9PiAoewogICAgICAgICAgICBkYXRhOiBpbml0aWFsRGF0YSwKICAgICAgICAgICAgaXNPcHRpbWlzdGljOiBmYWxzZSwKICAgICAgICAgIH0pKQogICAgICAgIH0sIHJldmVydEFmdGVyKQogICAgICB9CiAgICB9LAogICAgW2luaXRpYWxEYXRhXSwKICApCgogIGNvbnN0IHNldEFjdHVhbCA9IHVzZUNhbGxiYWNrKChuZXdEYXRhOiBUKSA9PiB7CiAgICBpZiAodGltZW91dFJlZi5jdXJyZW50KSB7CiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0UmVmLmN1cnJlbnQpCiAgICB9CgogICAgc2V0U3RhdGUoewogICAgICBkYXRhOiBuZXdEYXRhLAogICAgICBpc09wdGltaXN0aWM6IGZhbHNlLAogICAgfSkKICB9LCBbXSkKCiAgY29uc3Qgc2V0RXJyb3IgPSB1c2VDYWxsYmFjaygoZXJyb3I6IHN0cmluZykgPT4gewogICAgc2V0U3RhdGUoKHByZXYpID0+ICh7CiAgICAgIC4uLnByZXYsCiAgICAgIGVycm9yLAogICAgICBpc09wdGltaXN0aWM6IGZhbHNlLAogICAgfSkpCiAgfSwgW10pCgogIGNvbnN0IHJlc2V0ID0gdXNlQ2FsbGJhY2soKCkgPT4gewogICAgaWYgKHRpbWVvdXRSZWYuY3VycmVudCkgewogICAgICBjbGVhclRpbWVvdXQodGltZW91dFJlZi5jdXJyZW50KQogICAgfQoKICAgIHNldFN0YXRlKHsKICAgICAgZGF0YTogaW5pdGlhbERhdGEsCiAgICAgIGlzT3B0aW1pc3RpYzogZmFsc2UsCiAgICB9KQogIH0sIFtpbml0aWFsRGF0YV0pCgogIHJldHVybiB7CiAgICAuLi5zdGF0ZSwKICAgIHNldE9wdGltaXN0aWMsCiAgICBzZXRBY3R1YWwsCiAgICBzZXRFcnJvciwKICAgIHJlc2V0LAogIH0KfQo="}