{"data":"InVzZSBjbGllbnQiDQoNCi8vIEluc3BpcmVkIGJ5IHJlYWN0LWhvdC10b2FzdCBsaWJyYXJ5DQppbXBvcnQgKiBhcyBSZWFjdCBmcm9tICJyZWFjdCINCg0KaW1wb3J0IHR5cGUgew0KICBUb2FzdEFjdGlvbkVsZW1lbnQsDQogIFRvYXN0UHJvcHMsDQp9IGZyb20gIkAvY29tcG9uZW50cy91aS90b2FzdCINCg0KY29uc3QgVE9BU1RfTElNSVQgPSAxDQpjb25zdCBUT0FTVF9SRU1PVkVfREVMQVkgPSAxMDAwMDAwDQoNCnR5cGUgVG9hc3RlclRvYXN0ID0gVG9hc3RQcm9wcyAmIHsNCiAgaWQ6IHN0cmluZw0KICB0aXRsZT86IFJlYWN0LlJlYWN0Tm9kZQ0KICBkZXNjcmlwdGlvbj86IFJlYWN0LlJlYWN0Tm9kZQ0KICBhY3Rpb24/OiBUb2FzdEFjdGlvbkVsZW1lbnQNCn0NCg0KY29uc3QgYWN0aW9uVHlwZXMgPSB7DQogIEFERF9UT0FTVDogIkFERF9UT0FTVCIsDQogIFVQREFURV9UT0FTVDogIlVQREFURV9UT0FTVCIsDQogIERJU01JU1NfVE9BU1Q6ICJESVNNSVNTX1RPQVNUIiwNCiAgUkVNT1ZFX1RPQVNUOiAiUkVNT1ZFX1RPQVNUIiwNCn0gYXMgY29uc3QNCg0KbGV0IGNvdW50ID0gMA0KDQpmdW5jdGlvbiBnZW5JZCgpIHsNCiAgY291bnQgPSAoY291bnQgKyAxKSAlIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSDQogIHJldHVybiBjb3VudC50b1N0cmluZygpDQp9DQoNCnR5cGUgQWN0aW9uVHlwZSA9IHR5cGVvZiBhY3Rpb25UeXBlcw0KDQp0eXBlIEFjdGlvbiA9DQogIHwgew0KICAgICAgdHlwZTogQWN0aW9uVHlwZVsiQUREX1RPQVNUIl0NCiAgICAgIHRvYXN0OiBUb2FzdGVyVG9hc3QNCiAgICB9DQogIHwgew0KICAgICAgdHlwZTogQWN0aW9uVHlwZVsiVVBEQVRFX1RPQVNUIl0NCiAgICAgIHRvYXN0OiBQYXJ0aWFsPFRvYXN0ZXJUb2FzdD4NCiAgICB9DQogIHwgew0KICAgICAgdHlwZTogQWN0aW9uVHlwZVsiRElTTUlTU19UT0FTVCJdDQogICAgICB0b2FzdElkPzogVG9hc3RlclRvYXN0WyJpZCJdDQogICAgfQ0KICB8IHsNCiAgICAgIHR5cGU6IEFjdGlvblR5cGVbIlJFTU9WRV9UT0FTVCJdDQogICAgICB0b2FzdElkPzogVG9hc3RlclRvYXN0WyJpZCJdDQogICAgfQ0KDQppbnRlcmZhY2UgU3RhdGUgew0KICB0b2FzdHM6IFRvYXN0ZXJUb2FzdFtdDQp9DQoNCmNvbnN0IHRvYXN0VGltZW91dHMgPSBuZXcgTWFwPHN0cmluZywgUmV0dXJuVHlwZTx0eXBlb2Ygc2V0VGltZW91dD4+KCkNCg0KY29uc3QgYWRkVG9SZW1vdmVRdWV1ZSA9ICh0b2FzdElkOiBzdHJpbmcpID0+IHsNCiAgaWYgKHRvYXN0VGltZW91dHMuaGFzKHRvYXN0SWQpKSB7DQogICAgcmV0dXJuDQogIH0NCg0KICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgdG9hc3RUaW1lb3V0cy5kZWxldGUodG9hc3RJZCkNCiAgICBkaXNwYXRjaCh7DQogICAgICB0eXBlOiAiUkVNT1ZFX1RPQVNUIiwNCiAgICAgIHRvYXN0SWQ6IHRvYXN0SWQsDQogICAgfSkNCiAgfSwgVE9BU1RfUkVNT1ZFX0RFTEFZKQ0KDQogIHRvYXN0VGltZW91dHMuc2V0KHRvYXN0SWQsIHRpbWVvdXQpDQp9DQoNCmV4cG9ydCBjb25zdCByZWR1Y2VyID0gKHN0YXRlOiBTdGF0ZSwgYWN0aW9uOiBBY3Rpb24pOiBTdGF0ZSA9PiB7DQogIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHsNCiAgICBjYXNlICJBRERfVE9BU1QiOg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgLi4uc3RhdGUsDQogICAgICAgIHRvYXN0czogW2FjdGlvbi50b2FzdCwgLi4uc3RhdGUudG9hc3RzXS5zbGljZSgwLCBUT0FTVF9MSU1JVCksDQogICAgICB9DQoNCiAgICBjYXNlICJVUERBVEVfVE9BU1QiOg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgLi4uc3RhdGUsDQogICAgICAgIHRvYXN0czogc3RhdGUudG9hc3RzLm1hcCgodCkgPT4NCiAgICAgICAgICB0LmlkID09PSBhY3Rpb24udG9hc3QuaWQgPyB7IC4uLnQsIC4uLmFjdGlvbi50b2FzdCB9IDogdA0KICAgICAgICApLA0KICAgICAgfQ0KDQogICAgY2FzZSAiRElTTUlTU19UT0FTVCI6IHsNCiAgICAgIGNvbnN0IHsgdG9hc3RJZCB9ID0gYWN0aW9uDQoNCiAgICAgIC8vICEgU2lkZSBlZmZlY3RzICEgLSBUaGlzIGNvdWxkIGJlIGV4dHJhY3RlZCBpbnRvIGEgZGlzbWlzc1RvYXN0KCkgYWN0aW9uLA0KICAgICAgLy8gYnV0IEknbGwga2VlcCBpdCBoZXJlIGZvciBzaW1wbGljaXR5DQogICAgICBpZiAodG9hc3RJZCkgew0KICAgICAgICBhZGRUb1JlbW92ZVF1ZXVlKHRvYXN0SWQpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBzdGF0ZS50b2FzdHMuZm9yRWFjaCgodG9hc3QpID0+IHsNCiAgICAgICAgICBhZGRUb1JlbW92ZVF1ZXVlKHRvYXN0LmlkKQ0KICAgICAgICB9KQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4gew0KICAgICAgICAuLi5zdGF0ZSwNCiAgICAgICAgdG9hc3RzOiBzdGF0ZS50b2FzdHMubWFwKCh0KSA9Pg0KICAgICAgICAgIHQuaWQgPT09IHRvYXN0SWQgfHwgdG9hc3RJZCA9PT0gdW5kZWZpbmVkDQogICAgICAgICAgICA/IHsNCiAgICAgICAgICAgICAgICAuLi50LA0KICAgICAgICAgICAgICAgIG9wZW46IGZhbHNlLA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICA6IHQNCiAgICAgICAgKSwNCiAgICAgIH0NCiAgICB9DQogICAgY2FzZSAiUkVNT1ZFX1RPQVNUIjoNCiAgICAgIGlmIChhY3Rpb24udG9hc3RJZCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgLi4uc3RhdGUsDQogICAgICAgICAgdG9hc3RzOiBbXSwNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgLi4uc3RhdGUsDQogICAgICAgIHRvYXN0czogc3RhdGUudG9hc3RzLmZpbHRlcigodCkgPT4gdC5pZCAhPT0gYWN0aW9uLnRvYXN0SWQpLA0KICAgICAgfQ0KICB9DQp9DQoNCmNvbnN0IGxpc3RlbmVyczogQXJyYXk8KHN0YXRlOiBTdGF0ZSkgPT4gdm9pZD4gPSBbXQ0KDQpsZXQgbWVtb3J5U3RhdGU6IFN0YXRlID0geyB0b2FzdHM6IFtdIH0NCg0KZnVuY3Rpb24gZGlzcGF0Y2goYWN0aW9uOiBBY3Rpb24pIHsNCiAgbWVtb3J5U3RhdGUgPSByZWR1Y2VyKG1lbW9yeVN0YXRlLCBhY3Rpb24pDQogIGxpc3RlbmVycy5mb3JFYWNoKChsaXN0ZW5lcikgPT4gew0KICAgIGxpc3RlbmVyKG1lbW9yeVN0YXRlKQ0KICB9KQ0KfQ0KDQp0eXBlIFRvYXN0ID0gT21pdDxUb2FzdGVyVG9hc3QsICJpZCI+DQoNCmZ1bmN0aW9uIHRvYXN0KHsgLi4ucHJvcHMgfTogVG9hc3QpIHsNCiAgY29uc3QgaWQgPSBnZW5JZCgpDQoNCiAgY29uc3QgdXBkYXRlID0gKHByb3BzOiBUb2FzdGVyVG9hc3QpID0+DQogICAgZGlzcGF0Y2goew0KICAgICAgdHlwZTogIlVQREFURV9UT0FTVCIsDQogICAgICB0b2FzdDogeyAuLi5wcm9wcywgaWQgfSwNCiAgICB9KQ0KICBjb25zdCBkaXNtaXNzID0gKCkgPT4gZGlzcGF0Y2goeyB0eXBlOiAiRElTTUlTU19UT0FTVCIsIHRvYXN0SWQ6IGlkIH0pDQoNCiAgZGlzcGF0Y2goew0KICAgIHR5cGU6ICJBRERfVE9BU1QiLA0KICAgIHRvYXN0OiB7DQogICAgICAuLi5wcm9wcywNCiAgICAgIGlkLA0KICAgICAgb3BlbjogdHJ1ZSwNCiAgICAgIG9uT3BlbkNoYW5nZTogKG9wZW4pID0+IHsNCiAgICAgICAgaWYgKCFvcGVuKSBkaXNtaXNzKCkNCiAgICAgIH0sDQogICAgfSwNCiAgfSkNCg0KICByZXR1cm4gew0KICAgIGlkOiBpZCwNCiAgICBkaXNtaXNzLA0KICAgIHVwZGF0ZSwNCiAgfQ0KfQ0KDQpmdW5jdGlvbiB1c2VUb2FzdCgpIHsNCiAgY29uc3QgW3N0YXRlLCBzZXRTdGF0ZV0gPSBSZWFjdC51c2VTdGF0ZTxTdGF0ZT4obWVtb3J5U3RhdGUpDQoNCiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsNCiAgICBsaXN0ZW5lcnMucHVzaChzZXRTdGF0ZSkNCiAgICByZXR1cm4gKCkgPT4gew0KICAgICAgY29uc3QgaW5kZXggPSBsaXN0ZW5lcnMuaW5kZXhPZihzZXRTdGF0ZSkNCiAgICAgIGlmIChpbmRleCA+IC0xKSB7DQogICAgICAgIGxpc3RlbmVycy5zcGxpY2UoaW5kZXgsIDEpDQogICAgICB9DQogICAgfQ0KICB9LCBbc3RhdGVdKQ0KDQogIHJldHVybiB7DQogICAgLi4uc3RhdGUsDQogICAgdG9hc3QsDQogICAgZGlzbWlzczogKHRvYXN0SWQ/OiBzdHJpbmcpID0+IGRpc3BhdGNoKHsgdHlwZTogIkRJU01JU1NfVE9BU1QiLCB0b2FzdElkIH0pLA0KICB9DQp9DQoNCmV4cG9ydCB7IHVzZVRvYXN0LCB0b2FzdCB9Cg=="}